<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ—ºï¸ MapovÃ½ exportÃ©r</title>
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
  
  <!-- Leaflet Draw CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #1a1a1a;
      color: #e0e0e0;
      min-height: 100vh;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .header h1 {
      font-size: 1.8rem;
      font-weight: 600;
      color: #e0e0e0;
      margin-bottom: 10px;
    }

    .controls-section {
      background-color: #2a2a2a;
      border: 1px solid #404040;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .controls-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .control-group label {
      font-size: 0.9rem;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }

    .btn {
      background-color: #6aa6fd;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn:hover {
      background-color: #5694f0;
    }

    .btn:disabled {
      background-color: #404040;
      cursor: not-allowed;
      opacity: 0.5;
    }

    .btn-secondary {
      background-color: #404040;
    }

    .btn-secondary:hover {
      background-color: #4a4a4a;
    }

    .btn-success {
      background-color: #4caf50;
    }

    .btn-success:hover {
      background-color: #45a049;
    }

    select, input[type="number"] {
      padding: 8px 12px;
      background-color: #404040;
      border: 1px solid #555;
      border-radius: 4px;
      color: #e0e0e0;
      font-size: 0.9rem;
    }

    select:focus, input[type="number"]:focus {
      outline: none;
      border-color: #6aa6fd;
    }

    #map {
      width: 100%;
      height: 600px;
      border-radius: 8px;
      border: 1px solid #404040;
      background-color: #2a2a2a;
    }

    .info-box {
      background-color: #2a2a2a;
      border: 1px solid #404040;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
    }

    .info-box h3 {
      font-size: 1rem;
      margin-bottom: 10px;
      color: #6aa6fd;
    }

    .info-box p {
      font-size: 0.9rem;
      line-height: 1.6;
      color: #bbb;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 4px;
      color: white;
      font-size: 0.9rem;
      z-index: 10000;
      min-width: 300px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      animation: slideIn 0.3s ease-out;
    }

    .notification.success {
      background-color: #4caf50;
      border-left: 4px solid #45a049;
    }

    .notification.error {
      background-color: #f44336;
      border-left: 4px solid #d32f2f;
    }

    .notification.info {
      background-color: #2196f3;
      border-left: 4px solid #1976d2;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Styling pro tlaÄÃ­tko vÃ½bÄ›ru oblasti */
    .leaflet-draw-toolbar a {
      background-color: #2a2a2a !important;
    }

    /* Print styles */
    @media print {
      body {
        background: white;
      }
      
      .controls-section,
      .info-box,
      .header {
        display: none !important;
      }
      
      #map {
        width: 100% !important;
        height: 100% !important;
        border: none !important;
        page-break-inside: avoid;
      }

      .container {
        padding: 0;
        max-width: none;
      }
    }

    /* Multi-page print styling */
    @page {
      size: A4;
      margin: 10mm;
    }

    .print-pages {
      display: none;
    }

    @media print {
      .print-pages {
        display: block;
      }
      
      .print-page {
        page-break-after: always;
        width: 100%;
        height: 100vh;
      }
      
      .print-page:last-child {
        page-break-after: auto;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ—ºï¸ MapovÃ½ exportÃ©r pro Å¡kolu</h1>
    </div>

    <div class="controls-section">
      <div class="controls-grid">
        <div class="control-group">
          <label>ğŸ“ VÃ½bÄ›r oblasti</label>
          <button id="selectArea" class="btn">
            Vybrat oblast myÅ¡Ã­
          </button>
        </div>

        <div class="control-group">
          <label>ğŸ—‘ï¸ Smazat vÃ½bÄ›r</label>
          <button id="clearArea" class="btn btn-secondary" disabled>
            Vymazat oblast
          </button>
        </div>
        
        <div class="control-group">
          <label>ğŸ’¾ Export PNG</label>
          <button id="exportPng" class="btn btn-success" disabled>
            StÃ¡hnout jako PNG
          </button>
        </div>
        
        <div class="control-group">
          <label>ğŸ–¨ï¸ Tisk</label>
          <button id="printMap" class="btn btn-secondary">
            Vytisknout mapu
          </button>
        </div>

        <div class="control-group">
          <label>ğŸ“„ PoÄet strÃ¡nek A4</label>
          <select id="printPages">
            <option value="1">1 strÃ¡nka</option>
            <option value="2">2 strÃ¡nky (2x1)</option>
            <option value="4">4 strÃ¡nky (2x2)</option>
            <option value="6">6 strÃ¡nek (3x2)</option>
            <option value="9">9 strÃ¡nek (3x3)</option>
          </select>
        </div>

        <div class="control-group">
          <label>ğŸ—ºï¸ Vrstva mapy</label>
          <select id="mapLayer">
            <option value="streets" selected>Mapa s ulicemi (detailnÃ­)</option>
            <option value="topo">OpenStreetMap (zÃ¡kladnÃ­)</option>
            <option value="satellite">SatelitnÃ­ snÃ­mky</option>
            <option value="topo2">TopografickÃ¡ mapa</option>
            <option value="terrain">CyklistickÃ¡ mapa (s terÃ©nem)</option>
            <option value="humanitarian">HumanitÃ¡rnÃ­ mapa</option>
            <option value="cartodb">CartoDB Voyager</option>
            <option value="cartolight">CartoDB Light (svÄ›tlÃ¡)</option>
          </select>
        </div>

        <div class="control-group">
          <label>ğŸ” Zoom</label>
          <input type="number" id="zoomLevel" min="1" max="18" value="10">
        </div>
      </div>
    </div>

    <div id="map"></div>

    <div class="info-box">
      <h3>ğŸ“š NÃ¡vod k pouÅ¾itÃ­</h3>
      <p>
        <strong>1.</strong> PÅ™ibliÅ¾te si mapu pomocÃ­ koleÄka myÅ¡i nebo tlaÄÃ­tek +/- na mapÄ›.<br>
        <strong>2.</strong> KliknÄ›te na "Vybrat oblast myÅ¡Ã­" a nakreslete obdÃ©lnÃ­k na mapÄ›.<br>
        <strong>3.</strong> Po vÃ½bÄ›ru oblasti kliknÄ›te "StÃ¡hnout jako PNG" - exportuje se pouze vybranÃ¡ oblast!<br>
        <strong>4.</strong> Pro tisk kliknÄ›te "Vytisknout mapu" - mapa se automaticky pÅ™iblÃ­Å¾Ã­ na vybranou oblast.<br>
        <strong>5.</strong> Pro tisk na vÃ­ce strÃ¡nek vyberte poÄet strÃ¡nek A4 pÅ™ed tiskem.<br>
        <strong>ğŸ’¡ Tip:</strong> ÄŒÃ­m vÄ›tÅ¡Ã­ zoom a menÅ¡Ã­ vybranÃ¡ oblast, tÃ­m vyÅ¡Å¡Ã­ bude rozliÅ¡enÃ­ exportu!<br>
        <strong>ğŸ“œ HistorickÃ© mapy:</strong> KvÅ¯li ochranÄ› autorskÃ½ch prÃ¡v nejsou historickÃ© mapy dostupnÃ© zde - viz odkaz nÃ­Å¾e.
      </p>
      <button class="btn" style="background-color: #ff9800; margin-top: 10px;" onclick="window.open('historicke_mapy_odkazy.html', '_blank')">
        ğŸ“œ Kde najÃ­t historickÃ© mapy
      </button>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
  
  <!-- Leaflet Draw JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
  
  <!-- html2canvas pro export PNG -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    let map;
    let selectedArea = null;
    let drawnItems;
    let currentLayer;
    let mapLayers = {};
    let drawControl;
    let isDrawing = false;
    let currentRectangle = null;

    // Definice mapovÃ½ch vrstev
    const layerDefinitions = {
      'streets': {
        name: 'Mapa s ulicemi (detailnÃ­)',
        layer: L.tileLayer('https://{s}.tile.openstreetmap.de/{z}/{x}/{y}.png', {
          attribution: 'Â© OpenStreetMap contributors',
          maxZoom: 18
        })
      },
      'satellite': {
        name: 'SatelitnÃ­ snÃ­mky',
        layer: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
          attribution: 'Â© Esri',
          maxZoom: 18
        })
      },
      'topo': {
        name: 'OpenStreetMap (zÃ¡kladnÃ­)',
        layer: L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: 'Â© OpenStreetMap contributors',
          maxZoom: 19
        })
      },
      'topo2': {
        name: 'TopografickÃ¡ mapa',
        layer: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
          attribution: 'Â© OpenTopoMap contributors',
          maxZoom: 17
        })
      },
      'terrain': {
        name: 'CyklistickÃ¡ mapa (s terÃ©nem)',
        layer: L.tileLayer('https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png', {
          attribution: 'Â© OpenStreetMap contributors, CyclOSM',
          maxZoom: 20,
          subdomains: 'abc'
        })
      },
      'humanitarian': {
        name: 'HumanitÃ¡rnÃ­ mapa',
        layer: L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
          attribution: 'Â© OpenStreetMap contributors, Humanitarian OSM Team',
          maxZoom: 19
        })
      },
      'cartodb': {
        name: 'CartoDB Voyager',
        layer: L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
          attribution: 'Â© OpenStreetMap contributors Â© CARTO',
          subdomains: 'abcd',
          maxZoom: 20
        })
      },
      'cartolight': {
        name: 'CartoDB Light (svÄ›tlÃ¡)',
        layer: L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
          attribution: 'Â© OpenStreetMap contributors Â© CARTO',
          subdomains: 'abcd',
          maxZoom: 20
        })
      }
    };

    // Inicializace mapy
    function initMap() {
      try {
        // VytvoÅ™enÃ­ mapy se stÅ™ednÃ­ Evropou jako vÃ½chozÃ­ pozicÃ­
        map = L.map('map').setView([49.8175, 15.4730], 7); // ÄŒeskÃ¡ republika

        // PÅ™idÃ¡nÃ­ vÃ½chozÃ­ vrstvy - standardnÃ­ OSM (nejspolehlivÄ›jÅ¡Ã­)
        currentLayer = layerDefinitions['streets'].layer.addTo(map);

        // Inicializace vrstvy pro kreslenÃ­
        drawnItems = new L.FeatureGroup();
        map.addLayer(drawnItems);

        // Kontrola, zda je Leaflet Draw dostupnÃ½
        if (typeof L.Draw !== 'undefined') {
          // NastavenÃ­ ovlÃ¡dÃ¡nÃ­ kreslenÃ­
          drawControl = new L.Control.Draw({
            draw: {
              polygon: false,
              polyline: false,
              circle: false,
              circlemarker: false,
              marker: false,
              rectangle: {
                shapeOptions: {
                  color: '#6aa6fd',
                  weight: 3,
                  fillOpacity: 0.1
                }
              }
            },
            edit: {
              featureGroup: drawnItems,
              remove: true
            }
          });

          // Event listener pro vytvoÅ™enÃ­ oblasti
          map.on(L.Draw.Event.CREATED, function(event) {
            drawnItems.clearLayers();
            const layer = event.layer;
            drawnItems.addLayer(layer);
            selectedArea = layer;
            
            document.getElementById('exportPng').disabled = false;
            document.getElementById('clearArea').disabled = false;
            showNotification('Oblast vybrÃ¡na! NynÃ­ mÅ¯Å¾ete exportovat nebo tisknout.', 'success');
          });

          // Event listener pro smazÃ¡nÃ­ oblasti
          map.on(L.Draw.Event.DELETED, function() {
            selectedArea = null;
            document.getElementById('exportPng').disabled = true;
            document.getElementById('clearArea').disabled = true;
            showNotification('Oblast byla odstranÄ›na.', 'info');
          });
        } else {
          // Fallback na jednoduchÃ© kreslenÃ­ bez Leaflet Draw
          console.warn('Leaflet Draw nenÃ­ dostupnÃ½, pouÅ¾Ã­vÃ¡m alternativnÃ­ metodu');
          setupSimpleDrawing();
        }

        // PÅ™idÃ¡nÃ­ mÄ›Å™Ã­tka
        L.control.scale({imperial: false, metric: true}).addTo(map);

        // Update zoom level pÅ™i zmÄ›nÄ›
        map.on('zoomend', function() {
          document.getElementById('zoomLevel').value = map.getZoom();
        });

      } catch (error) {
        console.error('Chyba pÅ™i inicializaci mapy:', error);
        showNotification('Chyba pÅ™i naÄÃ­tÃ¡nÃ­ mapy: ' + error.message, 'error');
      }
    }

    // JednoduchÃ¡ implementace kreslenÃ­ bez Leaflet Draw
    function setupSimpleDrawing() {
      let startLatLng = null;
      let tempRectangle = null;

      map.on('mousedown', function(e) {
        if (isDrawing) {
          startLatLng = e.latlng;
          
          map.on('mousemove', function(e) {
            if (tempRectangle) {
              map.removeLayer(tempRectangle);
            }
            
            const bounds = L.latLngBounds(startLatLng, e.latlng);
            tempRectangle = L.rectangle(bounds, {
              color: '#6aa6fd',
              weight: 3,
              fillOpacity: 0.1
            }).addTo(map);
          });
        }
      });

      map.on('mouseup', function(e) {
        if (isDrawing && startLatLng) {
          map.off('mousemove');
          
          if (tempRectangle) {
            map.removeLayer(tempRectangle);
          }
          
          drawnItems.clearLayers();
          
          const bounds = L.latLngBounds(startLatLng, e.latlng);
          currentRectangle = L.rectangle(bounds, {
            color: '#6aa6fd',
            weight: 3,
            fillOpacity: 0.1
          }).addTo(drawnItems);
          
          selectedArea = currentRectangle;
          document.getElementById('exportPng').disabled = false;
          document.getElementById('clearArea').disabled = false;
          showNotification('Oblast vybrÃ¡na! NynÃ­ mÅ¯Å¾ete exportovat nebo tisknout.', 'success');
          
          isDrawing = false;
          document.getElementById('selectArea').textContent = 'Vybrat oblast myÅ¡Ã­';
          document.getElementById('selectArea').classList.remove('btn-secondary');
          map.dragging.enable();
          
          startLatLng = null;
          tempRectangle = null;
        }
      });
    }

    // Funkce pro zobrazenÃ­ notifikacÃ­
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);

      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // VÃ½bÄ›r oblasti
    document.getElementById('selectArea').addEventListener('click', function() {
      if (typeof L.Draw !== 'undefined' && drawControl) {
        // PouÅ¾itÃ­ Leaflet Draw
        showNotification('KliknÄ›te a tÃ¡hnÄ›te na mapÄ› pro vÃ½bÄ›r oblasti', 'info');
        new L.Draw.Rectangle(map, drawControl.options.draw.rectangle).enable();
      } else {
        // PouÅ¾itÃ­ jednoduchÃ© metody
        isDrawing = !isDrawing;
        
        if (isDrawing) {
          this.textContent = 'â¹ï¸ ZruÅ¡it vÃ½bÄ›r';
          this.classList.add('btn-secondary');
          showNotification('KliknÄ›te a tÃ¡hnÄ›te na mapÄ› pro vÃ½bÄ›r oblasti', 'info');
          map.dragging.disable(); // ZakÃ¡zat pÅ™etahovÃ¡nÃ­ mapy bÄ›hem kreslenÃ­
        } else {
          this.textContent = 'Vybrat oblast myÅ¡Ã­';
          this.classList.remove('btn-secondary');
          map.dragging.enable();
        }
      }
    });

    // VymazÃ¡nÃ­ vybranÃ© oblasti
    document.getElementById('clearArea').addEventListener('click', function() {
      if (selectedArea) {
        drawnItems.clearLayers();
        selectedArea = null;
        document.getElementById('exportPng').disabled = true;
        document.getElementById('clearArea').disabled = true;
        showNotification('Oblast byla odstranÄ›na.', 'info');
      }
    });

    // Export do PNG
    document.getElementById('exportPng').addEventListener('click', async function() {
      if (!selectedArea) {
        showNotification('Nejprve vyberte oblast na mapÄ›!', 'error');
        return;
      }

      showNotification('Generuji PNG obrÃ¡zek...', 'info');

      try {
        // ZÃ­skÃ¡nÃ­ boundaries vybranÃ© oblasti
        const bounds = selectedArea.getBounds();
        
        // UloÅ¾enÃ­ pÅ¯vodnÃ­ho pohledu
        const originalView = {
          center: map.getCenter(),
          zoom: map.getZoom()
        };
        
        // ZÃ­skÃ¡nÃ­ pixelovÃ½ch souÅ™adnic vybranÃ© oblasti PÅ˜ED zmÄ›nou pohledu
        const northEast = map.latLngToContainerPoint(bounds.getNorthEast());
        const southWest = map.latLngToContainerPoint(bounds.getSouthWest());
        
        // VÃ½poÄet rozmÄ›rÅ¯ vybranÃ© oblasti v pixelech
        const width = Math.abs(northEast.x - southWest.x);
        const height = Math.abs(southWest.y - northEast.y);
        const left = Math.min(northEast.x, southWest.x);
        const top = Math.min(northEast.y, southWest.y);
        
        // Informace o rozliÅ¡enÃ­
        showNotification(`Export oblasti ${Math.round(width)}Ã—${Math.round(height)} px...`, 'info');
        
        // DoÄasnÃ© skrytÃ­ vÃ½bÄ›rovÃ©ho obdÃ©lnÃ­ku
        const rectangleElement = selectedArea._path;
        if (rectangleElement) {
          rectangleElement.style.display = 'none';
        }
        
        // PoÄkat na vykreslenÃ­
        await new Promise(resolve => setTimeout(resolve, 300));

        // VytvoÅ™enÃ­ PNG pomocÃ­ html2canvas
        const mapElement = document.getElementById('map');
        const canvas = await html2canvas(mapElement, {
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#2a2a2a',
          logging: false,
          x: left,
          y: top,
          width: width,
          height: height,
          windowWidth: mapElement.offsetWidth,
          windowHeight: mapElement.offsetHeight
        });

        // VrÃ¡tit zobrazenÃ­ vÃ½bÄ›rovÃ©ho obdÃ©lnÃ­ku
        if (rectangleElement) {
          rectangleElement.style.display = '';
        }

        // PÅ™evod na blob a staÅ¾enÃ­
        canvas.toBlob(function(blob) {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `mapa_export_${Math.round(width)}x${Math.round(height)}_${Date.now()}.png`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          
          showNotification(`PNG staÅ¾en! RozliÅ¡enÃ­: ${Math.round(width)}Ã—${Math.round(height)} px`, 'success');
        });

      } catch (error) {
        console.error('Chyba pÅ™i exportu:', error);
        showNotification('Chyba pÅ™i exportu PNG: ' + error.message, 'error');
        
        // VrÃ¡tit zobrazenÃ­ obdÃ©lnÃ­ku i v pÅ™Ã­padÄ› chyby
        if (selectedArea && selectedArea._path) {
          selectedArea._path.style.display = '';
        }
      }
    });

    // Tisk mapy
    document.getElementById('printMap').addEventListener('click', function() {
      const pageCount = parseInt(document.getElementById('printPages').value);
      
      // Pokud je vybrÃ¡na oblast, pÅ™iblÃ­Å¾it na ni pÅ™ed tiskem
      if (selectedArea) {
        const bounds = selectedArea.getBounds();
        
        // UloÅ¾enÃ­ pÅ¯vodnÃ­ho pohledu
        const originalView = {
          center: map.getCenter(),
          zoom: map.getZoom()
        };
        
        // SkrÃ½t vÃ½bÄ›rovÃ½ obdÃ©lnÃ­k
        const rectangleElement = selectedArea._path;
        if (rectangleElement) {
          rectangleElement.style.display = 'none';
        }
        
        // PÅ™iblÃ­Å¾it na vybranou oblast
        map.fitBounds(bounds, { padding: [20, 20], animate: false });
        
        // PoÄkat na vykreslenÃ­ a pak tisknout
        setTimeout(() => {
          if (pageCount === 1) {
            showNotification('OtevÃ­rÃ¡m dialogovÃ© okno pro tisk...', 'info');
            window.print();
          } else {
            showNotification('PÅ™ipravuji tisk na vÃ­ce strÃ¡nek...', 'info');
            prepareMutiPagePrint(pageCount);
          }
          
          // Po tisku vrÃ¡tit pÅ¯vodnÃ­ pohled
          setTimeout(() => {
            if (rectangleElement) {
              rectangleElement.style.display = '';
            }
            map.setView(originalView.center, originalView.zoom);
          }, 1000);
        }, 500);
        
      } else {
        // Tisk bez vÃ½bÄ›ru oblasti
        if (pageCount === 1) {
          showNotification('OtevÃ­rÃ¡m dialogovÃ© okno pro tisk...', 'info');
          window.print();
        } else {
          showNotification('Pro tisk na vÃ­ce strÃ¡nek nejprve vyberte oblast!', 'error');
        }
      }
    });

    // PÅ™Ã­prava tisku na vÃ­ce strÃ¡nek
    function prepareMutiPagePrint(pageCount) {
      if (!selectedArea) {
        showNotification('Pro tisk na vÃ­ce strÃ¡nek nejprve vyberte oblast!', 'error');
        return;
      }

      const bounds = selectedArea.getBounds();
      const rows = Math.sqrt(pageCount);
      const cols = pageCount / rows;

      // VÃ½poÄet rozdÄ›lenÃ­ oblasti
      const latStep = (bounds.getNorth() - bounds.getSouth()) / rows;
      const lngStep = (bounds.getEast() - bounds.getWest()) / cols;

      showNotification(`Tisk bude rozdÄ›len na ${rows}x${cols} strÃ¡nek`, 'info');
      
      // ProzatÃ­m jednoduchÃ½ tisk celÃ© oblasti
      // Pro plnou implementaci by bylo potÅ™eba vytvoÅ™it snapshot kaÅ¾dÃ© ÄÃ¡sti
      setTimeout(() => window.print(), 500);
    }

    // ZmÄ›na vrstvy mapy
    document.getElementById('mapLayer').addEventListener('change', function(e) {
      const layerKey = e.target.value;
      
      if (currentLayer) {
        map.removeLayer(currentLayer);
      }
      
      currentLayer = layerDefinitions[layerKey].layer.addTo(map);
      showNotification(`PÅ™epnuto na: ${layerDefinitions[layerKey].name}`, 'info');
    });

    // ZmÄ›na zoom ÃºrovnÄ›
    document.getElementById('zoomLevel').addEventListener('change', function(e) {
      const zoom = parseInt(e.target.value);
      map.setZoom(zoom);
    });

    // Inicializace pÅ™i naÄtenÃ­ strÃ¡nky
    document.addEventListener('DOMContentLoaded', function() {
      initMap();
      showNotification('Mapa byla naÄtena! ZaÄnÄ›te vÃ½bÄ›rem oblasti.', 'success');
    });
  </script>
</body>
</html>
