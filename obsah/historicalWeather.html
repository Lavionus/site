<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìä Historick√© poƒças√≠ - Roz≈°√≠≈ôen√©</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #1a1a1a;
      color: #e0e0e0;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 1.4rem;
      font-weight: 600;
      margin: 0;
      color: #e0e0e0;
    }

    /* Z√°lo≈æky */
    .tabs-container {
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
      background-color: #2a2a2a;
      padding: 5px;
      border-radius: 8px;
      border: 1px solid #404040;
    }

    .tab-btn {
      flex: 1;
      padding: 12px 20px;
      background-color: transparent;
      border: none;
      color: #888;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.3s ease;
    }

    .tab-btn:hover {
      background-color: #333;
      color: #e0e0e0;
    }

    .tab-btn.active {
      background-color: #6aa6fd;
      color: white;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .controls-section {
      background-color: #2a2a2a;
      border: 1px solid #404040;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .search-form {
      display: flex;
      align-items: end;
      gap: 20px;
      flex-wrap: wrap;
    }

    .search-group {
      position: relative;
      flex: 1;
      min-width: 130px;
    }

    .search-group h3 {
      font-size: 0.9rem;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
      font-weight: 600;
    }

    .search-input, select {
      width: 100%;
      padding: 8px 12px;
      background-color: #404040;
      border: 1px solid #555;
      border-radius: 4px;
      color: #e0e0e0;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .search-input::placeholder {
      color: #999;
    }

    .search-input:focus, select:focus {
      outline: none;
      border-color: #6aa6fd;
    }

    select option {
      background-color: #404040;
      color: #e0e0e0;
    }

    .suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background-color: #404040;
      border: 1px solid #555;
      border-top: none;
      border-radius: 0 0 4px 4px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
    }

    .suggestions.show {
      display: block;
    }

    .suggestion-item {
      padding: 10px 12px;
      cursor: pointer;
      color: #e0e0e0;
      font-size: 0.9rem;
      border-bottom: 1px solid #555;
      transition: background-color 0.2s ease;
    }

    .suggestion-item:hover,
    .suggestion-item.selected {
      background-color: #6aa6fd;
    }

    .suggestion-item:last-child {
      border-bottom: none;
    }

    .suggestion-name {
      font-weight: 500;
    }

    .suggestion-details {
      font-size: 0.8rem;
      color: #bbb;
      margin-top: 2px;
    }

    .load-btn {
      background-color: #6aa6fd;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.2s ease;
      flex-shrink: 0;
      height: fit-content;
    }

    .load-btn:hover {
      background-color: #5694f0;
    }

    .load-btn:disabled {
      background-color: #555;
      cursor: not-allowed;
    }

    /* Styl pro tlaƒç√≠tko retry */
    .retry-btn {
      background-color: #e67e22;
      color: white;
    }
    .retry-btn:hover {
      background-color: #d35400;
    }

    .chart-container {
      background-color: #2a2a2a;
      border: 1px solid #404040;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .chart-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: #e0e0e0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .chart-wrapper {
      position: relative;
      height: 350px;
      margin-bottom: 15px;
    }

    .chart-wrapper.tall {
      height: 450px;
    }

    .stats-container {
      padding: 15px 20px;
    }

    .stats-container .chart-title {
      margin-bottom: 10px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-top: 0;
    }

    .stats-grid.extended {
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    }

    .stat-card {
      background-color: #333;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 10px 8px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }

    .stat-icon {
      font-size: 1.1rem;
      margin-bottom: 0;
    }

    .stat-value {
      font-size: 1.3rem;
      font-weight: 700;
      color: #6aa6fd;
      margin-bottom: 0;
      line-height: 1.2;
    }

    .stat-label {
      font-size: 0.7rem;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .stat-card.temp-max .stat-value { color: #ff6b6b; }
    .stat-card.temp-min .stat-value { color: #4ecdc4; }
    .stat-card.rain .stat-value { color: #74b9ff; }
    .stat-card.sun .stat-value { color: #ffeaa7; }
    .stat-card.cloud .stat-value { color: #b2bec3; }
    .stat-card.wind .stat-value { color: #81ecec; }
    .stat-card.humidity .stat-value { color: #a29bfe; }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 4px;
      color: white;
      font-size: 0.9rem;
      z-index: 10000;
      min-width: 300px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      animation: slideIn 0.3s ease-out;
    }

    .notification.success { background-color: #4caf50; border-left: 4px solid #45a049; }
    .notification.info { background-color: #2196f3; border-left: 4px solid #1976d2; }
    .notification.warning { background-color: #ff9800; border-left: 4px solid #f57c00; }
    .notification.error { background-color: #f44336; border-left: 4px solid #d32f2f; }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .info-box {
      background-color: #2d3a4a;
      border: 1px solid #3d5a80;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      color: #a0c4ff;
      font-size: 0.9rem;
    }

    .period-info {
      text-align: center;
      color: #888;
      font-size: 0.9rem;
      margin-top: 10px;
    }

    /* Tabulka */
    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .table-header .chart-title {
      margin-bottom: 0;
    }

    .export-btn {
      background-color: #27ae60;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: background-color 0.2s ease;
    }

    .export-btn:hover {
      background-color: #219a52;
    }

    .table-wrapper {
      max-height: 500px;
      overflow-y: auto;
      border: 1px solid #404040;
      border-radius: 4px;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    .data-table thead {
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .data-table th {
      background-color: #333;
      color: #e0e0e0;
      padding: 10px 8px;
      text-align: center;
      border-bottom: 2px solid #6aa6fd;
      font-weight: 600;
      white-space: nowrap;
    }

    .data-table td {
      padding: 8px;
      text-align: center;
      border-bottom: 1px solid #404040;
      color: #ccc;
    }

    .data-table tbody tr:hover {
      background-color: #333;
    }

    .data-table .temp-min { color: #4ecdc4; }
    .data-table .temp-max { color: #ff6b6b; }
    .data-table .humidity { color: #a29bfe; }
    .data-table .precip { color: #74b9ff; }
    .data-table .cloud { color: #b2bec3; }
    .data-table .wind { color: #81ecec; }

    /* Roƒçn√≠ p≈ôehled - statistiky */
    .year-stats-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .year-stats-card {
      background-color: #2a2a2a;
      border: 1px solid #404040;
      border-radius: 8px;
      padding: 20px;
    }

    .year-stats-card h3 {
      font-size: 1rem;
      font-weight: 600;
      color: #6aa6fd;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .mini-stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .mini-stat {
      background-color: #333;
      border-radius: 4px;
      padding: 10px;
      text-align: center;
    }

    .mini-stat-value {
      font-size: 1.4rem;
      font-weight: 700;
      color: #6aa6fd;
    }

    .mini-stat-label {
      font-size: 0.7rem;
      color: #888;
      text-transform: uppercase;
    }

    .day-type-legend {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #404040;
      font-size: 0.75rem;
      color: #888;
      line-height: 1.6;
    }

    .day-type-legend-item {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      margin-bottom: 4px;
    }

    .day-type-legend-item strong {
      color: #aaa;
      white-space: nowrap;
    }

    /* Progress bar */
    .progress-container {
      background-color: #2a2a2a;
      border: 1px solid #404040;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 0.9rem;
    }

    .progress-bar {
      height: 20px;
      background-color: #404040;
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #6aa6fd, #4ecdc4);
      border-radius: 10px;
      transition: width 0.3s ease;
      width: 0%;
    }

    .progress-detail {
      margin-top: 10px;
      font-size: 0.8rem;
      color: #888;
      text-align: center;
    }

    .download-log {
      margin-top: 15px;
      max-height: 200px;
      overflow-y: auto;
      background-color: #1a1a1a;
      border: 1px solid #404040;
      border-radius: 4px;
      padding: 10px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.75rem;
    }

    .log-entry {
      padding: 3px 0;
      border-bottom: 1px solid #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    .log-entry .log-year {
      color: #6aa6fd;
      font-weight: 500;
    }

    .log-entry .log-status {
      padding: 2px 8px;
      border-radius: 3px;
      font-size: 0.7rem;
    }

    .log-entry .log-status.success {
      background-color: rgba(76, 175, 80, 0.2);
      color: #4caf50;
    }

    .log-entry .log-status.retry {
      background-color: rgba(255, 152, 0, 0.2);
      color: #ff9800;
    }

    .log-entry .log-status.error {
      background-color: rgba(244, 67, 54, 0.2);
      color: #f44336;
    }

    .log-entry .log-status.pending {
      background-color: rgba(106, 166, 253, 0.2);
      color: #6aa6fd;
    }

    /* Extremes a trends listy */
    .extremes-list, .trends-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .extreme-item, .trend-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background-color: #333;
      border-radius: 4px;
      font-size: 0.85rem;
    }

    .extreme-item .label, .trend-item .label {
      color: #aaa;
    }

    .extreme-item .value {
      font-weight: 600;
      color: #6aa6fd;
    }

    .extreme-item .year {
      font-size: 0.75rem;
      color: #888;
      margin-left: 8px;
    }

    .trend-item .value {
      font-weight: 600;
    }

    .trend-item .value.positive { color: #ff6b6b; }
    .trend-item .value.negative { color: #4ecdc4; }
    .trend-item .value.neutral { color: #888; }

    /* Dek√°dn√≠ grid */
    .decade-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .decade-card {
      background-color: #333;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 15px;
    }

    .decade-card h4 {
      font-size: 1rem;
      color: #6aa6fd;
      margin-bottom: 10px;
      text-align: center;
      border-bottom: 1px solid #444;
      padding-bottom: 8px;
    }

    .decade-stat {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
      font-size: 0.8rem;
    }

    .decade-stat .label { color: #888; }
    .decade-stat .value { color: #e0e0e0; font-weight: 500; }

    /* Floating tooltip */
    .hourly-tooltip {
      position: fixed;
      background-color: #2a2a2a;
      border: 1px solid #6aa6fd;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.5);
      z-index: 9999;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s ease;
      min-width: 320px;
    }

    .hourly-tooltip.visible {
      opacity: 1;
    }

    .hourly-tooltip-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid #404040;
    }

    .hourly-tooltip-title {
      font-weight: 600;
      color: #6aa6fd;
      font-size: 0.95rem;
    }

    .hourly-tooltip-summary {
      font-size: 0.8rem;
      color: #bbb;
    }

    .hourly-chart-wrapper {
      height: 150px;
      width: 100%;
    }

    .hourly-tooltip-hint {
      font-size: 0.75rem;
      color: #999;
      text-align: center;
      margin-top: 8px;
    }

    /* ===== NOV√â STYLY PRO ANAL√ùZU ===== */
    
    /* Profesion√°ln√≠ hlaviƒçka sekce */
    .analyze-section-header {
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid #404040;
    }
    
    .analyze-section-header h2 {
      font-size: 1.3rem;
      font-weight: 600;
      color: #6aa6fd;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .analyze-section-header p {
      color: #aaa;
      font-size: 0.9rem;
      margin-top: 8px;
      line-height: 1.5;
    }
    
    /* Vylep≈°en√© statistiky s vysvƒõtlivkami */
    .analyze-stat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .analyze-stat-card {
      background-color: #2a2a2a;
      border: 1px solid #404040;
      border-radius: 8px;
      padding: 20px;
      position: relative;
      transition: border-color 0.2s ease;
    }
    
    .analyze-stat-card:hover {
      border-color: #6aa6fd;
    }
    
    .analyze-stat-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }
    
    .analyze-stat-title {
      font-size: 0.95rem;
      font-weight: 600;
      color: #e0e0e0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .analyze-stat-icon {
      font-size: 1.2rem;
      color: #6aa6fd;
    }
    
    .analyze-stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: #6aa6fd;
      margin-bottom: 5px;
      line-height: 1;
    }
    
    .analyze-stat-unit {
      font-size: 0.9rem;
      color: #888;
      margin-left: 3px;
    }
    
    .analyze-stat-description {
      font-size: 0.8rem;
      color: #aaa;
      line-height: 1.4;
      margin-top: 8px;
    }
    
    /* Tlaƒç√≠tko info */
    .info-btn {
      background: none;
      border: none;
      color: #888;
      font-size: 0.9rem;
      cursor: help;
      padding: 4px;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    
    .info-btn:hover {
      background-color: rgba(106, 166, 253, 0.1);
      color: #6aa6fd;
    }
    
    /* Tooltip */
    .info-tooltip {
      position: absolute;
      background-color: #1a1a1a;
      border: 1px solid #6aa6fd;
      border-radius: 6px;
      padding: 15px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      z-index: 1000;
      max-width: 300px;
      font-size: 0.85rem;
      line-height: 1.5;
      color: #e0e0e0;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease;
      right: 10px;
      top: 50px;
    }
    
    .info-tooltip.visible {
      opacity: 1;
      visibility: visible;
    }
    
    .info-tooltip::before {
      content: '';
      position: absolute;
      top: -6px;
      right: 20px;
      width: 10px;
      height: 10px;
      background-color: #1a1a1a;
      border-left: 1px solid #6aa6fd;
      border-top: 1px solid #6aa6fd;
      transform: rotate(45deg);
    }
    
    .tooltip-title {
      font-weight: 600;
      color: #6aa6fd;
      margin-bottom: 8px;
      font-size: 0.9rem;
    }
    
    .tooltip-content {
      color: #ccc;
    }
    
    /* Vylep≈°en√© extremy a trendy */
    .analyze-detail-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }
    
    .analyze-detail-card {
      background-color: #2a2a2a;
      border: 1px solid #404040;
      border-radius: 8px;
      padding: 20px;
    }
    
    .detail-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #404040;
    }
    
    .detail-card-title {
      font-size: 1rem;
      font-weight: 600;
      color: #e0e0e0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Vylep≈°en√© grafy */
    .analyze-chart-container {
      background-color: #2a2a2a;
      border: 1px solid #404040;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .analyze-chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .analyze-chart-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #e0e0e0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .analyze-chart-description {
      color: #888;
      font-size: 0.85rem;
      margin-top: 5px;
    }
    
    /* Dek√°dn√≠ porovn√°n√≠ - vylep≈°en√© */
    .decade-comparison-container {
      background-color: #2a2a2a;
      border: 1px solid #404040;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .decade-comparison-header {
      margin-bottom: 20px;
    }
    
    /* Data kvality */
    .data-quality-info {
      background-color: rgba(106, 166, 253, 0.05);
      border: 1px solid rgba(106, 166, 253, 0.3);
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 20px;
      font-size: 0.85rem;
      color: #aaa;
    }
    
    .data-quality-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      color: #6aa6fd;
      font-weight: 500;
    }
    
    /* V√Ωstra≈æn√° statistika */
    .analyze-stat-card.warning {
      border-color: #ff9800;
    }
    
    .analyze-stat-card.warning .analyze-stat-value {
      color: #ff9800;
    }
    
    .analyze-stat-card.positive {
      border-color: #4caf50;
    }
    
    .analyze-stat-card.positive .analyze-stat-value {
      color: #4caf50;
    }
    
    .analyze-stat-card.negative {
      border-color: #f44336;
    }
    
    .analyze-stat-card.negative .analyze-stat-value {
      color: #f44336;
    }
    
    @media (max-width: 768px) {
      .container { padding: 10px; }
      .header h1 { font-size: 1.2rem; }
      .chart-wrapper { height: 280px; }
      .search-form { flex-direction: column; }
      .search-group { min-width: auto; }
      .stats-grid { grid-template-columns: repeat(3, 1fr); }
      .stat-card { padding: 8px 5px; }
      .stat-value { font-size: 1.1rem; }
      .stat-label { font-size: 0.6rem; }
      .tabs-container { flex-wrap: wrap; }
      .tab-btn { font-size: 0.85rem; padding: 10px; }
      .analyze-stat-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }
      .analyze-stat-value {
        font-size: 1.7rem;
      }
      .analyze-detail-grid {
        grid-template-columns: 1fr;
      }
      .info-tooltip {
        max-width: 250px;
        right: -10px;
      }
    }

    /* ===== POKROƒåIL√â STATISTICK√â SEKCE ===== */
    
    /* Sekce s hlaviƒçkou */
    .pro-section {
      background-color: #2a2a2a;
      border: 1px solid #404040;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .pro-section-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #404040;
    }
    
    .pro-section-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #e0e0e0;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .pro-section-subtitle {
      color: #888;
      font-size: 0.85rem;
      margin-top: 5px;
    }
    
    /* Statistick√° tabulka */
    .stats-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    
    .stats-table th,
    .stats-table td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid #404040;
    }
    
    .stats-table th {
      background-color: #333;
      color: #888;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.5px;
    }
    
    .stats-table tr:hover {
      background-color: rgba(106, 166, 253, 0.05);
    }
    
    .stats-table .value-cell {
      font-weight: 600;
      color: #6aa6fd;
    }
    
    .stats-table .trend-up {
      color: #ff6b6b;
    }
    
    .stats-table .trend-down {
      color: #4ecdc4;
    }
    
    .stats-table .trend-neutral {
      color: #888;
    }
    
    /* Percentilov√Ω box */
    .percentile-box {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px;
      background-color: #333;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    
    .percentile-bar {
      flex: 1;
      height: 30px;
      background: linear-gradient(to right, #4ecdc4, #ffd93d, #ff6b6b);
      border-radius: 4px;
      position: relative;
    }
    
    .percentile-marker {
      position: absolute;
      top: -5px;
      width: 2px;
      height: 40px;
      background-color: #fff;
      transform: translateX(-50%);
    }
    
    .percentile-marker::after {
      content: attr(data-label);
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.7rem;
      color: #aaa;
      white-space: nowrap;
    }
    
    .percentile-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: #888;
      margin-top: 5px;
    }
    
    /* Kompaktn√≠ grid pro statistiky */
    .compact-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .compact-stat-item {
      background-color: #333;
      border-radius: 6px;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .compact-stat-label {
      color: #aaa;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .compact-stat-value {
      font-weight: 600;
      font-size: 1.1rem;
      color: #6aa6fd;
    }
    
    .compact-stat-value.positive { color: #4caf50; }
    .compact-stat-value.negative { color: #f44336; }
    .compact-stat-value.warning { color: #ff9800; }
    
    /* Indexov√Ω indik√°tor */
    .index-indicator {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      background-color: #333;
      border-radius: 8px;
      text-align: center;
    }
    
    .index-value {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 5px;
    }
    
    .index-label {
      font-size: 0.9rem;
      color: #888;
      margin-bottom: 10px;
    }
    
    .index-scale {
      width: 100%;
      height: 8px;
      background: linear-gradient(to right, #4ecdc4, #ffd93d, #ff6b6b);
      border-radius: 4px;
      position: relative;
      margin-top: 10px;
    }
    
    .index-pointer {
      position: absolute;
      top: -3px;
      width: 14px;
      height: 14px;
      background-color: #fff;
      border-radius: 50%;
      transform: translateX(-50%);
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .index-description {
      font-size: 0.8rem;
      color: #aaa;
      margin-top: 15px;
      line-height: 1.4;
    }
    
    /* Sez√≥nn√≠ tabulka */
    .season-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
    }
    
    .season-card {
      background-color: #333;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
    }
    
    .season-card.spring { border-top: 3px solid #4caf50; }
    .season-card.summer { border-top: 3px solid #ff9800; }
    .season-card.autumn { border-top: 3px solid #795548; }
    .season-card.winter { border-top: 3px solid #2196f3; }
    
    .season-name {
      font-weight: 600;
      color: #e0e0e0;
      margin-bottom: 10px;
      font-size: 0.95rem;
    }
    
    .season-stat {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      font-size: 0.85rem;
      border-bottom: 1px solid #404040;
    }
    
    .season-stat:last-child {
      border-bottom: none;
    }
    
    .season-stat-label {
      color: #888;
    }
    
    .season-stat-value {
      color: #e0e0e0;
      font-weight: 500;
    }
    
    /* Trend anal√Ωza s R¬≤ */
    .trend-analysis-card {
      background-color: #333;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
    }
    
    .trend-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .trend-title {
      font-weight: 600;
      color: #e0e0e0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .trend-badge {
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }
    
    .trend-badge.significant {
      background-color: rgba(76, 175, 80, 0.2);
      color: #4caf50;
    }
    
    .trend-badge.not-significant {
      background-color: rgba(136, 136, 136, 0.2);
      color: #888;
    }
    
    .trend-details {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    
    .trend-detail-item {
      text-align: center;
    }
    
    .trend-detail-value {
      font-size: 1.2rem;
      font-weight: 600;
      color: #6aa6fd;
    }
    
    .trend-detail-label {
      font-size: 0.75rem;
      color: #888;
      margin-top: 2px;
    }
    
    /* Vegetaƒçn√≠ obdob√≠ */
    .vegetation-timeline {
      background-color: #333;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 15px;
    }
    
    .timeline-bar {
      height: 40px;
      background: linear-gradient(to right, 
        #4ecdc4 0%, #4ecdc4 8%,
        #4caf50 8%, #4caf50 42%,
        #ffd93d 42%, #ffd93d 67%,
        #795548 67%, #795548 92%,
        #4ecdc4 92%, #4ecdc4 100%
      );
      border-radius: 4px;
      position: relative;
      margin: 20px 0;
    }
    
    .timeline-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: #888;
    }
    
    .vegetation-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    /* Responsivn√≠ √∫pravy pro nov√© sekce */
    @media (max-width: 768px) {
      .season-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .trend-details {
        grid-template-columns: 1fr;
        gap: 5px;
      }
      
      .compact-stats-grid {
        grid-template-columns: 1fr;
      }
      
      .percentile-box {
        flex-direction: column;
        gap: 10px;
      }
      
      .percentile-bar {
        width: 100%;
      }
    }

    /* ===== DEK√ÅDN√ç ANAL√ùZA STYLY ===== */
    .decade-changes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
    }

    .decade-change-card {
      background: #333;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      border: 1px solid #404040;
    }

    .decade-change-label {
      font-size: 0.85rem;
      color: #888;
      margin-bottom: 8px;
    }

    .decade-change-value {
      font-size: 1.4rem;
      font-weight: bold;
      color: #e0e0e0;
    }

    .decade-change-diff {
      font-size: 0.9rem;
      margin-top: 8px;
      padding: 4px 8px;
      border-radius: 4px;
    }

    .decade-change-diff.positive {
      color: #e74c3c;
      background: rgba(231, 76, 60, 0.15);
    }

    .decade-change-diff.negative {
      color: #3498db;
      background: rgba(52, 152, 219, 0.15);
    }

    .decade-change-diff.positive-precip {
      color: #2ecc71;
      background: rgba(46, 204, 113, 0.15);
    }

    .decade-change-diff.negative-precip {
      color: #e67e22;
      background: rgba(230, 126, 34, 0.15);
    }

    .decade-change-diff.neutral {
      color: #888;
    }

    .mini-decade-card {
      background: #2a2a2a;
      border-radius: 6px;
      padding: 10px;
      text-align: center;
      border: 1px solid #404040;
    }

    .extreme-days-section {
      background: #333;
      border-radius: 8px;
      padding: 15px;
      border: 1px solid #404040;
    }

    .extreme-days-section h4 {
      margin: 0 0 15px 0;
      font-size: 0.95rem;
      color: #e0e0e0;
    }

    .climate-shift-container {
      background: linear-gradient(135deg, #2a2a2a 0%, #333 100%);
      border-radius: 12px;
      padding: 25px;
      border: 1px solid #404040;
    }

    .shift-header {
      text-align: center;
      margin-bottom: 25px;
    }

    .shift-period {
      font-size: 1.3rem;
      color: #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .shift-from {
      color: #3498db;
    }

    .shift-arrow {
      color: #888;
      font-size: 1.5rem;
    }

    .shift-to {
      color: #e74c3c;
    }

    .shift-years {
      color: #888;
      font-size: 0.9rem;
      margin-top: 5px;
    }

    .shift-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }

    .shift-metric {
      background: #2a2a2a;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      border: 2px solid #404040;
      transition: transform 0.2s, border-color 0.2s;
    }

    .shift-metric:hover {
      transform: translateY(-3px);
    }

    .shift-metric.warming {
      border-color: #e74c3c;
    }

    .shift-metric.cooling {
      border-color: #3498db;
    }

    .shift-metric.wetter {
      border-color: #2ecc71;
    }

    .shift-metric.drier {
      border-color: #e67e22;
    }

    .shift-metric.increase {
      border-color: #e74c3c;
    }

    .shift-metric.decrease {
      border-color: #2ecc71;
    }

    .shift-metric.increase-frost {
      border-color: #3498db;
    }

    .shift-metric.decrease-frost {
      border-color: #e74c3c;
    }

    .shift-metric-icon {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .shift-metric-label {
      color: #888;
      font-size: 0.85rem;
      margin-bottom: 8px;
    }

    .shift-metric-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: #e0e0e0;
    }

    .shift-metric-sub {
      font-size: 0.8rem;
      color: #888;
      margin-top: 5px;
    }

    .decade-overview-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üìä Historick√© poƒças√≠ - Roz≈°√≠≈ôen√©</h1>
    </div>

    <div class="tabs-container">
      <button class="tab-btn active" data-tab="day">üìÖ Den</button>
      <button class="tab-btn" data-tab="month">üìÜ Mƒõs√≠c</button>
      <button class="tab-btn" data-tab="year">üìä Rok</button>
      <button class="tab-btn" data-tab="export">üì• Export v≈°ech let</button>
      <button class="tab-btn" data-tab="analyze">üìà Anal√Ωza historie</button>
      <button class="tab-btn" data-tab="decades">üìâ Dek√°dn√≠ zmƒõny</button>
    </div>

    <div id="tab-day" class="tab-content active">
      <div class="controls-section">
        <div class="search-form">
          <div class="search-group">
            <h3>üìç Lokalita</h3>
            <input type="text" id="location-day" class="search-input location-input" placeholder="Zadejte n√°zev mƒõsta...">
            <div id="suggestions-day" class="suggestions"></div>
          </div>
          <div class="search-group" style="flex: 0.4;">
            <h3>üìÖ Datum</h3>
            <input type="date" id="date-day" class="search-input">
          </div>
          <button id="loadDay" class="load-btn">üîç Naƒç√≠st</button>
        </div>
      </div>

      <div class="info-box">
        ‚ÑπÔ∏è Zobraz√≠ hodinov√° data pro vybran√Ω den vƒçetnƒõ teploty, vlhkosti, oblaƒçnosti a vƒõtru.
      </div>

      <div id="day-content">
        <div class="chart-container stats-container">
          <div class="chart-title">üìà Statistiky dne</div>
          <div id="dayStats" class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üìä</div>
              <div class="stat-value">‚Äî</div>
              <div class="stat-label">Vyberte datum</div>
            </div>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-title">üå°Ô∏è Pr≈Øbƒõh dne - Teplota</div>
          <div class="chart-wrapper">
            <canvas id="dayTempChart"></canvas>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-title">‚òÅÔ∏è Oblaƒçnost, üíß Vlhkost, üí® V√≠tr</div>
          <div class="chart-wrapper">
            <canvas id="dayOtherChart"></canvas>
          </div>
        </div>

        <div class="chart-container" id="dayTableSection" style="display: none;">
          <div class="table-header">
            <div class="chart-title">üìã Hodinov√° data</div>
            <button id="exportDayCsv" class="export-btn">üì• Export CSV</button>
          </div>
          <div class="table-wrapper">
            <table class="data-table">
              <thead>
                <tr>
                  <th>üïê ƒåas</th>
                  <th>üå°Ô∏è Teplota ¬∞C</th>
                  <th>üíß Vlhkost %</th>
                  <th>üåßÔ∏è Sr√°≈æky mm</th>
                  <th>‚òÅÔ∏è Oblaƒçnost %</th>
                  <th>üí® V√≠tr km/h</th>
                </tr>
              </thead>
              <tbody id="dayTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div id="tab-month" class="tab-content">
      <div class="controls-section">
        <div class="search-form">
          <div class="search-group">
            <h3>üìç Lokalita</h3>
            <input type="text" id="location-month" class="search-input location-input" placeholder="Zadejte n√°zev mƒõsta...">
            <div id="suggestions-month" class="suggestions"></div>
          </div>
          <div class="search-group" style="flex: 0.4;">
            <h3>üìÖ Rok</h3>
            <select id="year-month"></select>
          </div>
          <div class="search-group" style="flex: 0.4;">
            <h3>üìÜ Mƒõs√≠c</h3>
            <select id="month-month">
              <option value="1">Leden</option>
              <option value="2">√önor</option>
              <option value="3">B≈ôezen</option>
              <option value="4">Duben</option>
              <option value="5">Kvƒõten</option>
              <option value="6">ƒåerven</option>
              <option value="7">ƒåervenec</option>
              <option value="8">Srpen</option>
              <option value="9">Z√°≈ô√≠</option>
              <option value="10">≈ò√≠jen</option>
              <option value="11">Listopad</option>
              <option value="12">Prosinec</option>
            </select>
          </div>
          <button id="loadMonth" class="load-btn">üîç Naƒç√≠st</button>
        </div>
      </div>

      <div class="info-box">
        ‚ÑπÔ∏è Data z <strong>Open-Meteo Archive API</strong>. Dostupn√° historick√° data: 1940 ‚Äì souƒçasnost.
      </div>

      <div id="month-content">
        <div class="chart-container stats-container">
          <div class="chart-title">üìà Statistiky mƒõs√≠ce</div>
          <div id="monthStats" class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üìä</div>
              <div class="stat-value">‚Äî</div>
              <div class="stat-label">Vyberte obdob√≠</div>
            </div>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-title">üå°Ô∏è Teploty a sr√°≈æky</div>
          <div class="chart-wrapper tall">
            <canvas id="monthTempChart"></canvas>
          </div>
          <div id="monthPeriod" class="period-info"></div>
        </div>

        <div class="chart-container">
          <div class="chart-title">‚òÅÔ∏è Oblaƒçnost, üíß Vlhkost, üí® V√≠tr (pr≈Ømƒõry)</div>
          <div class="chart-wrapper">
            <canvas id="monthOtherChart"></canvas>
          </div>
        </div>

        <div class="chart-container" id="monthTableSection" style="display: none;">
          <div class="table-header">
            <div class="chart-title">üìã Denn√≠ data</div>
            <button id="exportMonthCsv" class="export-btn">üì• Export CSV</button>
          </div>
          <div class="table-wrapper">
            <table class="data-table">
              <thead>
                <tr>
                  <th>üìÖ Datum</th>
                  <th>üå°Ô∏è Min ¬∞C</th>
                  <th>üî• Max ¬∞C</th>
                  <th>üåßÔ∏è Sr√°≈æky mm</th>
                  <th>‚òÅÔ∏è Oblaƒçnost %</th>
                  <th>üíß Vlhkost %</th>
                  <th>üí® V√≠tr km/h</th>
                </tr>
              </thead>
              <tbody id="monthTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div id="tab-year" class="tab-content">
      <div class="controls-section">
        <div class="search-form">
          <div class="search-group">
            <h3>üìç Lokalita</h3>
            <input type="text" id="location-year" class="search-input location-input" placeholder="Zadejte n√°zev mƒõsta...">
            <div id="suggestions-year" class="suggestions"></div>
          </div>
          <div class="search-group" style="flex: 0.4;">
            <h3>üìÖ Rok</h3>
            <select id="year-year"></select>
          </div>
          <button id="loadYear" class="load-btn">üîç Naƒç√≠st</button>
        </div>
      </div>

      <div class="info-box">
        ‚ÑπÔ∏è Roƒçn√≠ p≈ôehled zobrazuje mƒõs√≠ƒçn√≠ pr≈Ømƒõry a souhrnn√© statistiky za cel√Ω rok.
      </div>

      <div id="year-content">
        <div class="chart-container stats-container">
          <div class="chart-title">üìà Roƒçn√≠ statistiky</div>
          <div id="yearStats" class="stats-grid extended">
            <div class="stat-card">
              <div class="stat-icon">üìä</div>
              <div class="stat-value">‚Äî</div>
              <div class="stat-label">Vyberte rok</div>
            </div>
          </div>
        </div>

        <div class="year-stats-section" id="yearExtendedStats" style="display: none;">
          <div class="year-stats-card">
            <h3>üå°Ô∏è Teplotn√≠ statistiky</h3>
            <div class="mini-stats-grid" id="yearTempStats"></div>
          </div>
          <div class="year-stats-card">
            <h3>üåßÔ∏è Sr√°≈æky a oblaƒçnost</h3>
            <div class="mini-stats-grid" id="yearPrecipStats"></div>
          </div>
          <div class="year-stats-card">
            <h3>üìä Poƒçet dn≈Ø dle typu</h3>
            <div class="mini-stats-grid" id="yearDayStats"></div>
            <div class="day-type-legend" id="dayTypeLegend"></div>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-title">üå°Ô∏è Mƒõs√≠ƒçn√≠ teploty a sr√°≈æky</div>
          <div class="chart-wrapper tall">
            <canvas id="yearTempChart"></canvas>
          </div>
          <div id="yearPeriod" class="period-info"></div>
        </div>

        <div class="chart-container">
          <div class="chart-title">‚òÅÔ∏è Mƒõs√≠ƒçn√≠ oblaƒçnost, üíß vlhkost, üí® v√≠tr</div>
          <div class="chart-wrapper">
            <canvas id="yearOtherChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div id="tab-export" class="tab-content">
      <div class="controls-section">
        <div class="search-form">
          <div class="search-group">
            <h3>üìç Lokalita</h3>
            <input type="text" id="location-export" class="search-input location-input" placeholder="Zadejte n√°zev mƒõsta...">
            <div id="suggestions-export" class="suggestions"></div>
          </div>
          <div class="search-group" style="flex: 0.3;">
            <h3>üìÖ Od roku</h3>
            <select id="year-export-start"></select>
          </div>
          <div class="search-group" style="flex: 0.3;">
            <h3>üìÖ Do roku</h3>
            <select id="year-export-end"></select>
          </div>
          <button id="loadAllYears" class="load-btn">üì• St√°hnout data</button>
          <button id="cancelDownload" class="load-btn" style="background-color: #e74c3c; display: none;">‚èπ Zru≈°it</button>
          <button id="retryFailed" class="load-btn retry-btn" style="display: none;">üîÑ Zkusit znovu chyby (<span id="failedCount">0</span>)</button>
        </div>
      </div>

      <div class="info-box">
        ‚ÑπÔ∏è St√°hne roƒçn√≠ statistiky pro v≈°echny vybran√© roky. <strong>Upozornƒõn√≠:</strong> Stahov√°n√≠ m≈Ø≈æe trvat nƒõkolik minut (cca 1-2 sekundy na rok).
      </div>

      <!-- SEKCE PRO DOPLNƒöN√ç CHYBƒöJ√çC√çCH LET -->
      <div class="controls-section" style="margin-top: 20px; border-top: 2px dashed var(--border-color); padding-top: 20px;">
        <h3 style="margin-bottom: 15px; color: var(--text-primary);">üîÑ Doplnit chybƒõj√≠c√≠ roky do existuj√≠c√≠ho souboru</h3>
        <div class="search-form">
          <div class="search-group" style="flex: 2;">
            <h3>üìÅ Naƒç√≠st existuj√≠c√≠ JSON</h3>
            <input type="file" id="importExistingJson" class="search-input" accept=".json" style="padding: 6px;">
          </div>
          <button id="loadAndDetectMissing" class="load-btn">üîç Analyzovat</button>
        </div>

        <div id="mergeInfo" class="info-box" style="display: none; margin-top: 15px; background-color: var(--card-bg);">
          <div id="loadedFileInfo"></div>
        </div>

        <div id="missingYearsSection" style="display: none; margin-top: 15px;">
          <div class="info-box" style="background-color: #fff3cd; border-color: #ffc107;">
            <strong>üìÖ Chybƒõj√≠c√≠ roky:</strong> <span id="missingYearsList"></span>
          </div>
          <div style="margin-top: 10px; display: flex; gap: 10px;">
            <button id="fetchMissingYears" class="load-btn" style="background-color: #28a745;">üì• St√°hnout chybƒõj√≠c√≠ roky</button>
            <button id="cancelMergeDownload" class="load-btn" style="background-color: #e74c3c; display: none;">‚èπ Zru≈°it</button>
          </div>
        </div>

        <div id="noMissingYearsSection" style="display: none; margin-top: 15px;">
          <div class="info-box" style="background-color: #d4edda; border-color: #28a745;">
            ‚úÖ <strong>Data jsou kompletn√≠!</strong> V≈°echny ukonƒçen√© roky jsou ji≈æ obsa≈æeny v souboru.
          </div>
        </div>
      </div>

      <div id="downloadProgress" class="progress-container" style="display: none;">
        <div class="progress-header">
          <span id="progressText">Stahov√°n√≠...</span>
          <span id="progressPercent">0%</span>
        </div>
        <div class="progress-bar">
          <div id="progressFill" class="progress-fill"></div>
        </div>
        <div id="progressDetail" class="progress-detail">P≈ôipravuji...</div>
        <div id="downloadLog" class="download-log"></div>
      </div>

      <div id="export-content">
        <div class="chart-container" id="allYearsTableSection" style="display: none;">
          <div class="table-header">
            <div class="chart-title">üìã Roƒçn√≠ statistiky (<span id="allYearsCount">0</span> let)</div>
            <div style="display: flex; gap: 10px;">
              <button id="exportAllJson" class="export-btn" style="background-color: #3498db;">üìÑ Export JSON</button>
              <button id="exportAllCsv" class="export-btn">üì• Export CSV</button>
            </div>
          </div>
          <div class="table-wrapper" style="max-height: 600px;">
            <table class="data-table">
              <thead>
                <tr>
                  <th>üìÖ Rok</th>
                  <th>üå°Ô∏è Pr≈Øm. ¬∞C</th>
                  <th>üî• Max ¬∞C</th>
                  <th>‚ùÑÔ∏è Min ¬∞C</th>
                  <th>üåßÔ∏è Sr√°≈æky mm</th>
                  <th>‚òÄÔ∏è Slunce h</th>
                  <th>‚òÅÔ∏è Oblaƒç. %</th>
                  <th>üíß Vlhk. %</th>
                  <th>üí® V√≠tr km/h</th>
                  <th>ü•∂ Mraz.</th>
                  <th>‚ùÑÔ∏è Led.</th>
                  <th>üåû Letn√≠</th>
                  <th>üèùÔ∏è Trop.</th>
                </tr>
              </thead>
              <tbody id="allYearsTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- PANEL ANAL√ùZA HISTORIE - KOMPLETNƒö UPRAVEN√ù -->
    <div id="tab-analyze" class="tab-content">
      <div class="controls-section">
        <div class="search-form">
          <div class="search-group" style="flex: 2;">
            <h3>üìÅ Naƒç√≠st soubor s daty</h3>
            <input type="file" id="importFile" class="search-input" accept=".json" style="padding: 6px;">
          </div>
          <button id="loadImportedData" class="load-btn">üìÇ Naƒç√≠st a analyzovat</button>
        </div>
      </div>

      <div class="info-box">
        ‚ÑπÔ∏è Naƒçtƒõte JSON soubor exportovan√Ω z p≈ôedchoz√≠ z√°lo≈æky. Pot√© m≈Ø≈æete analyzovat dlouhodob√© trendy a statistiky.
      </div>

      <div id="analyze-content" style="display: none;">
        <!-- HLAVIƒåKA ANAL√ùZY -->
        <div class="analyze-section-header">
          <h2>üìä Anal√Ωza historick√Ωch klimatick√Ωch dat</h2>
          <p id="analyzePeriod"></p>
        </div>

        <!-- INFORMACE O KVALITƒö DAT -->
        <div class="data-quality-info" id="dataQualityInfo" style="display: none;">
          <div class="data-quality-header">
            <span>üìã Informace o kvalitƒõ dat</span>
          </div>
          <div id="dataQualityContent"></div>
        </div>

        <!-- HLAVN√ç STATISTIKY S VYSVƒöTLIVKAMI -->
        <div class="analyze-section-header">
          <h2>üìà Souhrnn√© statistiky</h2>
          <p>Kl√≠ƒçov√© ukazatele za cel√© analyzovan√© obdob√≠</p>
        </div>

        <div class="analyze-stat-grid" id="analyzeMainStats"></div>

        <!-- DETAILN√ç ANAL√ùZA -->
        <div class="analyze-section-header">
          <h2>üìä Detailn√≠ anal√Ωza</h2>
          <p>Extr√©mn√≠ hodnoty a dlouhodob√© trendy</p>
        </div>

        <div class="analyze-detail-grid">
          <div class="analyze-detail-card">
            <div class="detail-card-header">
              <div class="detail-card-title">üå°Ô∏è Teplotn√≠ rekordy</div>
              <button class="info-btn" data-tooltip="temperature-extremes">i</button>
              <div class="info-tooltip" id="tooltip-temperature-extremes">
                <div class="tooltip-title">Teplotn√≠ extr√©my</div>
                <div class="tooltip-content">
                  Zobrazuje absolutn√≠ maxim√°ln√≠ a minim√°ln√≠ teploty zaznamenan√© v analyzovan√©m obdob√≠, 
                  spolu s roky s nejvy≈°≈°√≠ a nejni≈æ≈°√≠ pr≈Ømƒõrnou roƒçn√≠ teplotou.
                </div>
              </div>
            </div>
            <div id="analyzeTempExtremes" class="extremes-list"></div>
          </div>

          <div class="analyze-detail-card">
            <div class="detail-card-header">
              <div class="detail-card-title">üåßÔ∏è Sr√°≈ækov√© rekordy</div>
              <button class="info-btn" data-tooltip="precipitation-extremes">i</button>
              <div class="info-tooltip" id="tooltip-precipitation-extremes">
                <div class="tooltip-title">Sr√°≈ækov√© extr√©my</div>
                <div class="tooltip-content">
                  Zobrazuje roky s nejvy≈°≈°√≠mi a nejni≈æ≈°√≠mi celkov√Ωmi sr√°≈ækami, 
                  vƒçetnƒõ poƒçtu dn≈Ø se sr√°≈ækami a dn√≠ se snƒõhovou pokr√Ωvkou.
                </div>
              </div>
            </div>
            <div id="analyzePrecipExtremes" class="extremes-list"></div>
          </div>

          <div class="analyze-detail-card">
            <div class="detail-card-header">
              <div class="detail-card-title">üìà Klimatick√© trendy</div>
              <button class="info-btn" data-tooltip="climate-trends">i</button>
              <div class="info-tooltip" id="tooltip-climate-trends">
                <div class="tooltip-title">Dlouhodob√© trendy</div>
                <div class="tooltip-content">
                  V√Ωpoƒçet line√°rn√≠ho trendu za dek√°du (10 let). Kladn√© hodnoty znaƒç√≠ n√°r≈Øst, 
                  z√°porn√© pokles. Trendy jsou vypoƒç√≠t√°ny pomoc√≠ line√°rn√≠ regrese.
                </div>
              </div>
            </div>
            <div id="analyzeTrends" class="trends-list"></div>
          </div>
        </div>

        <!-- GRAFY -->
        <div class="analyze-chart-container">
          <div class="analyze-chart-header">
            <div>
              <div class="analyze-chart-title">üå°Ô∏è V√Ωvoj pr≈Ømƒõrn√© roƒçn√≠ teploty</div>
              <div class="analyze-chart-description">
                ƒåern√° ƒç√°ra zn√°zor≈àuje 5let√Ω klouzav√Ω pr≈Ømƒõr pro vyhlazen√≠ kr√°tkodob√Ωch v√Ωkyv≈Ø
              </div>
            </div>
            <button class="info-btn" data-tooltip="temperature-chart">i</button>
            <div class="info-tooltip" id="tooltip-temperature-chart">
              <div class="tooltip-title">Graf teplotn√≠ho v√Ωvoje</div>
              <div class="tooltip-content">
                Zobrazuje roƒçn√≠ pr≈Ømƒõrn√© teploty a jejich 5let√Ω klouzav√Ω pr≈Ømƒõr. 
                Klouzav√Ω pr≈Ømƒõr pom√°h√° identifikovat dlouhodob√© trendy t√≠m, ≈æe vyhlad√≠ 
                kr√°tkodob√© v√Ωkyvy zp≈Øsoben√© p≈ôirozenou variabilitou poƒças√≠.
              </div>
            </div>
          </div>
          <div class="chart-wrapper tall">
            <canvas id="analyzeTempChart"></canvas>
          </div>
        </div>

        <div class="analyze-chart-container">
          <div class="analyze-chart-header">
            <div>
              <div class="analyze-chart-title">üåßÔ∏è V√Ωvoj roƒçn√≠ch sr√°≈æek</div>
              <div class="analyze-chart-description">
                Celkov√© roƒçn√≠ sr√°≈æky v milimetrech
              </div>
            </div>
            <button class="info-btn" data-tooltip="precipitation-chart">i</button>
            <div class="info-tooltip" id="tooltip-precipitation-chart">
              <div class="tooltip-title">Graf sr√°≈ækov√©ho v√Ωvoje</div>
              <div class="tooltip-content">
                Zobrazuje celkov√© roƒçn√≠ sr√°≈æky. Vysok√° variabilita mezi roky je norm√°ln√≠ 
                pro vƒõt≈°inu klimatick√Ωch z√≥n. Dlouhodob√© trendy mohou naznaƒçovat zmƒõny 
                v sr√°≈ækov√Ωch vzorc√≠ch.
              </div>
            </div>
          </div>
          <div class="chart-wrapper">
            <canvas id="analyzePrecipChart"></canvas>
          </div>
        </div>

        <div class="analyze-chart-container">
          <div class="analyze-chart-header">
            <div>
              <div class="analyze-chart-title">üìä V√Ωvoj poƒçtu speci√°ln√≠ch dn≈Ø</div>
              <div class="analyze-chart-description">
                Letn√≠ dny (‚â•25¬∞C), tropick√© dny (‚â•30¬∞C), mrazov√© dny (<0¬∞C), ledov√© dny (max<0¬∞C)
              </div>
            </div>
            <button class="info-btn" data-tooltip="special-days-chart">i</button>
            <div class="info-tooltip" id="tooltip-special-days-chart">
              <div class="tooltip-title">Graf speci√°ln√≠ch dn≈Ø</div>
              <div class="tooltip-content">
                Sleduje v√Ωskyt dn≈Ø s extr√©mn√≠mi teplotn√≠mi charakteristikami. 
                Tyto ukazatele jsou citliv√© na zmƒõny klimatu a mohou vykazovat 
                v√Ωznamn√© trendy i p≈ôi relativnƒõ mal√Ωch zmƒõn√°ch pr≈Ømƒõrn√© teploty.
              </div>
            </div>
          </div>
          <div class="chart-wrapper tall">
            <canvas id="analyzeDaysChart"></canvas>
          </div>
        </div>

        <!-- DEK√ÅDN√ç POROVN√ÅN√ç -->
        <div class="decade-comparison-container">
          <div class="analyze-chart-header">
            <div>
              <div class="analyze-chart-title">üìâ Dek√°dn√≠ porovn√°n√≠</div>
              <div class="analyze-chart-description">
                Pr≈Ømƒõrn√© hodnoty za jednotliv√© dek√°dy pro snadn√© porovn√°n√≠ dlouhodob√Ωch zmƒõn
              </div>
            </div>
            <button class="info-btn" data-tooltip="decade-comparison">i</button>
            <div class="info-tooltip" id="tooltip-decade-comparison">
              <div class="tooltip-title">Dek√°dn√≠ anal√Ωza</div>
              <div class="tooltip-content">
                Porovn√°v√° klimatick√© charakteristiky po desetilet√≠ch. Tato agregace 
                pom√°h√° identifikovat dlouhodob√© trendy a zmƒõny, kter√© mohou b√Ωt 
                maskov√°ny vysokou meziroƒçn√≠ variabilitou.
              </div>
            </div>
          </div>
          <div id="decadeComparison" class="decade-grid"></div>
        </div>

        <!-- ===== POKROƒåIL√Å STATISTICK√Å ANAL√ùZA ===== -->
        
        <!-- STATISTICK√Å VARIABILITA -->
        <div class="pro-section">
          <div class="pro-section-header">
            <div>
              <div class="pro-section-title">üìä Statistick√° variabilita</div>
              <div class="pro-section-subtitle">Rozptyl a percentily kl√≠ƒçov√Ωch veliƒçin</div>
            </div>
            <button class="info-btn" data-tooltip="statistical-variability">i</button>
            <div class="info-tooltip" id="tooltip-statistical-variability">
              <div class="tooltip-title">Statistick√° variabilita</div>
              <div class="tooltip-content">
                Smƒõrodatn√° odchylka (œÉ) mƒõ≈ô√≠ rozptyl hodnot kolem pr≈Ømƒõru. Variaƒçn√≠ koeficient (CV) 
                vyjad≈ôuje relativn√≠ variabilitu jako procento pr≈Ømƒõru - umo≈æ≈àuje srovn√°n√≠ r≈Øzn√Ωch veliƒçin.
                Percentily ukazuj√≠ rozlo≈æen√≠ hodnot (P10 = 10% nejni≈æ≈°√≠ch hodnot je pod touto hranic√≠).
              </div>
            </div>
          </div>
          <div id="statisticalVariability"></div>
        </div>

        <!-- KLIMATICK√â INDEXY -->
        <div class="pro-section">
          <div class="pro-section-header">
            <div>
              <div class="pro-section-title">üåç Klimatick√© indexy</div>
              <div class="pro-section-subtitle">Standardizovan√© ukazatele charakteru klimatu</div>
            </div>
            <button class="info-btn" data-tooltip="climate-indices">i</button>
            <div class="info-tooltip" id="tooltip-climate-indices">
              <div class="tooltip-title">Klimatick√© indexy</div>
              <div class="tooltip-content">
                <strong>Index kontinentality (Gorczy≈Ñski):</strong> M√≠ra vnitrozemsk√©ho charakteru klimatu (0-100). 
                Vy≈°≈°√≠ hodnoty = vƒõt≈°√≠ teplotn√≠ rozd√≠ly l√©to/zima.<br><br>
                <strong>Index aridity (De Martonne):</strong> Pomƒõr sr√°≈æek k teplotƒõ. Klasifikace: 
                &lt;10 = aridn√≠, 10-20 = semi-aridn√≠, 20-30 = sub-humidn√≠, &gt;30 = humidn√≠.
              </div>
            </div>
          </div>
          <div id="climateIndices" class="compact-stats-grid"></div>
        </div>

        <!-- SEZ√ìNN√ç CHARAKTERISTIKY -->
        <div class="pro-section">
          <div class="pro-section-header">
            <div>
              <div class="pro-section-title">üçÇ Sez√≥nn√≠ charakteristiky</div>
              <div class="pro-section-subtitle">Pr≈Ømƒõrn√© hodnoty pro jednotliv√° roƒçn√≠ obdob√≠</div>
            </div>
            <button class="info-btn" data-tooltip="seasonal-analysis">i</button>
            <div class="info-tooltip" id="tooltip-seasonal-analysis">
              <div class="tooltip-title">Sez√≥nn√≠ anal√Ωza</div>
              <div class="tooltip-content">
                Meteorologick√© roƒçn√≠ obdob√≠: Jaro (III-V), L√©to (VI-VIII), Podzim (IX-XI), Zima (XII-II).
                Teplotn√≠ amplituda ukazuje rozd√≠l mezi nejteplej≈°√≠m a nejchladnƒõj≈°√≠m mƒõs√≠cem - 
                indik√°tor kontinentality klimatu.
              </div>
            </div>
          </div>
          <div id="seasonalAnalysis" class="season-grid"></div>
        </div>

        <!-- VEGETAƒåN√ç OBDOB√ç -->
        <div class="pro-section">
          <div class="pro-section-header">
            <div>
              <div class="pro-section-title">üå± Vegetaƒçn√≠ obdob√≠</div>
              <div class="pro-section-subtitle">D√©lka obdob√≠ p≈ô√≠zniv√©ho pro r≈Øst rostlin</div>
            </div>
            <button class="info-btn" data-tooltip="vegetation-period">i</button>
            <div class="info-tooltip" id="tooltip-vegetation-period">
              <div class="tooltip-title">Vegetaƒçn√≠ obdob√≠</div>
              <div class="tooltip-content">
                <strong>Vegetaƒçn√≠ obdob√≠:</strong> Poƒçet dn≈Ø s pr≈Ømƒõrnou teplotou ‚â•5¬∞C (nƒõkter√© zdroje pou≈æ√≠vaj√≠ 10¬∞C).<br><br>
                <strong>GDD (Growing Degree Days):</strong> Suma denn√≠ch teplot nad 5¬∞C - ukazatel tepeln√© 
                disponibility pro vegetaci. D≈Øle≈æit√© pro zemƒõdƒõlstv√≠.<br><br>
                <strong>Bezmrazov√© obdob√≠:</strong> Poƒçet dn≈Ø mezi posledn√≠m jarn√≠m a prvn√≠m podzimn√≠m mrazem.
              </div>
            </div>
          </div>
          <div id="vegetationPeriod"></div>
        </div>

        <!-- POKROƒåIL√Å ANAL√ùZA TREND≈Æ -->
        <div class="pro-section">
          <div class="pro-section-header">
            <div>
              <div class="pro-section-title">üìà Pokroƒçil√° anal√Ωza trend≈Ø</div>
              <div class="pro-section-subtitle">Statistick√° v√Ωznamnost a spolehlivost trend≈Ø</div>
            </div>
            <button class="info-btn" data-tooltip="advanced-trends">i</button>
            <div class="info-tooltip" id="tooltip-advanced-trends">
              <div class="tooltip-title">Pokroƒçil√° anal√Ωza trend≈Ø</div>
              <div class="tooltip-content">
                <strong>R¬≤ (koeficient determinace):</strong> Pod√≠l variability vysvƒõtlen√Ω trendem (0-1). 
                Hodnota 0.3+ naznaƒçuje v√Ωznamn√Ω trend.<br><br>
                <strong>Mann-Kendall test:</strong> Neparametrick√Ω test trendu. Hodnota Z &gt;1.96 nebo &lt;-1.96 
                indikuje statisticky v√Ωznamn√Ω trend (p &lt; 0.05).<br><br>
                <strong>Sen's slope:</strong> Robustn√≠ odhad trendu odoln√Ω v≈Øƒçi odlehl√Ωm hodnot√°m.
              </div>
            </div>
          </div>
          <div id="advancedTrends"></div>
        </div>

        <!-- SR√Å≈ΩKOV√Å ANAL√ùZA -->
        <div class="pro-section">
          <div class="pro-section-header">
            <div>
              <div class="pro-section-title">üíß Podrobn√° sr√°≈ækov√° anal√Ωza</div>
              <div class="pro-section-subtitle">Charakteristiky sr√°≈ækov√©ho re≈æimu a extr√©m≈Ø</div>
            </div>
            <button class="info-btn" data-tooltip="precipitation-analysis">i</button>
            <div class="info-tooltip" id="tooltip-precipitation-analysis">
              <div class="tooltip-title">Sr√°≈ækov√° anal√Ωza</div>
              <div class="tooltip-content">
                <strong>SPI (Standardized Precipitation Index):</strong> Standardizovan√Ω sr√°≈ækov√Ω index. 
                Hodnoty: &gt;2 = extr√©mnƒõ vlhko, 1-2 = velmi vlhko, -1 a≈æ 1 = norm√°ln√≠, -2 a≈æ -1 = sucho, &lt;-2 = extr√©mn√≠ sucho.<br><br>
                <strong>Sr√°≈ækov√° intenzita:</strong> Pr≈Ømƒõrn√© sr√°≈æky na sr√°≈ækov√Ω den.<br><br>
                <strong>Such√©/vlhk√© roky:</strong> Roky s odchylkou &gt;20% od pr≈Ømƒõru.
              </div>
            </div>
          </div>
          <div id="precipitationAnalysis"></div>
        </div>

        <!-- KLIMATICK√ù NORM√ÅL -->
        <div class="pro-section">
          <div class="pro-section-header">
            <div>
              <div class="pro-section-title">üìã Klimatick√Ω norm√°l (referenƒçn√≠ obdob√≠)</div>
              <div class="pro-section-subtitle">Porovn√°n√≠ s 30let√Ωmi pr≈Ømƒõry dle WMO</div>
            </div>
            <button class="info-btn" data-tooltip="climate-normal">i</button>
            <div class="info-tooltip" id="tooltip-climate-normal">
              <div class="tooltip-title">Klimatick√Ω norm√°l</div>
              <div class="tooltip-content">
                Svƒõtov√° meteorologick√° organizace (WMO) definuje klimatick√Ω norm√°l jako 30let√Ω pr≈Ømƒõr.
                Aktu√°ln√≠ referenƒçn√≠ obdob√≠ je 1991-2020. Pokud data zahrnuj√≠ toto obdob√≠, zobraz√≠ se 
                porovn√°n√≠ aktu√°ln√≠ch hodnot s norm√°lem a odchylky.
              </div>
            </div>
          </div>
          <div id="climateNormal"></div>
        </div>

      </div>
    </div>

    <!-- PANEL DEK√ÅDN√ç ZMƒöNY -->
    <div id="tab-decades" class="tab-content">
      <div class="controls-section">
        <div class="search-form">
          <div class="search-group" style="flex: 2;">
            <h3>üìÅ Naƒç√≠st soubor s daty</h3>
            <input type="file" id="importFileDecades" class="search-input" accept=".json" style="padding: 6px;">
          </div>
          <button id="loadDecadesData" class="load-btn">üìÇ Naƒç√≠st a analyzovat dek√°dy</button>
        </div>
      </div>

      <div class="info-box">
        ‚ÑπÔ∏è Naƒçtƒõte JSON soubor s historick√Ωmi daty. Tato z√°lo≈æka se zamƒõ≈ôuje na <strong>zmƒõny mezi jednotliv√Ωmi dek√°dami</strong> (desetilet√≠mi) a umo≈æ≈àuje sledovat dlouhodob√© klimatick√© trendy.
      </div>

      <div id="decades-content" style="display: none;">
        <!-- HLAVIƒåKA -->
        <div class="analyze-section-header">
          <h2>üìâ Dek√°dn√≠ anal√Ωza klimatick√Ωch zmƒõn</h2>
          <p id="decadesPeriod"></p>
        </div>

        <!-- P≈òEHLED DEK√ÅD -->
        <div class="pro-section">
          <div class="pro-section-header">
            <div>
              <div class="pro-section-title">üìä P≈ôehled dek√°d</div>
              <div class="pro-section-subtitle">Poƒçet let dat v jednotliv√Ωch dek√°d√°ch</div>
            </div>
          </div>
          <div id="decadesOverview" class="decade-overview-grid"></div>
        </div>

        <!-- TEPLOTN√ç ZMƒöNY MEZI DEK√ÅDAMI -->
        <div class="pro-section">
          <div class="pro-section-header">
            <div>
              <div class="pro-section-title">üå°Ô∏è Teplotn√≠ zmƒõny mezi dek√°dami</div>
              <div class="pro-section-subtitle">Pr≈Ømƒõrn√© teploty a jejich zmƒõny v ƒçase</div>
            </div>
          </div>
          <div id="decadesTempChanges"></div>
          <div class="chart-wrapper tall" style="margin-top: 20px;">
            <canvas id="decadesTempChart"></canvas>
          </div>
        </div>

        <!-- SR√Å≈ΩKOV√â ZMƒöNY MEZI DEK√ÅDAMI -->
        <div class="pro-section">
          <div class="pro-section-header">
            <div>
              <div class="pro-section-title">üåßÔ∏è Sr√°≈ækov√© zmƒõny mezi dek√°dami</div>
              <div class="pro-section-subtitle">Pr≈Ømƒõrn√© roƒçn√≠ sr√°≈æky a jejich zmƒõny</div>
            </div>
          </div>
          <div id="decadesPrecipChanges"></div>
          <div class="chart-wrapper" style="margin-top: 20px;">
            <canvas id="decadesPrecipChart"></canvas>
          </div>
        </div>

        <!-- ZMƒöNY EXTR√âMN√çCH DN≈Æ -->
        <div class="pro-section">
          <div class="pro-section-header">
            <div>
              <div class="pro-section-title">üî• Zmƒõny v poƒçtu extr√©mn√≠ch dn≈Ø</div>
              <div class="pro-section-subtitle">Letn√≠, tropick√©, mrazov√© a ledov√© dny</div>
            </div>
          </div>
          <div id="decadesExtremeDays"></div>
          <div class="chart-wrapper tall" style="margin-top: 20px;">
            <canvas id="decadesExtremeDaysChart"></canvas>
          </div>
        </div>

        <!-- SROVN√ÅVAC√ç TABULKA DEK√ÅD -->
        <div class="pro-section">
          <div class="pro-section-header">
            <div>
              <div class="pro-section-title">üìã Kompletn√≠ srovn√°n√≠ dek√°d</div>
              <div class="pro-section-subtitle">V≈°echny kl√≠ƒçov√© ukazatele v p≈ôehledn√© tabulce</div>
            </div>
          </div>
          <div class="table-wrapper" style="max-height: 500px;">
            <table class="data-table" id="decadesComparisonTable">
              <thead>
                <tr>
                  <th>Dek√°da</th>
                  <th>üå°Ô∏è Pr≈Øm. ¬∞C</th>
                  <th>Œî ¬∞C</th>
                  <th>üåßÔ∏è Sr√°≈æky mm</th>
                  <th>Œî mm</th>
                  <th>‚òÄÔ∏è Slunce h</th>
                  <th>üåû Letn√≠ dny</th>
                  <th>üèùÔ∏è Trop. dny</th>
                  <th>ü•∂ Mraz. dny</th>
                  <th>‚ùÑÔ∏è Led. dny</th>
                </tr>
              </thead>
              <tbody id="decadesTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- KLIMATICK√ù POSUN -->
        <div class="pro-section">
          <div class="pro-section-header">
            <div>
              <div class="pro-section-title">üåç Klimatick√Ω posun</div>
              <div class="pro-section-subtitle">Porovn√°n√≠ prvn√≠ a posledn√≠ dek√°dy v datech</div>
            </div>
          </div>
          <div id="climateShift"></div>
        </div>

        <!-- GRAF TREND≈Æ NAP≈ò√çƒå DEK√ÅDAMI -->
        <div class="pro-section">
          <div class="pro-section-header">
            <div>
              <div class="pro-section-title">üìà Trendy nap≈ô√≠ƒç dek√°dami</div>
              <div class="pro-section-subtitle">Vizualizace zmƒõn kl√≠ƒçov√Ωch ukazatel≈Ø</div>
            </div>
          </div>
          <div class="chart-wrapper tall">
            <canvas id="decadesTrendsChart"></canvas>
          </div>
        </div>

      </div>
    </div>
  </div>

  <div id="hourlyTooltip" class="hourly-tooltip">
    <div class="hourly-tooltip-header">
      <span id="tooltipTitle" class="hourly-tooltip-title">üïê Detail</span>
      <span id="tooltipSummary" class="hourly-tooltip-summary"></span>
    </div>
    <div class="hourly-chart-wrapper">
      <canvas id="hourlyChart"></canvas>
    </div>
    <div class="hourly-tooltip-hint">Hodinov√Ω pr≈Øbƒõh</div>
  </div>

  <script>
    // Glob√°ln√≠ promƒõnn√©
    let charts = {};
    let currentLocationData = null;
    let searchTimeout = null;
    let currentSuggestions = [];
    let selectedSuggestionIndex = -1;
    let activeTab = 'day';
    
    // Data storage
    let dayData = null;
    let monthData = null;
    let yearData = null;
    let allYearsData = [];
    let importedData = null;
    let downloadCancelled = false;
    let failedYears = []; // Glob√°ln√≠ pole pro ne√∫spƒõ≈°n√© roky

    // Inicializace
    document.addEventListener('DOMContentLoaded', () => {
      initYearSelects();
      initDateInput();
      initTabs();
      initLocationInputs();
      loadSavedLocation();

      document.getElementById('loadDay').addEventListener('click', loadDayData);
      document.getElementById('loadMonth').addEventListener('click', loadMonthData);
      document.getElementById('loadYear').addEventListener('click', loadYearData);
      document.getElementById('loadAllYears').addEventListener('click', loadAllYearsData);
      document.getElementById('retryFailed').addEventListener('click', retryFailedDownloads); // Listener pro nov√© tlaƒç√≠tko
      document.getElementById('cancelDownload').addEventListener('click', cancelDownload);
      document.getElementById('exportAllJson').addEventListener('click', exportAllYearsJson);
      document.getElementById('exportAllCsv').addEventListener('click', exportAllYearsCsv);
      document.getElementById('loadAndDetectMissing').addEventListener('click', loadAndDetectMissingYears);
      document.getElementById('fetchMissingYears').addEventListener('click', fetchMissingYearsData);
      document.getElementById('cancelMergeDownload').addEventListener('click', cancelMergeDownload);
      document.getElementById('loadImportedData').addEventListener('click', loadImportedFile);
      document.getElementById('loadDecadesData').addEventListener('click', loadDecadesFile);

      document.getElementById('exportDayCsv').addEventListener('click', () => exportCsv('day'));
      document.getElementById('exportMonthCsv').addEventListener('click', () => exportCsv('month'));
    });

    // Inicializace z√°lo≈æek
    function initTabs() {
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          
          btn.classList.add('active');
          activeTab = btn.dataset.tab;
          document.getElementById(`tab-${activeTab}`).classList.add('active');
        });
      });
    }

    // Inicializace v√Ωbƒõru rok≈Ø
    function initYearSelects() {
      const currentYear = new Date().getFullYear();
      const currentMonth = new Date().getMonth() + 1;
      
      ['month', 'year'].forEach(type => {
        const select = document.getElementById(`year-${type}`);
        for (let y = currentYear; y >= 1940; y--) {
          const option = document.createElement('option');
          option.value = y;
          option.textContent = y;
          select.appendChild(option);
        }
        
        if (type === 'month') {
          if (currentMonth === 1) {
            select.value = currentYear - 1;
            document.getElementById('month-month').value = 12;
          } else {
            select.value = currentYear;
            document.getElementById('month-month').value = currentMonth - 1;
          }
        } else {
          select.value = currentYear - 1;
        }
      });

      // Export selecty
      const startSelect = document.getElementById('year-export-start');
      const endSelect = document.getElementById('year-export-end');
      
      for (let y = currentYear - 1; y >= 1940; y--) {
        const opt1 = document.createElement('option');
        opt1.value = y;
        opt1.textContent = y;
        startSelect.appendChild(opt1);
        
        const opt2 = document.createElement('option');
        opt2.value = y;
        opt2.textContent = y;
        endSelect.appendChild(opt2);
      }
      
      startSelect.value = 1940;
      endSelect.value = currentYear - 1;
    }

    // Inicializace datumov√©ho inputu
    function initDateInput() {
      const dateInput = document.getElementById('date-day');
      const today = new Date();
      const yesterday = new Date(today);
      yesterday.setDate(yesterday.getDate() - 1);
      
      dateInput.max = yesterday.toISOString().split('T')[0];
      dateInput.min = '1940-01-01';
      dateInput.value = yesterday.toISOString().split('T')[0];
    }

    // Inicializace vyhled√°v√°n√≠ lokac√≠
    function initLocationInputs() {
      document.querySelectorAll('.location-input').forEach(input => {
        const type = input.id.split('-')[1];
        
        input.addEventListener('input', function() {
          clearTimeout(searchTimeout);
          const query = this.value.trim();
          
          if (query.length >= 2) {
            searchTimeout = setTimeout(async () => {
              const suggestions = await searchLocations(query);
              displaySuggestions(suggestions, type);
            }, 300);
          } else {
            document.getElementById(`suggestions-${type}`).classList.remove('show');
          }
        });

        input.addEventListener('keydown', function(e) {
          const suggestionsDiv = document.getElementById(`suggestions-${type}`);
          
          if (e.key === 'ArrowDown') {
            e.preventDefault();
            highlightSuggestion(Math.min(selectedSuggestionIndex + 1, currentSuggestions.length - 1), type);
          } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            highlightSuggestion(Math.max(selectedSuggestionIndex - 1, -1), type);
          } else if (e.key === 'Enter') {
            e.preventDefault();
            if (selectedSuggestionIndex >= 0) {
              selectSuggestion(selectedSuggestionIndex, type);
            }
          } else if (e.key === 'Escape') {
            suggestionsDiv.classList.remove('show');
          }
        });
      });

      document.addEventListener('click', function(e) {
        if (!e.target.classList.contains('location-input')) {
          document.querySelectorAll('.suggestions').forEach(s => s.classList.remove('show'));
        }
      });
    }

    // Vyhled√°v√°n√≠ lokac√≠
    async function searchLocations(query) {
      try {
        const response = await fetch(
          `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(query)}&count=5&language=cs&format=json`
        );
        const data = await response.json();
        return data.results || [];
      } catch (error) {
        console.error('Chyba p≈ôi vyhled√°v√°n√≠:', error);
        return [];
      }
    }

    function displaySuggestions(suggestions, type) {
      const suggestionsDiv = document.getElementById(`suggestions-${type}`);
      currentSuggestions = suggestions;
      selectedSuggestionIndex = -1;

      if (suggestions.length === 0) {
        suggestionsDiv.classList.remove('show');
        return;
      }

      suggestionsDiv.innerHTML = suggestions.map((loc, index) => `
        <div class="suggestion-item" data-index="${index}">
          <div class="suggestion-name">${loc.name}</div>
          <div class="suggestion-details">${[loc.admin1, loc.country].filter(Boolean).join(', ')}</div>
        </div>
      `).join('');

      suggestionsDiv.classList.add('show');

      suggestionsDiv.querySelectorAll('.suggestion-item').forEach(item => {
        item.addEventListener('click', () => selectSuggestion(parseInt(item.dataset.index), type));
      });
    }

    function selectSuggestion(index, type) {
      const suggestion = currentSuggestions[index];
      if (!suggestion) return;

      currentLocationData = {
        name: suggestion.name,
        lat: suggestion.latitude,
        lon: suggestion.longitude,
        country: suggestion.country
      };

      localStorage.setItem('lastLocation', JSON.stringify(currentLocationData));
      
      // Aktualizace v≈°ech input≈Ø
      document.querySelectorAll('.location-input').forEach(input => {
        input.value = `${suggestion.name}, ${suggestion.country}`;
      });
      
      document.getElementById(`suggestions-${type}`).classList.remove('show');
    }

    function loadSavedLocation() {
      try {
        const saved = localStorage.getItem('lastLocation');
        if (saved) {
          currentLocationData = JSON.parse(saved);
          document.querySelectorAll('.location-input').forEach(input => {
            input.value = `${currentLocationData.name}, ${currentLocationData.country}`;
          });
        }
      } catch (e) {
        console.error('Chyba p≈ôi naƒç√≠t√°n√≠ ulo≈æen√© polohy:', e);
      }
    }

    function highlightSuggestion(index, type) {
      selectedSuggestionIndex = index;
      document.querySelectorAll(`#suggestions-${type} .suggestion-item`).forEach((item, i) => {
        item.classList.toggle('selected', i === index);
      });
    }

    // ===== NAƒå√çT√ÅN√ç DAT =====

    // Den
    async function loadDayData() {
      if (!currentLocationData) {
        showNotification('Nejprve vyberte lokalitu', 'warning');
        return;
      }

      const date = document.getElementById('date-day').value;
      if (!date) {
        showNotification('Vyberte datum', 'warning');
        return;
      }

      const today = new Date();
      today.setHours(0, 0, 0, 0);
      if (new Date(date) >= today) {
        showNotification('Datum mus√≠ b√Ωt v minulosti', 'warning');
        return;
      }

      const btn = document.getElementById('loadDay');
      btn.disabled = true;
      btn.textContent = '‚è≥ Naƒç√≠t√°m...';

      try {
        const url = `https://archive-api.open-meteo.com/v1/archive?` +
          `latitude=${currentLocationData.lat}&longitude=${currentLocationData.lon}` +
          `&start_date=${date}&end_date=${date}` +
          `&hourly=temperature_2m,relative_humidity_2m,precipitation,cloud_cover,wind_speed_10m` +
          `&daily=temperature_2m_max,temperature_2m_min,temperature_2m_mean,precipitation_sum,sunshine_duration` +
          `&timezone=Europe/Prague`;

        const response = await fetch(url);
        const data = await response.json();

        if (data.error) throw new Error(data.reason || 'Chyba API');

        dayData = data;
        renderDayCharts(data);
        renderDayStats(data);
        renderDayTable(data);
        
        showNotification('Data √∫spƒõ≈°nƒõ naƒçtena', 'success');
      } catch (error) {
        console.error('Chyba:', error);
        showNotification(`Chyba: ${error.message}`, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'üîç Naƒç√≠st';
      }
    }

    // Mƒõs√≠c
    async function loadMonthData() {
      if (!currentLocationData) {
        showNotification('Nejprve vyberte lokalitu', 'warning');
        return;
      }

      const year = parseInt(document.getElementById('year-month').value);
      const month = parseInt(document.getElementById('month-month').value);
      const daysInMonth = new Date(year, month, 0).getDate();
      
      const startDate = `${year}-${String(month).padStart(2, '0')}-01`;
      const endDate = `${year}-${String(month).padStart(2, '0')}-${String(daysInMonth).padStart(2, '0')}`;

      const today = new Date();
      if (new Date(endDate) > today) {
        showNotification('Vybran√© obdob√≠ je v budoucnosti', 'warning');
        return;
      }

      const btn = document.getElementById('loadMonth');
      btn.disabled = true;
      btn.textContent = '‚è≥ Naƒç√≠t√°m...';

      try {
        const url = `https://archive-api.open-meteo.com/v1/archive?` +
          `latitude=${currentLocationData.lat}&longitude=${currentLocationData.lon}` +
          `&start_date=${startDate}&end_date=${endDate}` +
          `&daily=temperature_2m_max,temperature_2m_min,temperature_2m_mean,precipitation_sum,rain_sum,snowfall_sum,sunshine_duration` +
          `&hourly=temperature_2m,relative_humidity_2m,precipitation,cloud_cover,wind_speed_10m` +
          `&timezone=Europe/Prague`;

        const response = await fetch(url);
        const data = await response.json();

        if (data.error) throw new Error(data.reason || 'Chyba API');

        monthData = data;
        renderMonthCharts(data, year, month);
        renderMonthStats(data);
        renderMonthTable(data);
        
        const monthNames = ['ledna', '√∫nora', 'b≈ôezna', 'dubna', 'kvƒõtna', 'ƒçervna', 
                          'ƒçervence', 'srpna', 'z√°≈ô√≠', '≈ô√≠jna', 'listopadu', 'prosince'];
        document.getElementById('monthPeriod').textContent = 
          `üìç ${currentLocationData.name} ‚Ä¢ ${monthNames[month-1]} ${year}`;

        showNotification('Data √∫spƒõ≈°nƒõ naƒçtena', 'success');
      } catch (error) {
        console.error('Chyba:', error);
        showNotification(`Chyba: ${error.message}`, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'üîç Naƒç√≠st';
      }
    }

    // Rok
    async function loadYearData() {
      if (!currentLocationData) {
        showNotification('Nejprve vyberte lokalitu', 'warning');
        return;
      }

      const year = parseInt(document.getElementById('year-year').value);
      const currentYear = new Date().getFullYear();
      
      let endDate;
      if (year === currentYear) {
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        endDate = yesterday.toISOString().split('T')[0];
      } else {
        endDate = `${year}-12-31`;
      }
      
      const startDate = `${year}-01-01`;

      const btn = document.getElementById('loadYear');
      btn.disabled = true;
      btn.textContent = '‚è≥ Naƒç√≠t√°m...';

      try {
        const url = `https://archive-api.open-meteo.com/v1/archive?` +
          `latitude=${currentLocationData.lat}&longitude=${currentLocationData.lon}` +
          `&start_date=${startDate}&end_date=${endDate}` +
          `&daily=temperature_2m_max,temperature_2m_min,temperature_2m_mean,precipitation_sum,rain_sum,snowfall_sum,sunshine_duration,wind_speed_10m_max` +
          `&hourly=relative_humidity_2m,cloud_cover,wind_speed_10m` +
          `&timezone=Europe/Prague`;

        const response = await fetch(url);
        const data = await response.json();

        if (data.error) throw new Error(data.reason || 'Chyba API');

        yearData = data;
        renderYearCharts(data, year);
        renderYearStats(data);
        
        document.getElementById('yearPeriod').textContent = 
          `üìç ${currentLocationData.name} ‚Ä¢ ${year}`;

        showNotification('Data √∫spƒõ≈°nƒõ naƒçtena', 'success');
      } catch (error) {
        console.error('Chyba:', error);
        showNotification(`Chyba: ${error.message}`, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'üîç Naƒç√≠st';
      }
    }

    // ===== VYKRESLOV√ÅN√ç GRAF≈Æ =====

    // Den - grafy
    function renderDayCharts(data) {
      const hourly = data.hourly;
      const labels = hourly.time.map(t => {
        const d = new Date(t);
        return `${d.getHours()}:00`;
      });

      // Teplotn√≠ graf
      if (charts.dayTemp) charts.dayTemp.destroy();
      const ctx1 = document.getElementById('dayTempChart').getContext('2d');
      
      charts.dayTemp = new Chart(ctx1, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Teplota ¬∞C',
              data: hourly.temperature_2m,
              borderColor: '#ff6b6b',
              backgroundColor: 'rgba(255, 107, 107, 0.1)',
              fill: true,
              tension: 0.4,
              pointRadius: 2
            },
            {
              label: 'Sr√°≈æky mm',
              data: hourly.precipitation,
              type: 'bar',
              backgroundColor: 'rgba(116, 185, 255, 0.5)',
              borderColor: '#74b9ff',
              yAxisID: 'yRain'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { intersect: false, mode: 'index' },
          plugins: {
            legend: { labels: { color: '#e0e0e0' } }
          },
          scales: {
            x: { grid: { color: '#404040' }, ticks: { color: '#888' } },
            y: { 
              grid: { color: '#404040' }, 
              ticks: { color: '#888', callback: v => `${v}¬∞C` }
            },
            yRain: {
              position: 'right',
              grid: { drawOnChartArea: false },
              ticks: { color: '#74b9ff', callback: v => `${v} mm` },
              beginAtZero: true
            }
          }
        }
      });

      // Ostatn√≠ graf
      if (charts.dayOther) charts.dayOther.destroy();
      const ctx2 = document.getElementById('dayOtherChart').getContext('2d');
      
      charts.dayOther = new Chart(ctx2, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Oblaƒçnost %',
              data: hourly.cloud_cover,
              borderColor: '#b2bec3',
              backgroundColor: 'rgba(178, 190, 195, 0.1)',
              fill: true,
              tension: 0.4,
              pointRadius: 1
            },
            {
              label: 'Vlhkost %',
              data: hourly.relative_humidity_2m,
              borderColor: '#a29bfe',
              tension: 0.4,
              pointRadius: 1
            },
            {
              label: 'V√≠tr km/h',
              data: hourly.wind_speed_10m,
              borderColor: '#81ecec',
              tension: 0.4,
              pointRadius: 1,
              yAxisID: 'yWind'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { intersect: false, mode: 'index' },
          plugins: {
            legend: { labels: { color: '#e0e0e0' } }
          },
          scales: {
            x: { grid: { color: '#404040' }, ticks: { color: '#888' } },
            y: { 
              grid: { color: '#404040' }, 
              ticks: { color: '#888', callback: v => `${v}%` },
              max: 100
            },
            yWind: {
              position: 'right',
              grid: { drawOnChartArea: false },
              ticks: { color: '#81ecec', callback: v => `${v} km/h` },
              beginAtZero: true
            }
          }
        }
      });
    }

    // Den - statistiky
    function renderDayStats(data) {
      const hourly = data.hourly;
      const daily = data.daily;
      
      const temps = hourly.temperature_2m.filter(t => t !== null);
      const humidity = hourly.relative_humidity_2m.filter(h => h !== null);
      const clouds = hourly.cloud_cover.filter(c => c !== null);
      const wind = hourly.wind_speed_10m.filter(w => w !== null);
      
      const avgTemp = temps.length ? (temps.reduce((a,b) => a+b, 0) / temps.length).toFixed(1) : '‚Äî';
      const maxTemp = daily.temperature_2m_max[0]?.toFixed(1) || '‚Äî';
      const minTemp = daily.temperature_2m_min[0]?.toFixed(1) || '‚Äî';
      const totalPrecip = daily.precipitation_sum[0]?.toFixed(1) || '0';
      const avgHumidity = humidity.length ? (humidity.reduce((a,b) => a+b, 0) / humidity.length).toFixed(0) : '‚Äî';
      const avgClouds = clouds.length ? (clouds.reduce((a,b) => a+b, 0) / clouds.length).toFixed(0) : '‚Äî';
      const maxWind = wind.length ? Math.max(...wind).toFixed(1) : '‚Äî';
      const sunshine = daily.sunshine_duration ? (daily.sunshine_duration[0] / 3600).toFixed(1) : null;

      let html = `
        <div class="stat-card temp-max">
          <div class="stat-icon">üî•</div>
          <div class="stat-value">${maxTemp}¬∞C</div>
          <div class="stat-label">Maximum</div>
        </div>
        <div class="stat-card temp-min">
          <div class="stat-icon">‚ùÑÔ∏è</div>
          <div class="stat-value">${minTemp}¬∞C</div>
          <div class="stat-label">Minimum</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üå°Ô∏è</div>
          <div class="stat-value">${avgTemp}¬∞C</div>
          <div class="stat-label">Pr≈Ømƒõr</div>
        </div>
        <div class="stat-card rain">
          <div class="stat-icon">üåßÔ∏è</div>
          <div class="stat-value">${totalPrecip} mm</div>
          <div class="stat-label">Sr√°≈æky</div>
        </div>
        <div class="stat-card humidity">
          <div class="stat-icon">üíß</div>
          <div class="stat-value">${avgHumidity}%</div>
          <div class="stat-label">Vlhkost</div>
        </div>
        <div class="stat-card cloud">
          <div class="stat-icon">‚òÅÔ∏è</div>
          <div class="stat-value">${avgClouds}%</div>
          <div class="stat-label">Oblaƒçnost</div>
        </div>
        <div class="stat-card wind">
          <div class="stat-icon">üí®</div>
          <div class="stat-value">${maxWind}</div>
          <div class="stat-label">Max v√≠tr km/h</div>
        </div>
      `;
      
      if (sunshine !== null) {
        html += `
          <div class="stat-card sun">
            <div class="stat-icon">‚òÄÔ∏è</div>
            <div class="stat-value">${sunshine} h</div>
            <div class="stat-label">Slunce</div>
          </div>
        `;
      }

      document.getElementById('dayStats').innerHTML = html;
    }

    // Den - tabulka
    function renderDayTable(data) {
      const hourly = data.hourly;
      let html = '';

      for (let i = 0; i < hourly.time.length; i++) {
        const hour = new Date(hourly.time[i]).getHours().toString().padStart(2, '0') + ':00';
        const temp = hourly.temperature_2m[i];
        const humidity = hourly.relative_humidity_2m[i];
        const precip = hourly.precipitation[i];
        const cloud = hourly.cloud_cover[i];
        const wind = hourly.wind_speed_10m[i];

        html += `<tr>
          <td>${hour}</td>
          <td class="temp-max">${temp !== null ? temp.toFixed(1) : '‚Äî'}</td>
          <td class="humidity">${humidity !== null ? humidity.toFixed(0) : '‚Äî'}</td>
          <td class="precip">${precip !== null ? precip.toFixed(1) : '‚Äî'}</td>
          <td class="cloud">${cloud !== null ? cloud.toFixed(0) : '‚Äî'}</td>
          <td class="wind">${wind !== null ? wind.toFixed(1) : '‚Äî'}</td>
        </tr>`;
      }

      document.getElementById('dayTableBody').innerHTML = html;
      document.getElementById('dayTableSection').style.display = 'block';
    }

    // Mƒõs√≠c - grafy
    function renderMonthCharts(data, year, month) {
      const daily = data.daily;
      const hourly = data.hourly;
      
      const labels = daily.time.map(date => {
        const d = new Date(date);
        return `${d.getDate()}.`;
      });

      // Vypoƒç√≠tat denn√≠ pr≈Ømƒõry z hodinov√Ωch dat
      const daysCount = daily.time.length;
      const dailyAvgCloud = [];
      const dailyAvgHumidity = [];
      const dailyAvgWind = [];

      for (let day = 0; day < daysCount; day++) {
        const startIdx = day * 24;
        const endIdx = startIdx + 24;
        
        const cloudSlice = hourly.cloud_cover.slice(startIdx, endIdx).filter(v => v !== null);
        const humiditySlice = hourly.relative_humidity_2m.slice(startIdx, endIdx).filter(v => v !== null);
        const windSlice = hourly.wind_speed_10m.slice(startIdx, endIdx).filter(v => v !== null);
        
        dailyAvgCloud.push(cloudSlice.length ? cloudSlice.reduce((a,b) => a+b, 0) / cloudSlice.length : null);
        dailyAvgHumidity.push(humiditySlice.length ? humiditySlice.reduce((a,b) => a+b, 0) / humiditySlice.length : null);
        dailyAvgWind.push(windSlice.length ? windSlice.reduce((a,b) => a+b, 0) / windSlice.length : null);
      }

      // Teplotn√≠ graf
      if (charts.monthTemp) charts.monthTemp.destroy();
      const ctx1 = document.getElementById('monthTempChart').getContext('2d');
      
      const rainData = daily.rain_sum || daily.precipitation_sum;
      const hasSnow = daily.snowfall_sum && daily.snowfall_sum.some(v => v > 0);
      const zeroLine = new Array(labels.length).fill(0);

      charts.monthTemp = new Chart(ctx1, {
        data: {
          labels: labels,
          datasets: [
            {
              type: 'bar',
              label: 'Sr√°≈æky mm',
              data: rainData,
              backgroundColor: 'rgba(116, 185, 255, 0.5)',
              borderColor: '#74b9ff',
              yAxisID: 'yRain',
              order: 2
            },
            ...(hasSnow ? [{
              type: 'bar',
              label: 'Sn√≠h cm',
              data: daily.snowfall_sum,
              backgroundColor: 'rgba(223, 230, 233, 0.5)',
              borderColor: '#dfe6e9',
              yAxisID: 'yRain',
              order: 2
            }] : []),
            {
              type: 'line',
              label: 'Max ¬∞C',
              data: daily.temperature_2m_max,
              borderColor: '#ff6b6b',
              fill: false,
              tension: 0.3,
              pointRadius: 3,
              order: 1
            },
            {
              type: 'line',
              label: 'Pr≈Ømƒõr ¬∞C',
              data: daily.temperature_2m_mean,
              borderColor: '#ffd93d',
              borderDash: [5, 5],
              fill: false,
              tension: 0.3,
              pointRadius: 2,
              order: 1
            },
            {
              type: 'line',
              label: 'Min ¬∞C',
              data: daily.temperature_2m_min,
              borderColor: '#4ecdc4',
              fill: false,
              tension: 0.3,
              pointRadius: 3,
              order: 1
            },
            {
              type: 'line',
              label: '0¬∞C',
              data: zeroLine,
              borderColor: 'rgba(255, 255, 255, 0.3)',
              borderDash: [3, 3],
              borderWidth: 1,
              pointRadius: 0,
              order: 1
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { intersect: false, mode: 'index' },
          plugins: {
            legend: {
              labels: { 
                color: '#e0e0e0',
                filter: item => item.text !== '0¬∞C'
              }
            }
          },
          scales: {
            x: { grid: { color: '#404040' }, ticks: { color: '#888' } },
            y: { 
              grid: { color: '#404040' }, 
              ticks: { color: '#888', callback: v => `${v}¬∞C` }
            },
            yRain: {
              position: 'right',
              grid: { drawOnChartArea: false },
              ticks: { color: '#74b9ff', callback: v => `${v} mm` },
              beginAtZero: true
            }
          }
        }
      });

      // Ostatn√≠ graf
      if (charts.monthOther) charts.monthOther.destroy();
      const ctx2 = document.getElementById('monthOtherChart').getContext('2d');
      
      charts.monthOther = new Chart(ctx2, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Oblaƒçnost %',
              data: dailyAvgCloud,
              borderColor: '#b2bec3',
              backgroundColor: 'rgba(178, 190, 195, 0.1)',
              fill: true,
              tension: 0.3,
              pointRadius: 2
            },
            {
              label: 'Vlhkost %',
              data: dailyAvgHumidity,
              borderColor: '#a29bfe',
              tension: 0.3,
              pointRadius: 2
            },
            {
              label: 'V√≠tr km/h',
              data: dailyAvgWind,
              borderColor: '#81ecec',
              tension: 0.3,
              pointRadius: 2,
              yAxisID: 'yWind'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { intersect: false, mode: 'index' },
          plugins: {
            legend: { labels: { color: '#e0e0e0' } }
          },
          scales: {
            x: { grid: { color: '#404040' }, ticks: { color: '#888' } },
            y: { 
              grid: { color: '#404040' }, 
              ticks: { color: '#888', callback: v => `${v}%` },
              max: 100
            },
            yWind: {
              position: 'right',
              grid: { drawOnChartArea: false },
              ticks: { color: '#81ecec', callback: v => `${v.toFixed(0)} km/h` },
              beginAtZero: true
            }
          }
        }
      });

      // Ulo≈æit pro tabulku
      monthData.dailyAvg = { cloud: dailyAvgCloud, humidity: dailyAvgHumidity, wind: dailyAvgWind };
    }

    // Mƒõs√≠c - statistiky
    function renderMonthStats(data) {
      const daily = data.daily;
      
      const temps = daily.temperature_2m_mean.filter(t => t !== null);
      const maxTemps = daily.temperature_2m_max.filter(t => t !== null);
      const minTemps = daily.temperature_2m_min.filter(t => t !== null);
      const precip = daily.precipitation_sum.filter(p => p !== null);
      const sunshine = daily.sunshine_duration ? daily.sunshine_duration.filter(s => s !== null) : [];

      const avgTemp = temps.length ? (temps.reduce((a, b) => a + b, 0) / temps.length).toFixed(1) : '‚Äî';
      const maxTemp = maxTemps.length ? Math.max(...maxTemps).toFixed(1) : '‚Äî';
      const minTemp = minTemps.length ? Math.min(...minTemps).toFixed(1) : '‚Äî';
      const totalPrecip = precip.length ? precip.reduce((a, b) => a + b, 0).toFixed(1) : '‚Äî';
      const rainyDays = precip.filter(p => p > 0.1).length;
      const totalSunshine = sunshine.length ? (sunshine.reduce((a, b) => a + b, 0) / 3600).toFixed(0) : null;
      const frostDays = minTemps.filter(t => t < 0).length;
      const summerDays = maxTemps.filter(t => t >= 25).length;
      const tropicalDays = maxTemps.filter(t => t >= 30).length;

      let html = `
        <div class="stat-card">
          <div class="stat-icon">üå°Ô∏è</div>
          <div class="stat-value">${avgTemp}¬∞C</div>
          <div class="stat-label">Pr≈Ømƒõrn√° teplota</div>
        </div>
        <div class="stat-card temp-max">
          <div class="stat-icon">üî•</div>
          <div class="stat-value">${maxTemp}¬∞C</div>
          <div class="stat-label">Nejvy≈°≈°√≠ teplota</div>
        </div>
        <div class="stat-card temp-min">
          <div class="stat-icon">‚ùÑÔ∏è</div>
          <div class="stat-value">${minTemp}¬∞C</div>
          <div class="stat-label">Nejni≈æ≈°√≠ teplota</div>
        </div>
        <div class="stat-card rain">
          <div class="stat-icon">üåßÔ∏è</div>
          <div class="stat-value">${totalPrecip} mm</div>
          <div class="stat-label">Celkov√© sr√°≈æky</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üíß</div>
          <div class="stat-value">${rainyDays}</div>
          <div class="stat-label">Dn≈Ø se sr√°≈ækami</div>
        </div>
      `;

      if (totalSunshine !== null) {
        html += `
          <div class="stat-card sun">
            <div class="stat-icon">‚òÄÔ∏è</div>
            <div class="stat-value">${totalSunshine} h</div>
            <div class="stat-label">Hodiny slunce</div>
          </div>
        `;
      }

      if (frostDays > 0) {
        html += `
          <div class="stat-card">
            <div class="stat-icon">ü•∂</div>
            <div class="stat-value">${frostDays}</div>
            <div class="stat-label">Mrazov√Ωch dn≈Ø</div>
          </div>
        `;
      }

      if (summerDays > 0) {
        html += `
          <div class="stat-card">
            <div class="stat-icon">üåû</div>
            <div class="stat-value">${summerDays}</div>
            <div class="stat-label">Letn√≠ch dn≈Ø (‚â•25¬∞C)</div>
          </div>
        `;
      }

      if (tropicalDays > 0) {
        html += `
          <div class="stat-card">
            <div class="stat-icon">üèùÔ∏è</div>
            <div class="stat-value">${tropicalDays}</div>
            <div class="stat-label">Tropick√Ωch (‚â•30¬∞C)</div>
          </div>
        `;
      }

      document.getElementById('monthStats').innerHTML = html;
    }

    // Mƒõs√≠c - tabulka
    function renderMonthTable(data) {
      const daily = data.daily;
      const dailyAvg = monthData.dailyAvg;
      let html = '';

      for (let i = 0; i < daily.time.length; i++) {
        const date = new Date(daily.time[i]);
        const dateStr = `${date.getDate()}.${date.getMonth()+1}.`;
        
        html += `<tr>
          <td>${dateStr}</td>
          <td class="temp-min">${daily.temperature_2m_min[i]?.toFixed(1) || '‚Äî'}</td>
          <td class="temp-max">${daily.temperature_2m_max[i]?.toFixed(1) || '‚Äî'}</td>
          <td class="precip">${daily.precipitation_sum[i]?.toFixed(1) || '0'}</td>
          <td class="cloud">${dailyAvg.cloud[i]?.toFixed(0) || '‚Äî'}</td>
          <td class="humidity">${dailyAvg.humidity[i]?.toFixed(0) || '‚Äî'}</td>
          <td class="wind">${dailyAvg.wind[i]?.toFixed(1) || '‚Äî'}</td>
        </tr>`;
      }

      document.getElementById('monthTableBody').innerHTML = html;
      document.getElementById('monthTableSection').style.display = 'block';
    }

    // Rok - grafy
    function renderYearCharts(data, year) {
      const daily = data.daily;
      const hourly = data.hourly;
      
      // Agregace do mƒõs√≠c≈Ø
      const monthlyData = {
        labels: ['Led', '√öno', 'B≈ôe', 'Dub', 'Kvƒõ', 'ƒåvn', 'ƒåvc', 'Srp', 'Z√°≈ô', '≈ò√≠j', 'Lis', 'Pro'],
        avgTemp: [], maxTemp: [], minTemp: [],
        totalPrecip: [],
        avgCloud: [], avgHumidity: [], avgWind: []
      };

      for (let m = 0; m < 12; m++) {
        const monthDays = daily.time.filter(t => new Date(t).getMonth() === m);
        if (monthDays.length === 0) {
          monthlyData.avgTemp.push(null);
          monthlyData.maxTemp.push(null);
          monthlyData.minTemp.push(null);
          monthlyData.totalPrecip.push(null);
          monthlyData.avgCloud.push(null);
          monthlyData.avgHumidity.push(null);
          monthlyData.avgWind.push(null);
          continue;
        }

        const indices = daily.time.map((t, i) => new Date(t).getMonth() === m ? i : -1).filter(i => i >= 0);
        
        const monthTemps = indices.map(i => daily.temperature_2m_mean[i]).filter(v => v !== null);
        const monthMaxTemps = indices.map(i => daily.temperature_2m_max[i]).filter(v => v !== null);
        const monthMinTemps = indices.map(i => daily.temperature_2m_min[i]).filter(v => v !== null);
        const monthPrecip = indices.map(i => daily.precipitation_sum[i]).filter(v => v !== null);
        
        monthlyData.avgTemp.push(monthTemps.length ? monthTemps.reduce((a,b) => a+b, 0) / monthTemps.length : null);
        monthlyData.maxTemp.push(monthMaxTemps.length ? Math.max(...monthMaxTemps) : null);
        monthlyData.minTemp.push(monthMinTemps.length ? Math.min(...monthMinTemps) : null);
        monthlyData.totalPrecip.push(monthPrecip.length ? monthPrecip.reduce((a,b) => a+b, 0) : null);
        
        // Hodinov√© pr≈Ømƒõry
        const startDay = indices[0];
        const endDay = indices[indices.length - 1];
        const startHour = startDay * 24;
        const endHour = (endDay + 1) * 24;
        
        const cloudSlice = hourly.cloud_cover.slice(startHour, endHour).filter(v => v !== null);
        const humiditySlice = hourly.relative_humidity_2m.slice(startHour, endHour).filter(v => v !== null);
        const windSlice = hourly.wind_speed_10m.slice(startHour, endHour).filter(v => v !== null);
        
        monthlyData.avgCloud.push(cloudSlice.length ? cloudSlice.reduce((a,b) => a+b, 0) / cloudSlice.length : null);
        monthlyData.avgHumidity.push(humiditySlice.length ? humiditySlice.reduce((a,b) => a+b, 0) / humiditySlice.length : null);
        monthlyData.avgWind.push(windSlice.length ? windSlice.reduce((a,b) => a+b, 0) / windSlice.length : null);
      }

      // Ulo≈æit pro statistiky
      yearData.monthly = monthlyData;

      // Teplotn√≠ graf
      if (charts.yearTemp) charts.yearTemp.destroy();
      const ctx1 = document.getElementById('yearTempChart').getContext('2d');
      
      const zeroLine = new Array(12).fill(0);

      charts.yearTemp = new Chart(ctx1, {
        data: {
          labels: monthlyData.labels,
          datasets: [
            {
              type: 'bar',
              label: 'Sr√°≈æky mm',
              data: monthlyData.totalPrecip,
              backgroundColor: 'rgba(116, 185, 255, 0.5)',
              borderColor: '#74b9ff',
              yAxisID: 'yRain',
              order: 2
            },
            {
              type: 'line',
              label: 'Max mƒõs√≠ce ¬∞C',
              data: monthlyData.maxTemp,
              borderColor: '#ff6b6b',
              fill: false,
              tension: 0.3,
              pointRadius: 4,
              order: 1
            },
            {
              type: 'line',
              label: 'Pr≈Ømƒõr ¬∞C',
              data: monthlyData.avgTemp,
              borderColor: '#ffd93d',
              borderDash: [5, 5],
              fill: false,
              tension: 0.3,
              pointRadius: 3,
              order: 1
            },
            {
              type: 'line',
              label: 'Min mƒõs√≠ce ¬∞C',
              data: monthlyData.minTemp,
              borderColor: '#4ecdc4',
              fill: false,
              tension: 0.3,
              pointRadius: 4,
              order: 1
            },
            {
              type: 'line',
              label: '0¬∞C',
              data: zeroLine,
              borderColor: 'rgba(255, 255, 255, 0.3)',
              borderDash: [3, 3],
              borderWidth: 1,
              pointRadius: 0,
              order: 1
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { intersect: false, mode: 'index' },
          plugins: {
            legend: {
              labels: { 
                color: '#e0e0e0',
                filter: item => item.text !== '0¬∞C'
              }
            }
          },
          scales: {
            x: { grid: { color: '#404040' }, ticks: { color: '#888' } },
            y: { 
              grid: { color: '#404040' }, 
              ticks: { color: '#888', callback: v => `${v}¬∞C` }
            },
            yRain: {
              position: 'right',
              grid: { drawOnChartArea: false },
              ticks: { color: '#74b9ff', callback: v => `${v.toFixed(0)} mm` },
              beginAtZero: true
            }
          }
        }
      });

      // Ostatn√≠ graf
      if (charts.yearOther) charts.yearOther.destroy();
      const ctx2 = document.getElementById('yearOtherChart').getContext('2d');
      
      charts.yearOther = new Chart(ctx2, {
        type: 'line',
        data: {
          labels: monthlyData.labels,
          datasets: [
            {
              label: 'Oblaƒçnost %',
              data: monthlyData.avgCloud,
              borderColor: '#b2bec3',
              backgroundColor: 'rgba(178, 190, 195, 0.1)',
              fill: true,
              tension: 0.3,
              pointRadius: 4
            },
            {
              label: 'Vlhkost %',
              data: monthlyData.avgHumidity,
              borderColor: '#a29bfe',
              tension: 0.3,
              pointRadius: 4
            },
            {
              label: 'V√≠tr km/h',
              data: monthlyData.avgWind,
              borderColor: '#81ecec',
              tension: 0.3,
              pointRadius: 4,
              yAxisID: 'yWind'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { intersect: false, mode: 'index' },
          plugins: {
            legend: { labels: { color: '#e0e0e0' } }
          },
          scales: {
            x: { grid: { color: '#404040' }, ticks: { color: '#888' } },
            y: { 
              grid: { color: '#404040' }, 
              ticks: { color: '#888', callback: v => `${v.toFixed(0)}%` },
              max: 100
            },
            yWind: {
              position: 'right',
              grid: { drawOnChartArea: false },
              ticks: { color: '#81ecec', callback: v => `${v.toFixed(0)} km/h` },
              beginAtZero: true
            }
          }
        }
      });
    }

    // Rok - statistiky
    function renderYearStats(data) {
      const daily = data.daily;
      const hourly = data.hourly;
      
      const temps = daily.temperature_2m_mean.filter(t => t !== null);
      const maxTemps = daily.temperature_2m_max.filter(t => t !== null);
      const minTemps = daily.temperature_2m_min.filter(t => t !== null);
      const precip = daily.precipitation_sum.filter(p => p !== null);
      const sunshine = daily.sunshine_duration ? daily.sunshine_duration.filter(s => s !== null) : [];
      const clouds = hourly.cloud_cover.filter(c => c !== null);
      const humidity = hourly.relative_humidity_2m.filter(h => h !== null);
      const wind = hourly.wind_speed_10m.filter(w => w !== null);

      // Z√°kladn√≠ statistiky
      const avgTemp = temps.length ? (temps.reduce((a, b) => a + b, 0) / temps.length).toFixed(1) : '‚Äî';
      const maxTemp = maxTemps.length ? Math.max(...maxTemps).toFixed(1) : '‚Äî';
      const minTemp = minTemps.length ? Math.min(...minTemps).toFixed(1) : '‚Äî';
      const totalPrecip = precip.length ? precip.reduce((a, b) => a + b, 0).toFixed(0) : '‚Äî';
      const totalSunshine = sunshine.length ? (sunshine.reduce((a, b) => a + b, 0) / 3600).toFixed(0) : null;
      const avgCloud = clouds.length ? (clouds.reduce((a,b) => a+b, 0) / clouds.length).toFixed(0) : '‚Äî';
      const avgHumidity = humidity.length ? (humidity.reduce((a,b) => a+b, 0) / humidity.length).toFixed(0) : '‚Äî';
      const avgWind = wind.length ? (wind.reduce((a,b) => a+b, 0) / wind.length).toFixed(1) : '‚Äî';

      // Poƒçty dn≈Ø
      const rainyDays = precip.filter(p => p > 0.1).length;
      const snowDays = daily.snowfall_sum ? daily.snowfall_sum.filter(s => s > 0).length : 0;
      const frostDays = minTemps.filter(t => t < 0).length;
      const iceDays = maxTemps.filter(t => t < 0).length;
      const summerDays = maxTemps.filter(t => t >= 25).length;
      const tropicalDays = maxTemps.filter(t => t >= 30).length;
      const tropicalNights = minTemps.filter(t => t >= 20).length;
      
      // Oblaƒçnost - kategorie
      const clearDays = daily.time.filter((t, i) => {
        const dayIdx = i;
        const startHour = dayIdx * 24;
        const endHour = startHour + 24;
        const dayCloud = hourly.cloud_cover.slice(startHour, endHour).filter(c => c !== null);
        const avgDayCloud = dayCloud.length ? dayCloud.reduce((a,b) => a+b, 0) / dayCloud.length : 100;
        return avgDayCloud < 20;
      }).length;
      
      const cloudyDays = daily.time.filter((t, i) => {
        const dayIdx = i;
        const startHour = dayIdx * 24;
        const endHour = startHour + 24;
        const dayCloud = hourly.cloud_cover.slice(startHour, endHour).filter(c => c !== null);
        const avgDayCloud = dayCloud.length ? dayCloud.reduce((a,b) => a+b, 0) / dayCloud.length : 0;
        return avgDayCloud > 80;
      }).length;

      // Hlavn√≠ statistiky
      let mainHtml = `
        <div class="stat-card">
          <div class="stat-icon">üå°Ô∏è</div>
          <div class="stat-value">${avgTemp}¬∞C</div>
          <div class="stat-label">Roƒçn√≠ pr≈Ømƒõr</div>
        </div>
        <div class="stat-card temp-max">
          <div class="stat-icon">üî•</div>
          <div class="stat-value">${maxTemp}¬∞C</div>
          <div class="stat-label">Nejvy≈°≈°√≠ teplota</div>
        </div>
        <div class="stat-card temp-min">
          <div class="stat-icon">‚ùÑÔ∏è</div>
          <div class="stat-value">${minTemp}¬∞C</div>
          <div class="stat-label">Nejni≈æ≈°√≠ teplota</div>
        </div>
        <div class="stat-card rain">
          <div class="stat-icon">üåßÔ∏è</div>
          <div class="stat-value">${totalPrecip} mm</div>
          <div class="stat-label">Roƒçn√≠ sr√°≈æky</div>
        </div>
        <div class="stat-card cloud">
          <div class="stat-icon">‚òÅÔ∏è</div>
          <div class="stat-value">${avgCloud}%</div>
          <div class="stat-label">Pr≈Øm. oblaƒçnost</div>
        </div>
        <div class="stat-card humidity">
          <div class="stat-icon">üíß</div>
          <div class="stat-value">${avgHumidity}%</div>
          <div class="stat-label">Pr≈Øm. vlhkost</div>
        </div>
        <div class="stat-card wind">
          <div class="stat-icon">üí®</div>
          <div class="stat-value">${avgWind}</div>
          <div class="stat-label">Pr≈Øm. v√≠tr km/h</div>
        </div>
      `;
      
      if (totalSunshine !== null) {
        mainHtml += `
          <div class="stat-card sun">
            <div class="stat-icon">‚òÄÔ∏è</div>
            <div class="stat-value">${totalSunshine} h</div>
            <div class="stat-label">Hodiny slunce</div>
          </div>
        `;
      }

      document.getElementById('yearStats').innerHTML = mainHtml;

      // Roz≈°√≠≈ôen√© statistiky
      document.getElementById('yearExtendedStats').style.display = 'grid';

      // Teplotn√≠
      document.getElementById('yearTempStats').innerHTML = `
        <div class="mini-stat">
          <div class="mini-stat-value" style="color: #ff6b6b;">${maxTemp}¬∞C</div>
          <div class="mini-stat-label">Maximum roku</div>
        </div>
        <div class="mini-stat">
          <div class="mini-stat-value" style="color: #4ecdc4;">${minTemp}¬∞C</div>
          <div class="mini-stat-label">Minimum roku</div>
        </div>
        <div class="mini-stat">
          <div class="mini-stat-value">${avgTemp}¬∞C</div>
          <div class="mini-stat-label">Roƒçn√≠ pr≈Ømƒõr</div>
        </div>
        <div class="mini-stat">
          <div class="mini-stat-value">${(maxTemps.length ? maxTemps.reduce((a,b) => a+b,0) / maxTemps.length : 0).toFixed(1)}¬∞C</div>
          <div class="mini-stat-label">Pr≈Øm. max</div>
        </div>
      `;

      // Sr√°≈æky a oblaƒçnost
      document.getElementById('yearPrecipStats').innerHTML = `
        <div class="mini-stat">
          <div class="mini-stat-value" style="color: #74b9ff;">${totalPrecip} mm</div>
          <div class="mini-stat-label">Roƒçn√≠ sr√°≈æky</div>
        </div>
        <div class="mini-stat">
          <div class="mini-stat-value" style="color: #74b9ff;">${rainyDays}</div>
          <div class="mini-stat-label">Dn≈Ø se sr√°≈ækami</div>
        </div>
        <div class="mini-stat">
          <div class="mini-stat-value" style="color: #b2bec3;">${avgCloud}%</div>
          <div class="mini-stat-label">Pr≈Øm. oblaƒçnost</div>
        </div>
        <div class="mini-stat">
          <div class="mini-stat-value" style="color: #a29bfe;">${avgHumidity}%</div>
          <div class="mini-stat-label">Pr≈Øm. vlhkost</div>
        </div>
      `;

      // Poƒçet dn≈Ø
      document.getElementById('yearDayStats').innerHTML = `
        <div class="mini-stat">
          <div class="mini-stat-value" style="color: #ffeaa7;">${clearDays}</div>
          <div class="mini-stat-label">Jasn√Ωch dn≈Ø ‚òÄÔ∏è</div>
        </div>
        <div class="mini-stat">
          <div class="mini-stat-value" style="color: #b2bec3;">${cloudyDays}</div>
          <div class="mini-stat-label">Zata≈æen√Ωch dn≈Ø ‚òÅÔ∏è</div>
        </div>
        <div class="mini-stat">
          <div class="mini-stat-value" style="color: #4ecdc4;">${frostDays}</div>
          <div class="mini-stat-label">Mrazov√Ωch dn≈Ø ü•∂</div>
        </div>
        <div class="mini-stat">
          <div class="mini-stat-value" style="color: #74b9ff;">${iceDays}</div>
          <div class="mini-stat-label">Ledov√Ωch dn≈Ø ‚ùÑÔ∏è</div>
        </div>
        <div class="mini-stat">
          <div class="mini-stat-value" style="color: #ffd93d;">${summerDays}</div>
          <div class="mini-stat-label">Letn√≠ch dn≈Ø üåû</div>
        </div>
        <div class="mini-stat">
          <div class="mini-stat-value" style="color: #ff6b6b;">${tropicalDays}</div>
          <div class="mini-stat-label">Tropick√Ωch dn≈Ø üèùÔ∏è</div>
        </div>
        <div class="mini-stat">
          <div class="mini-stat-value" style="color: #ff6b6b;">${tropicalNights}</div>
          <div class="mini-stat-label">Tropick√Ωch noc√≠ üåô</div>
        </div>
        <div class="mini-stat">
          <div class="mini-stat-value" style="color: #dfe6e9;">${snowDays}</div>
          <div class="mini-stat-label">Dn≈Ø se snƒõhem ‚ùÑÔ∏è</div>
        </div>
      `;

      // Legenda typ≈Ø dn≈Ø
      document.getElementById('dayTypeLegend').innerHTML = `
        <div class="day-type-legend-item"><strong>‚òÄÔ∏è Jasn√Ω den:</strong> pr≈Ømƒõrn√° oblaƒçnost pod 20%</div>
        <div class="day-type-legend-item"><strong>‚òÅÔ∏è Zata≈æen√Ω den:</strong> pr≈Ømƒõrn√° oblaƒçnost nad 80%</div>
        <div class="day-type-legend-item"><strong>ü•∂ Mrazov√Ω den:</strong> minim√°ln√≠ teplota pod 0¬∞C</div>
        <div class="day-type-legend-item"><strong>‚ùÑÔ∏è Ledov√Ω den:</strong> maxim√°ln√≠ teplota pod 0¬∞C (cel√Ω den mr√°z)</div>
        <div class="day-type-legend-item"><strong>üåû Letn√≠ den:</strong> maxim√°ln√≠ teplota ‚â• 25¬∞C</div>
        <div class="day-type-legend-item"><strong>üèùÔ∏è Tropick√Ω den:</strong> maxim√°ln√≠ teplota ‚â• 30¬∞C</div>
        <div class="day-type-legend-item"><strong>üåô Tropick√° noc:</strong> minim√°ln√≠ teplota ‚â• 20¬∞C</div>
        <div class="day-type-legend-item"><strong>‚ùÑÔ∏è Den se snƒõhem:</strong> zaznamenan√© snƒõ≈æen√≠ > 0 cm</div>
      `;
    }

    // ===== EXPORT CSV =====
    function exportCsv(type) {
      let csv = '';
      let filename = '';
      const BOM = '\uFEFF';
      const locationName = currentLocationData ? currentLocationData.name.replace(/\s+/g, '_') : 'data';

      if (type === 'day' && dayData) {
        const hourly = dayData.hourly;
        csv = 'ƒåas;Teplota ¬∞C;Vlhkost %;Sr√°≈æky mm;Oblaƒçnost %;V√≠tr km/h\n';
        
        for (let i = 0; i < hourly.time.length; i++) {
          csv += [
            hourly.time[i],
            hourly.temperature_2m[i]?.toFixed(1) || '',
            hourly.relative_humidity_2m[i]?.toFixed(0) || '',
            hourly.precipitation[i]?.toFixed(1) || '',
            hourly.cloud_cover[i]?.toFixed(0) || '',
            hourly.wind_speed_10m[i]?.toFixed(1) || ''
          ].join(';') + '\n';
        }
        
        filename = `pocasi_${locationName}_${document.getElementById('date-day').value}.csv`;
      } else if (type === 'month' && monthData) {
        const daily = monthData.daily;
        const dailyAvg = monthData.dailyAvg;
        csv = 'Datum;Min ¬∞C;Max ¬∞C;Sr√°≈æky mm;Oblaƒçnost %;Vlhkost %;V√≠tr km/h\n';
        
        for (let i = 0; i < daily.time.length; i++) {
          csv += [
            daily.time[i],
            daily.temperature_2m_min[i]?.toFixed(1) || '',
            daily.temperature_2m_max[i]?.toFixed(1) || '',
            daily.precipitation_sum[i]?.toFixed(1) || '',
            dailyAvg.cloud[i]?.toFixed(0) || '',
            dailyAvg.humidity[i]?.toFixed(0) || '',
            dailyAvg.wind[i]?.toFixed(1) || ''
          ].join(';') + '\n';
        }
        
        const year = document.getElementById('year-month').value;
        const month = document.getElementById('month-month').value;
        filename = `pocasi_${locationName}_${year}-${String(month).padStart(2, '0')}.csv`;
      } else {
        showNotification('Nejsou k dispozici data pro export', 'warning');
        return;
      }

      const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      link.click();
      
      URL.revokeObjectURL(url);
      showNotification('CSV soubor byl sta≈æen', 'success');
    }

    // ===== NOTIFIKACE =====
    function showNotification(message, type = 'info') {
      const existing = document.querySelector('.notification');
      if (existing) existing.remove();

      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);

      setTimeout(() => notification.remove(), 4000);
    }

    // ===== EXPORT V≈†ECH LET =====
    
    function cancelDownload() {
      downloadCancelled = true;
      document.getElementById('cancelDownload').style.display = 'none';
      document.getElementById('loadAllYears').style.display = 'inline-block';
      document.getElementById('progressDetail').textContent = '‚èπ Stahov√°n√≠ zru≈°eno u≈æivatelem';
      showNotification('Stahov√°n√≠ zru≈°eno', 'warning');
      
      setTimeout(() => {
        document.getElementById('downloadProgress').style.display = 'none';
      }, 2000);
    }

    async function loadAllYearsData() {
      if (!currentLocationData) {
        showNotification('Nejprve vyberte lokalitu', 'warning');
        return;
      }

      const startYear = parseInt(document.getElementById('year-export-start').value);
      const endYear = parseInt(document.getElementById('year-export-end').value);

      if (startYear > endYear) {
        showNotification('Poƒç√°teƒçn√≠ rok mus√≠ b√Ωt men≈°√≠ nebo roven koncov√©mu', 'warning');
        return;
      }

      const totalYears = endYear - startYear + 1;
      downloadCancelled = false;
      allYearsData = [];
      failedYears = []; // Reset seznamu chyb p≈ôi nov√©m stahov√°n√≠

      // UI
      document.getElementById('loadAllYears').style.display = 'none';
      document.getElementById('retryFailed').style.display = 'none'; // Skr√Ωt tlaƒç√≠tko retry
      document.getElementById('cancelDownload').style.display = 'inline-block';
      document.getElementById('downloadProgress').style.display = 'block';
      document.getElementById('allYearsTableSection').style.display = 'none';
      document.getElementById('downloadLog').innerHTML = '';

      const progressFill = document.getElementById('progressFill');
      const progressPercent = document.getElementById('progressPercent');
      const progressDetail = document.getElementById('progressDetail');
      const progressText = document.getElementById('progressText');
      const downloadLog = document.getElementById('downloadLog');

      progressText.textContent = `Stahov√°n√≠ dat pro ${currentLocationData.name}...`;

      let successCount = 0;
      let errorCount = 0;

      for (let year = startYear; year <= endYear; year++) {
        if (downloadCancelled) break;

        const progress = ((year - startYear) / totalYears * 100).toFixed(0);
        progressFill.style.width = `${progress}%`;
        progressPercent.textContent = `${progress}%`;
        progressDetail.textContent = `Stahuji rok ${year}... (${year - startYear + 1}/${totalYears})`;

        // P≈ôid√°n√≠ pending z√°znamu do logu
        const logEntryId = `log-${year}`;
        downloadLog.innerHTML += `
          <div class="log-entry" id="${logEntryId}">
            <span class="log-year">üìÖ ${year}</span>
            <span class="log-status pending">‚è≥ Stahuji...</span>
          </div>
        `;
        downloadLog.scrollTop = downloadLog.scrollHeight;

        const result = await fetchYearStatsWithRetry(year, logEntryId);
        
        if (result.success && result.data) {
          allYearsData.push(result.data);
          successCount++;
        } else {
          errorCount++;
          failedYears.push(year); // P≈ôidat do seznamu chyb
        }
      }

      // Dokonƒçen√≠
      document.getElementById('cancelDownload').style.display = 'none';
      document.getElementById('loadAllYears').style.display = 'inline-block';
      
      // Zobrazen√≠ tlaƒç√≠tka pro retry, pokud existuj√≠ chyby
      if (failedYears.length > 0) {
        document.getElementById('retryFailed').style.display = 'inline-block';
        document.getElementById('failedCount').textContent = failedYears.length;
      }

      if (!downloadCancelled && allYearsData.length > 0) {
        progressFill.style.width = '100%';
        progressPercent.textContent = '100%';
        progressDetail.textContent = `‚úÖ Sta≈æeno ${successCount} let` + (errorCount > 0 ? ` | ‚ùå Selhalo ${errorCount} let` : '');
        
        renderAllYearsTable();
        showNotification(`Data √∫spƒõ≈°nƒõ sta≈æena (${allYearsData.length} let)`, 'success');
      } else if (allYearsData.length === 0 && !downloadCancelled) {
        progressDetail.textContent = `‚ùå Nepoda≈ôilo se st√°hnout ≈æ√°dn√° data`;
        showNotification('Nepoda≈ôilo se st√°hnout ≈æ√°dn√° data', 'error');
      }
      
      // Nechceme progress bar schov√°vat hned, pokud jsou chyby, aby u≈æivatel vidƒõl stav
      if (failedYears.length === 0 && !downloadCancelled) {
          setTimeout(() => {
            document.getElementById('downloadProgress').style.display = 'none';
          }, 3000);
      }
    }

    // Funkce pro opakov√°n√≠ stahov√°n√≠ ne√∫spƒõ≈°n√Ωch let
    async function retryFailedDownloads() {
      if (failedYears.length === 0) return;

      downloadCancelled = false;
      
      // UI √∫pravy
      document.getElementById('retryFailed').style.display = 'none';
      document.getElementById('loadAllYears').style.display = 'none';
      document.getElementById('cancelDownload').style.display = 'inline-block';
      
      const progressFill = document.getElementById('progressFill');
      const progressPercent = document.getElementById('progressPercent');
      const progressDetail = document.getElementById('progressDetail');
      const progressText = document.getElementById('progressText');

      progressText.textContent = `Opakuji stahov√°n√≠ chyb...`;
      
      // Kopie pole chyb pro iteraci, vypr√°zdn√≠me origin√°l pro nov√© plnƒõn√≠
      const yearsToRetry = [...failedYears];
      failedYears = []; 
      const totalRetry = yearsToRetry.length;
      let successCount = 0;
      let errorCount = 0;

      for (let i = 0; i < totalRetry; i++) {
        if (downloadCancelled) {
            // Pokud zru≈°eno, vr√°t√≠me zb√Ωvaj√≠c√≠ roky zpƒõt do failedYears
            failedYears.push(...yearsToRetry.slice(i));
            break;
        }

        const year = yearsToRetry[i];
        const progress = ((i) / totalRetry * 100).toFixed(0);
        progressFill.style.width = `${progress}%`;
        progressPercent.textContent = `${progress}%`;
        progressDetail.textContent = `Opakuji rok ${year}... (${i + 1}/${totalRetry})`;

        const logEntryId = `log-${year}`;
        // Aktualizace existuj√≠c√≠ho logu na pending
        updateLogEntry(logEntryId, 'pending', '‚è≥ Opakuji...');

        const result = await fetchYearStatsWithRetry(year, logEntryId);

        if (result.success && result.data) {
          allYearsData.push(result.data);
          successCount++;
        } else {
          errorCount++;
          failedYears.push(year); // St√°le chyba, vr√°t√≠me do seznamu
        }
      }

      // Dokonƒçen√≠ retry cyklu
      document.getElementById('cancelDownload').style.display = 'none';
      document.getElementById('loadAllYears').style.display = 'inline-block';

      if (failedYears.length > 0) {
        document.getElementById('retryFailed').style.display = 'inline-block';
        document.getElementById('failedCount').textContent = failedYears.length;
        progressDetail.textContent = `‚ö†Ô∏è St√°le chyb√≠ ${failedYears.length} let`;
      } else {
        progressFill.style.width = '100%';
        progressPercent.textContent = '100%';
        progressDetail.textContent = `‚úÖ V≈°echna chybƒõj√≠c√≠ data sta≈æena`;
        setTimeout(() => {
            document.getElementById('downloadProgress').style.display = 'none';
        }, 3000);
      }

      // Aktualizace tabulky s nov√Ωmi daty
      if (allYearsData.length > 0) {
        renderAllYearsTable();
        showNotification(`Doplnƒõno ${successCount} let`, 'success');
      }
    }

    async function fetchYearStatsWithRetry(year, logEntryId) {
      const maxMegaRetries = 3;    // Poƒçet "velk√Ωch" pokus≈Ø (s 10s pauzou mezi nimi)
      const maxRetries = 3;        // Poƒçet pokus≈Ø v r√°mci jednoho "velk√©ho" pokusu
      const baseDelay = 500;       // 0.5 sekundy
      const megaRetryDelay = 30000; // 30 sekund mezi velk√Ωmi pokusy
      
      for (let megaAttempt = 1; megaAttempt <= maxMegaRetries; megaAttempt++) {
        
        // Vnit≈ôn√≠ smyƒçka - 3 pokusy s exponenci√°ln√≠m backoffem
        for (let attempt = 1; attempt <= maxRetries; attempt++) {
          if (downloadCancelled) {
            updateLogEntry(logEntryId, 'error', '‚èπ Zru≈°eno');
            return { success: false, data: null };
          }

          // Aktualizace logu
          const attemptInfo = megaAttempt > 1 
            ? `üîÑ S√©rie ${megaAttempt}/3, pokus ${attempt}/3...`
            : (attempt > 1 ? `üîÑ Pokus ${attempt}/3...` : '‚è≥ Stahuji...');
          updateLogEntry(logEntryId, attempt > 1 || megaAttempt > 1 ? 'retry' : 'pending', attemptInfo);

          try {
            const yearStats = await fetchYearStats(year);
            
            if (yearStats) {
              let statusText = '‚úì OK';
              if (megaAttempt > 1 || attempt > 1) {
                statusText = `‚úì OK (s√©rie ${megaAttempt}, pokus ${attempt})`;
              }
              updateLogEntry(logEntryId, 'success', statusText);
              
              // Pauza mezi √∫spƒõ≈°n√Ωmi requesty
              await new Promise(resolve => setTimeout(resolve, baseDelay));
              
              return { success: true, data: yearStats };
            } else {
              throw new Error('Pr√°zdn√° odpovƒõƒè');
            }
          } catch (error) {
            console.error(`Rok ${year}, s√©rie ${megaAttempt}, pokus ${attempt} selhal:`, error);
            
            if (attempt < maxRetries) {
              // Exponenci√°ln√≠ backoff v r√°mci s√©rie: 0.5s, 1s, 2s
              const delay = baseDelay * Math.pow(2, attempt - 1);
              updateLogEntry(logEntryId, 'retry', `‚ö†Ô∏è Chyba, ƒçek√°m ${(delay/1000).toFixed(1)}s...`);
              await new Promise(resolve => setTimeout(resolve, delay));
            }
          }
        }
        
        // V≈°echny 3 pokusy v t√©to s√©rii selhaly
        if (megaAttempt < maxMegaRetries) {
          // Dlouh√° pauza p≈ôed dal≈°√≠ s√©ri√≠ pokus≈Ø
          updateLogEntry(logEntryId, 'retry', `‚è∏Ô∏è S√©rie ${megaAttempt} selhala, ƒçek√°m 30s...`);
          await new Promise(resolve => setTimeout(resolve, megaRetryDelay));
        }
      }
      
      // V≈°echny s√©rie pokus≈Ø selhaly
      updateLogEntry(logEntryId, 'error', `‚úó Selhalo po ${maxMegaRetries}√ó${maxRetries} pokusech`);
      return { success: false, data: null };
    }

    function updateLogEntry(logEntryId, status, text) {
      const logEntry = document.getElementById(logEntryId);
      if (logEntry) {
        const statusSpan = logEntry.querySelector('.log-status');
        if (statusSpan) {
          statusSpan.className = `log-status ${status}`;
          statusSpan.textContent = text;
        }
      }
      // Auto-scroll
      const downloadLog = document.getElementById('downloadLog');
      downloadLog.scrollTop = downloadLog.scrollHeight;
    }

    async function fetchYearStats(year) {
      const currentYear = new Date().getFullYear();
      let endDate;
      
      if (year === currentYear) {
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        endDate = yesterday.toISOString().split('T')[0];
      } else {
        endDate = `${year}-12-31`;
      }
      
      const startDate = `${year}-01-01`;

      const url = `https://archive-api.open-meteo.com/v1/archive?` +
        `latitude=${currentLocationData.lat}&longitude=${currentLocationData.lon}` +
        `&start_date=${startDate}&end_date=${endDate}` +
        `&daily=temperature_2m_max,temperature_2m_min,temperature_2m_mean,precipitation_sum,snowfall_sum,sunshine_duration` +
        `&hourly=relative_humidity_2m,cloud_cover,wind_speed_10m` +
        `&timezone=Europe/Prague`;

      const response = await fetch(url);
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }
      
      const data = await response.json();

      if (data.error) {
        throw new Error(data.reason || 'API error');
      }

      if (!data.daily || !data.daily.time || data.daily.time.length === 0) {
        throw new Error('Pr√°zdn√° data');
      }

      return calculateYearStats(year, data);
    }

    function calculateYearStats(year, data) {
      const daily = data.daily;
      const hourly = data.hourly;

      const temps = daily.temperature_2m_mean.filter(t => t !== null);
      const maxTemps = daily.temperature_2m_max.filter(t => t !== null);
      const minTemps = daily.temperature_2m_min.filter(t => t !== null);
      const precip = daily.precipitation_sum.filter(p => p !== null);
      const sunshine = daily.sunshine_duration ? daily.sunshine_duration.filter(s => s !== null) : [];
      const clouds = hourly.cloud_cover ? hourly.cloud_cover.filter(c => c !== null) : [];
      const humidity = hourly.relative_humidity_2m ? hourly.relative_humidity_2m.filter(h => h !== null) : [];
      const wind = hourly.wind_speed_10m ? hourly.wind_speed_10m.filter(w => w !== null) : [];

      return {
        year: year,
        avgTemp: temps.length ? parseFloat((temps.reduce((a, b) => a + b, 0) / temps.length).toFixed(2)) : null,
        maxTemp: maxTemps.length ? parseFloat(Math.max(...maxTemps).toFixed(1)) : null,
        minTemp: minTemps.length ? parseFloat(Math.min(...minTemps).toFixed(1)) : null,
        totalPrecip: precip.length ? parseFloat(precip.reduce((a, b) => a + b, 0).toFixed(1)) : null,
        totalSunshine: sunshine.length ? parseFloat((sunshine.reduce((a, b) => a + b, 0) / 3600).toFixed(0)) : null,
        avgCloud: clouds.length ? parseFloat((clouds.reduce((a, b) => a + b, 0) / clouds.length).toFixed(1)) : null,
        avgHumidity: humidity.length ? parseFloat((humidity.reduce((a, b) => a + b, 0) / humidity.length).toFixed(1)) : null,
        avgWind: wind.length ? parseFloat((wind.reduce((a, b) => a + b, 0) / wind.length).toFixed(2)) : null,
        frostDays: minTemps.filter(t => t < 0).length,
        iceDays: maxTemps.filter(t => t < 0).length,
        summerDays: maxTemps.filter(t => t >= 25).length,
        tropicalDays: maxTemps.filter(t => t >= 30).length,
        tropicalNights: minTemps.filter(t => t >= 20).length,
        rainyDays: precip.filter(p => p > 0.1).length,
        snowDays: daily.snowfall_sum ? daily.snowfall_sum.filter(s => s > 0).length : 0
      };
    }

    function renderAllYearsTable() {
      const tbody = document.getElementById('allYearsTableBody');
      let html = '';

      // Se≈ôadit od nejnovƒõj≈°√≠ho
      const sorted = [...allYearsData].sort((a, b) => b.year - a.year);

      for (const row of sorted) {
        html += `<tr>
          <td><strong>${row.year}</strong></td>
          <td>${row.avgTemp?.toFixed(1) || '‚Äî'}</td>
          <td class="temp-max">${row.maxTemp?.toFixed(1) || '‚Äî'}</td>
          <td class="temp-min">${row.minTemp?.toFixed(1) || '‚Äî'}</td>
          <td class="precip">${row.totalPrecip?.toFixed(0) || '‚Äî'}</td>
          <td style="color: #ffeaa7;">${row.totalSunshine || '‚Äî'}</td>
          <td class="cloud">${row.avgCloud?.toFixed(0) || '‚Äî'}</td>
          <td class="humidity">${row.avgHumidity?.toFixed(0) || '‚Äî'}</td>
          <td class="wind">${row.avgWind?.toFixed(1) || '‚Äî'}</td>
          <td>${row.frostDays}</td>
          <td>${row.iceDays}</td>
          <td>${row.summerDays}</td>
          <td>${row.tropicalDays}</td>
        </tr>`;
      }

      tbody.innerHTML = html;
      document.getElementById('allYearsCount').textContent = allYearsData.length;
      document.getElementById('allYearsTableSection').style.display = 'block';
    }

    function exportAllYearsJson() {
      if (allYearsData.length === 0) {
        showNotification('Nejsou k dispozici ≈æ√°dn√° data', 'warning');
        return;
      }

      const exportData = {
        location: currentLocationData,
        exportDate: new Date().toISOString(),
        years: allYearsData.sort((a, b) => a.year - b.year)
      };

      const json = JSON.stringify(exportData, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);

      const locationName = currentLocationData.name.replace(/\s+/g, '_');
      const startYear = Math.min(...allYearsData.map(d => d.year));
      const endYear = Math.max(...allYearsData.map(d => d.year));

      const link = document.createElement('a');
      link.href = url;
      link.download = `pocasi_${locationName}_${startYear}-${endYear}.json`;
      link.click();

      URL.revokeObjectURL(url);
      showNotification('JSON soubor byl sta≈æen', 'success');
    }

    function exportAllYearsCsv() {
      if (allYearsData.length === 0) {
        showNotification('Nejsou k dispozici ≈æ√°dn√° data', 'warning');
        return;
      }

      const BOM = '\uFEFF';
      let csv = 'Rok;Pr≈Øm. teplota ¬∞C;Max teplota ¬∞C;Min teplota ¬∞C;Sr√°≈æky mm;Slunce h;Oblaƒçnost %;Vlhkost %;V√≠tr km/h;Mrazov√© dny;Ledov√© dny;Letn√≠ dny;Tropick√© dny;Tropick√© noci;De≈°≈•ov√© dny;Snƒõhov√© dny\n';

      const sorted = [...allYearsData].sort((a, b) => a.year - b.year);

      for (const row of sorted) {
        csv += [
          row.year,
          row.avgTemp?.toFixed(2) || '',
          row.maxTemp?.toFixed(1) || '',
          row.minTemp?.toFixed(1) || '',
          row.totalPrecip?.toFixed(1) || '',
          row.totalSunshine || '',
          row.avgCloud?.toFixed(1) || '',
          row.avgHumidity?.toFixed(1) || '',
          row.avgWind?.toFixed(2) || '',
          row.frostDays,
          row.iceDays,
          row.summerDays,
          row.tropicalDays,
          row.tropicalNights,
          row.rainyDays,
          row.snowDays
        ].join(';') + '\n';
      }

      const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);

      const locationName = currentLocationData.name.replace(/\s+/g, '_');
      const startYear = Math.min(...allYearsData.map(d => d.year));
      const endYear = Math.max(...allYearsData.map(d => d.year));

      const link = document.createElement('a');
      link.href = url;
      link.download = `pocasi_${locationName}_${startYear}-${endYear}.csv`;
      link.click();

      URL.revokeObjectURL(url);
      showNotification('CSV soubor byl sta≈æen', 'success');
    }

    // ===== DOPLNƒöN√ç CHYBƒöJ√çC√çCH LET =====
    let importedJsonData = null;
    let missingYears = [];
    let mergeCancelled = false;

    function loadAndDetectMissingYears() {
      const fileInput = document.getElementById('importExistingJson');
      const file = fileInput.files[0];

      if (!file) {
        showNotification('Vyberte JSON soubor', 'warning');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);

          if (!data.location || !data.years || !Array.isArray(data.years)) {
            showNotification('Neplatn√Ω form√°t JSON souboru', 'error');
            return;
          }

          importedJsonData = data;

          // Set location from imported file
          currentLocationData = data.location;

          // Show loaded file info
          const existingYears = data.years.map(y => y.year).sort((a, b) => a - b);
          const minYear = Math.min(...existingYears);
          const maxYear = Math.max(...existingYears);

          document.getElementById('loadedFileInfo').innerHTML = `
            <strong>üìç Lokalita:</strong> ${data.location.name}, ${data.location.country}<br>
            <strong>üìÖ Obdob√≠ v souboru:</strong> ${minYear} - ${maxYear} (${existingYears.length} let)<br>
            <strong>üïê Exportov√°no:</strong> ${new Date(data.exportDate).toLocaleString('cs-CZ')}
          `;
          document.getElementById('mergeInfo').style.display = 'block';

          // Detect missing years (from maxYear+1 to last completed year)
          const currentYear = new Date().getFullYear();
          const lastCompletedYear = currentYear - 1; // Pouze cel√© ukonƒçen√© roky
          missingYears = [];

          for (let year = maxYear + 1; year <= lastCompletedYear; year++) {
            missingYears.push(year);
          }

          // Also check for any gaps in the existing data
          for (let year = minYear; year <= maxYear; year++) {
            if (!existingYears.includes(year)) {
              missingYears.push(year);
            }
          }

          missingYears.sort((a, b) => a - b);

          if (missingYears.length > 0) {
            document.getElementById('missingYearsList').textContent = missingYears.join(', ');
            document.getElementById('missingYearsSection').style.display = 'block';
            document.getElementById('noMissingYearsSection').style.display = 'none';
            showNotification(`Nalezeno ${missingYears.length} chybƒõj√≠c√≠ch let`, 'info');
          } else {
            document.getElementById('missingYearsSection').style.display = 'none';
            document.getElementById('noMissingYearsSection').style.display = 'block';
            showNotification('Data jsou kompletn√≠, ≈æ√°dn√© chybƒõj√≠c√≠ roky', 'success');
          }

        } catch (err) {
          showNotification('Chyba p≈ôi ƒçten√≠ souboru: ' + err.message, 'error');
        }
      };

      reader.readAsText(file);
    }

    async function fetchMissingYearsData() {
      if (!importedJsonData || missingYears.length === 0) {
        showNotification('Nejsou k dispozici ≈æ√°dn√© chybƒõj√≠c√≠ roky', 'warning');
        return;
      }

      mergeCancelled = false;
      const totalYears = missingYears.length;

      // Start with existing data
      allYearsData = [...importedJsonData.years];

      // UI
      document.getElementById('fetchMissingYears').style.display = 'none';
      document.getElementById('cancelMergeDownload').style.display = 'inline-block';
      document.getElementById('downloadProgress').style.display = 'block';
      document.getElementById('allYearsTableSection').style.display = 'none';
      document.getElementById('downloadLog').innerHTML = '';

      const progressFill = document.getElementById('progressFill');
      const progressPercent = document.getElementById('progressPercent');
      const progressDetail = document.getElementById('progressDetail');
      const progressText = document.getElementById('progressText');
      const downloadLog = document.getElementById('downloadLog');

      progressText.textContent = `Stahov√°n√≠ chybƒõj√≠c√≠ch let pro ${currentLocationData.name}...`;

      let successCount = 0;
      let errorCount = 0;
      let newFailedYears = [];

      for (let i = 0; i < missingYears.length; i++) {
        if (mergeCancelled) break;

        const year = missingYears[i];
        const progress = ((i + 1) / totalYears * 100).toFixed(0);
        progressFill.style.width = `${progress}%`;
        progressPercent.textContent = `${progress}%`;
        progressDetail.textContent = `Stahuji rok ${year}... (${i + 1}/${totalYears})`;

        const logEntryId = `log-merge-${year}`;
        downloadLog.innerHTML += `
          <div class="log-entry" id="${logEntryId}">
            <span class="log-year">üìÖ ${year}</span>
            <span class="log-status pending">‚è≥ Stahuji...</span>
          </div>
        `;
        downloadLog.scrollTop = downloadLog.scrollHeight;

        const result = await fetchYearStatsWithRetry(year, logEntryId);

        if (result.success && result.data) {
          allYearsData.push(result.data);
          successCount++;
        } else {
          errorCount++;
          newFailedYears.push(year);
        }
      }

      // Finish
      document.getElementById('cancelMergeDownload').style.display = 'none';
      document.getElementById('fetchMissingYears').style.display = 'inline-block';

      if (!mergeCancelled && successCount > 0) {
        progressFill.style.width = '100%';
        progressPercent.textContent = '100%';
        progressDetail.textContent = `‚úÖ Sta≈æeno ${successCount} let` + (errorCount > 0 ? ` | ‚ùå Selhalo ${errorCount} let` : '');

        // Sort and render
        allYearsData.sort((a, b) => a.year - b.year);
        renderAllYearsTable();

        // Update missing years list (only those that failed)
        missingYears = newFailedYears;
        if (missingYears.length > 0) {
          document.getElementById('missingYearsList').textContent = missingYears.join(', ');
        } else {
          document.getElementById('missingYearsSection').style.display = 'none';
          document.getElementById('noMissingYearsSection').style.display = 'block';
        }

        showNotification(`Data √∫spƒõ≈°nƒõ doplnƒõna (${successCount} nov√Ωch let, celkem ${allYearsData.length} let)`, 'success');
      } else if (successCount === 0 && !mergeCancelled) {
        progressDetail.textContent = `‚ùå Nepoda≈ôilo se st√°hnout ≈æ√°dn√° data`;
        showNotification('Nepoda≈ôilo se st√°hnout ≈æ√°dn√° data', 'error');
      }

      if (newFailedYears.length === 0 && !mergeCancelled) {
        setTimeout(() => {
          document.getElementById('downloadProgress').style.display = 'none';
        }, 3000);
      }
    }

    function cancelMergeDownload() {
      mergeCancelled = true;
      document.getElementById('cancelMergeDownload').style.display = 'none';
      document.getElementById('fetchMissingYears').style.display = 'inline-block';
      showNotification('Stahov√°n√≠ zru≈°eno', 'warning');
    }

    // ===== ANAL√ùZA HISTORIE =====

    // Inicializace tooltip≈Ø
    function initAnalyzeTooltips() {
      document.querySelectorAll('.info-btn').forEach(btn => {
        const tooltipId = btn.getAttribute('data-tooltip');
        const tooltip = document.getElementById(`tooltip-${tooltipId}`);
        
        if (!tooltip) return;
        
        btn.addEventListener('mouseenter', () => {
          tooltip.classList.add('visible');
        });
        
        btn.addEventListener('mouseleave', () => {
          tooltip.classList.remove('visible');
        });
        
        // Pro mobiln√≠ za≈ô√≠zen√≠
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          tooltip.classList.toggle('visible');
        });
      });
    }

    // Pomocn√° funkce pro v√Ωpoƒçet trendu
    function calculateTrendPerDecade(data) {
      const validData = data.filter(v => v !== null && v !== undefined);
      const n = validData.length;
      if (n < 2) return 0;
      
      let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
      for (let i = 0; i < n; i++) {
        sumX += i;
        sumY += validData[i];
        sumXY += i * validData[i];
        sumXX += i * i;
      }
      
      const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
      return slope * 10;
    }

    // Pomocn√© funkce pro kvalitu dat
    function findLongestConsecutiveSeries(years) {
      let maxLength = 0;
      let currentLength = 0;
      let lastYear = null;
      
      const sortedYears = [...years].sort((a, b) => a.year - b.year);
      
      for (const yearData of sortedYears) {
        if (lastYear === null || yearData.year === lastYear + 1) {
          currentLength++;
        } else {
          maxLength = Math.max(maxLength, currentLength);
          currentLength = 1;
        }
        lastYear = yearData.year;
      }
      
      return Math.max(maxLength, currentLength);
    }

    function calculateAverageSeasonLength(years) {
      const lengths = years.map(y => {
        const frostDays = y.frostDays || 0;
        return 365 - frostDays;
      });
      
      return lengths.reduce((a, b) => a + b, 0) / lengths.length;
    }

    function loadImportedFile() {
      const fileInput = document.getElementById('importFile');
      const file = fileInput.files[0];

      if (!file) {
        showNotification('Vyberte soubor', 'warning');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          importedData = JSON.parse(e.target.result);
          
          if (!importedData.location || !importedData.years || !Array.isArray(importedData.years)) {
            throw new Error('Neplatn√Ω form√°t souboru');
          }

          analyzeImportedData();
          showNotification(`Data naƒçtena: ${importedData.location.name} (${importedData.years.length} let)`, 'success');
        } catch (error) {
          showNotification(`Chyba p≈ôi naƒç√≠t√°n√≠: ${error.message}`, 'error');
        }
      };
      reader.readAsText(file);
    }

    function analyzeImportedData() {
      if (!importedData || !importedData.years.length) return;

      const years = importedData.years.sort((a, b) => a.year - b.year);
      const location = importedData.location;

      document.getElementById('analyze-content').style.display = 'block';
      document.getElementById('analyzePeriod').textContent = 
        `Obdob√≠: ${years[0].year} ‚Äì ${years[years.length - 1].year} | Lokalita: ${location.name} | Poƒçet let: ${years.length}`;

      renderAnalyzeMainStats(years);
      renderAnalyzeExtremes(years);
      renderAnalyzeTrends(years);
      renderAnalyzeCharts(years);
      renderDecadeComparison(years);
      
      // Nov√© pokroƒçil√© analytick√© funkce
      renderStatisticalVariability(years);
      renderClimateIndices(years);
      renderSeasonalAnalysis(years);
      renderVegetationPeriod(years);
      renderAdvancedTrends(years);
      renderPrecipitationAnalysis(years);
      renderClimateNormal(years);
      
      // Reinicializace tooltip≈Ø pro v≈°echny nov√© sekce
      initAnalyzeTooltips();
      
      showDataQualityInfo(years);
    }

    function showDataQualityInfo(years) {
      const missingData = years.filter(y => 
        y.avgTemp === null || 
        y.totalPrecip === null || 
        y.avgCloud === null
      ).length;
      
      const completeness = ((years.length - missingData) / years.length * 100).toFixed(1);
      
      let qualityText = '';
      if (completeness >= 95) {
        qualityText = `‚úÖ Vynikaj√≠c√≠ kvalita dat (√∫plnost ${completeness}%).`;
      } else if (completeness >= 80) {
        qualityText = `‚ö†Ô∏è Dobr√° kvalita dat (√∫plnost ${completeness}%). Nƒõkter√© roky obsahuj√≠ chybƒõj√≠c√≠ hodnoty.`;
      } else {
        qualityText = `‚ùå Omezen√° kvalita dat (√∫plnost ${completeness}%). V√Ωsledky anal√Ωzy mohou b√Ωt m√©nƒõ spolehliv√©.`;
      }
      
      qualityText += `<br>‚Ä¢ ${missingData} z ${years.length} let obsahuje chybƒõj√≠c√≠ data`;
      qualityText += `<br>‚Ä¢ Nejdel≈°√≠ nep≈ôeru≈°en√° ≈ôada: ${findLongestConsecutiveSeries(years)} let`;
      qualityText += `<br>‚Ä¢ Pr≈Ømƒõrn√° d√©lka meteorologick√© sez√≥ny: ${calculateAverageSeasonLength(years).toFixed(0)} dn≈Ø`;
      
      document.getElementById('dataQualityContent').innerHTML = qualityText;
      document.getElementById('dataQualityInfo').style.display = 'block';
    }

    // Upraven√° funkce pro hlavn√≠ statistiky s tooltipy
    function renderAnalyzeMainStats(years) {
      const avgTemps = years.map(y => y.avgTemp).filter(v => v !== null);
      const totalPrecips = years.map(y => y.totalPrecip).filter(v => v !== null);
      const avgClouds = years.map(y => y.avgCloud).filter(v => v !== null);
      const avgHumidities = years.map(y => y.avgHumidity).filter(v => v !== null);
      const avgWinds = years.map(y => y.avgWind).filter(v => v !== null);
      const summerDays = years.map(y => y.summerDays).filter(v => v !== undefined);
      const frostDays = years.map(y => y.frostDays).filter(v => v !== undefined);
      const tropicalDays = years.map(y => y.tropicalDays).filter(v => v !== undefined);

      const overallAvgTemp = avgTemps.length ? (avgTemps.reduce((a, b) => a + b, 0) / avgTemps.length).toFixed(2) : '‚Äî';
      const overallAvgPrecip = totalPrecips.length ? (totalPrecips.reduce((a, b) => a + b, 0) / totalPrecips.length).toFixed(0) : '‚Äî';
      const overallAvgCloud = avgClouds.length ? (avgClouds.reduce((a, b) => a + b, 0) / avgClouds.length).toFixed(0) : '‚Äî';
      const overallAvgHumidity = avgHumidities.length ? (avgHumidities.reduce((a, b) => a + b, 0) / avgHumidities.length).toFixed(0) : '‚Äî';
      const overallAvgWind = avgWinds.length ? (avgWinds.reduce((a, b) => a + b, 0) / avgWinds.length).toFixed(1) : '‚Äî';
      const avgSummerDays = summerDays.length ? (summerDays.reduce((a, b) => a + b, 0) / summerDays.length).toFixed(1) : '‚Äî';
      const avgFrostDays = frostDays.length ? (frostDays.reduce((a, b) => a + b, 0) / frostDays.length).toFixed(1) : '‚Äî';
      const avgTropicalDays = tropicalDays.length ? (tropicalDays.reduce((a, b) => a + b, 0) / tropicalDays.length).toFixed(1) : '‚Äî';

      // V√Ωpoƒçet variability (smƒõrodatn√° odchylka)
      const tempStdDev = avgTemps.length ? Math.sqrt(avgTemps.map(x => Math.pow(x - parseFloat(overallAvgTemp), 2)).reduce((a, b) => a + b, 0) / avgTemps.length).toFixed(2) : '‚Äî';
      const precipStdDev = totalPrecips.length ? Math.sqrt(totalPrecips.map(x => Math.pow(x - parseFloat(overallAvgPrecip), 2)).reduce((a, b) => a + b, 0) / totalPrecips.length).toFixed(0) : '‚Äî';

      const html = `
        <div class="analyze-stat-card">
          <div class="analyze-stat-header">
            <div class="analyze-stat-title">
              <span class="analyze-stat-icon">üå°Ô∏è</span>
              <span>Pr≈Ømƒõrn√° teplota</span>
            </div>
            <button class="info-btn" data-tooltip="avg-temp">i</button>
            <div class="info-tooltip" id="tooltip-avg-temp">
              <div class="tooltip-title">Pr≈Ømƒõrn√° roƒçn√≠ teplota</div>
              <div class="tooltip-content">
                Aritmetick√Ω pr≈Ømƒõr v≈°ech roƒçn√≠ch pr≈Ømƒõrn√Ωch teplot v analyzovan√©m obdob√≠. 
                Z√°kladn√≠ ukazatel dlouhodob√©ho klimatick√©ho norm√°lu lokality.
              </div>
            </div>
          </div>
          <div class="analyze-stat-value">${overallAvgTemp}<span class="analyze-stat-unit">¬∞C</span></div>
          <div class="analyze-stat-description">
            Variabilita: ¬±${tempStdDev}¬∞C<br>
            Rozsah: ${Math.min(...avgTemps).toFixed(1)}‚Äì${Math.max(...avgTemps).toFixed(1)}¬∞C
          </div>
        </div>

        <div class="analyze-stat-card">
          <div class="analyze-stat-header">
            <div class="analyze-stat-title">
              <span class="analyze-stat-icon">üåßÔ∏è</span>
              <span>Roƒçn√≠ sr√°≈æky</span>
            </div>
            <button class="info-btn" data-tooltip="avg-precip">i</button>
            <div class="info-tooltip" id="tooltip-avg-precip">
              <div class="tooltip-title">Pr≈Ømƒõrn√© roƒçn√≠ sr√°≈æky</div>
              <div class="tooltip-content">
                Celkov√© mno≈æstv√≠ sr√°≈æek za rok v milimetrech vodn√≠ho sloupce. 
                Zahrnuje v≈°echny formy sr√°≈æek (d√©≈°≈•, sn√≠h, kroupy).
              </div>
            </div>
          </div>
          <div class="analyze-stat-value">${overallAvgPrecip}<span class="analyze-stat-unit">mm</span></div>
          <div class="analyze-stat-description">
            Variabilita: ¬±${precipStdDev} mm<br>
            Rozsah: ${Math.min(...totalPrecips).toFixed(0)}‚Äì${Math.max(...totalPrecips).toFixed(0)} mm
          </div>
        </div>

        <div class="analyze-stat-card">
          <div class="analyze-stat-header">
            <div class="analyze-stat-title">
              <span class="analyze-stat-icon">üåû</span>
              <span>Letn√≠ dny/rok</span>
            </div>
            <button class="info-btn" data-tooltip="summer-days">i</button>
            <div class="info-tooltip" id="tooltip-summer-days">
              <div class="tooltip-title">Letn√≠ dny</div>
              <div class="tooltip-content">
                Poƒçet dn≈Ø v roce s maxim√°ln√≠ teplotou ‚â•25¬∞C. 
                Ukazatel d√©lky a intenzity l√©ta.
              </div>
            </div>
          </div>
          <div class="analyze-stat-value">${avgSummerDays}<span class="analyze-stat-unit">dn≈Ø</span></div>
          <div class="analyze-stat-description">
            Pr≈Ømƒõrnƒõ ${(avgSummerDays / 365 * 100).toFixed(1)}% roku<br>
            Trend: ${calculateTrendPerDecade(years.map(y => y.summerDays)) > 0 ? '‚Üó' : '‚Üò'}
          </div>
        </div>

        <div class="analyze-stat-card">
          <div class="analyze-stat-header">
            <div class="analyze-stat-title">
              <span class="analyze-stat-icon">ü•∂</span>
              <span>Mrazov√© dny/rok</span>
            </div>
            <button class="info-btn" data-tooltip="frost-days">i</button>
            <div class="info-tooltip" id="tooltip-frost-days">
              <div class="tooltip-title">Mrazov√© dny</div>
              <div class="tooltip-content">
                Poƒçet dn≈Ø v roce s minim√°ln√≠ teplotou <0¬∞C. 
                Ukazatel d√©lky a intenzity zimy.
              </div>
            </div>
          </div>
          <div class="analyze-stat-value">${avgFrostDays}<span class="analyze-stat-unit">dn≈Ø</span></div>
          <div class="analyze-stat-description">
            Pr≈Ømƒõrnƒõ ${(avgFrostDays / 365 * 100).toFixed(1)}% roku<br>
            Trend: ${calculateTrendPerDecade(years.map(y => y.frostDays)) < 0 ? '‚Üó' : '‚Üò'}
          </div>
        </div>

        <div class="analyze-stat-card">
          <div class="analyze-stat-header">
            <div class="analyze-stat-title">
              <span class="analyze-stat-icon">‚òÅÔ∏è</span>
              <span>Oblaƒçnost</span>
            </div>
            <button class="info-btn" data-tooltip="cloudiness">i</button>
            <div class="info-tooltip" id="tooltip-cloudiness">
              <div class="tooltip-title">Pr≈Ømƒõrn√° oblaƒçnost</div>
              <div class="tooltip-content">
                Pr≈Ømƒõrn√© pokryt√≠ oblohy mraky v procentech. 
                0% = jasno, 100% = zcela zata≈æeno.
              </div>
            </div>
          </div>
          <div class="analyze-stat-value">${overallAvgCloud}<span class="analyze-stat-unit">%</span></div>
          <div class="analyze-stat-description">
            Rozsah: ${Math.min(...avgClouds).toFixed(0)}‚Äì${Math.max(...avgClouds).toFixed(0)}%<br>
            ${overallAvgCloud > 60 ? 'Vysok√°' : overallAvgCloud > 40 ? 'St≈ôedn√≠' : 'N√≠zk√°'} oblaƒçnost
          </div>
        </div>

        <div class="analyze-stat-card">
          <div class="analyze-stat-header">
            <div class="analyze-stat-title">
              <span class="analyze-stat-icon">üí®</span>
              <span>Rychlost vƒõtru</span>
            </div>
            <button class="info-btn" data-tooltip="wind-speed">i</button>
            <div class="info-tooltip" id="tooltip-wind-speed">
              <div class="tooltip-title">Pr≈Ømƒõrn√° rychlost vƒõtru</div>
              <div class="tooltip-content">
                Pr≈Ømƒõrn√° rychlost vƒõtru v kilometrech za hodinu ve v√Ω≈°ce 10 metr≈Ø. 
                Mƒõ≈ô√≠ se v anemometrick√© v√Ω≈°ce standardnƒõ pou≈æ√≠van√© v meteorologii.
              </div>
            </div>
          </div>
          <div class="analyze-stat-value">${overallAvgWind}<span class="analyze-stat-unit">km/h</span></div>
          <div class="analyze-stat-description">
            ${overallAvgWind > 15 ? 'Vƒõtrn√°' : overallAvgWind > 8 ? 'M√≠rnƒõ vƒõtrn√°' : 'Klidn√°'} lokalita<br>
            Rozsah: ${Math.min(...avgWinds).toFixed(1)}‚Äì${Math.max(...avgWinds).toFixed(1)} km/h
          </div>
        </div>

        <div class="analyze-stat-card ${avgTropicalDays > 10 ? 'warning' : avgTropicalDays > 5 ? 'positive' : ''}">
          <div class="analyze-stat-header">
            <div class="analyze-stat-title">
              <span class="analyze-stat-icon">üèùÔ∏è</span>
              <span>Tropick√© dny/rok</span>
            </div>
            <button class="info-btn" data-tooltip="tropical-days">i</button>
            <div class="info-tooltip" id="tooltip-tropical-days">
              <div class="tooltip-title">Tropick√© dny</div>
              <div class="tooltip-content">
                Poƒçet dn≈Ø v roce s maxim√°ln√≠ teplotou ‚â•30¬∞C. 
                Extr√©mn√≠ teplotn√≠ jev s dopady na zdrav√≠ a infrastrukturu.
              </div>
            </div>
          </div>
          <div class="analyze-stat-value">${avgTropicalDays}<span class="analyze-stat-unit">dn≈Ø</span></div>
          <div class="analyze-stat-description">
            ${avgTropicalDays > 10 ? 'Vysok√Ω v√Ωskyt' : avgTropicalDays > 5 ? 'St≈ôedn√≠ v√Ωskyt' : 'N√≠zk√Ω v√Ωskyt'}<br>
            Trend: ${calculateTrendPerDecade(years.map(y => y.tropicalDays)) > 0 ? '‚Üó Rostouc√≠' : '‚Üò Klesaj√≠c√≠'}
          </div>
        </div>

        <div class="analyze-stat-card">
          <div class="analyze-stat-header">
            <div class="analyze-stat-title">
              <span class="analyze-stat-icon">üìÖ</span>
              <span>D√©lka ≈ôady</span>
            </div>
            <button class="info-btn" data-tooltip="data-length">i</button>
            <div class="info-tooltip" id="tooltip-data-length">
              <div class="tooltip-title">D√©lka datov√© ≈ôady</div>
              <div class="tooltip-content">
                Poƒçet let v analyzovan√©m obdob√≠. Del≈°√≠ ≈ôady poskytuj√≠ 
                spolehlivƒõj≈°√≠ odhady trend≈Ø a klimatick√©ho norm√°lu.
              </div>
            </div>
          </div>
          <div class="analyze-stat-value">${years.length}<span class="analyze-stat-unit">let</span></div>
          <div class="analyze-stat-description">
            ${years.length >= 30 ? 'Dostateƒçn√° d√©lka' : years.length >= 20 ? 'St≈ôedn√≠ d√©lka' : 'Kr√°tk√° ≈ôada'}<br>
            ${years[0].year}‚Äì${years[years.length-1].year}
          </div>
        </div>
      `;

      document.getElementById('analyzeMainStats').innerHTML = html;
      initAnalyzeTooltips();
    }

    function renderAnalyzeExtremes(years) {
      // Teplotn√≠ extr√©my
      const maxTempYear = years.reduce((max, y) => (y.maxTemp > (max?.maxTemp || -999)) ? y : max, null);
      const minTempYear = years.reduce((min, y) => (y.minTemp < (min?.minTemp || 999)) ? y : min, null);
      const warmestYear = years.reduce((max, y) => (y.avgTemp > (max?.avgTemp || -999)) ? y : max, null);
      const coldestYear = years.reduce((min, y) => (y.avgTemp < (min?.avgTemp || 999)) ? y : min, null);

      document.getElementById('analyzeTempExtremes').innerHTML = `
        <div class="extreme-item">
          <span class="label">üî• Nejvy≈°≈°√≠ teplota</span>
          <span><span class="value" style="color: #ff6b6b;">${maxTempYear?.maxTemp?.toFixed(1) || '‚Äî'}¬∞C</span><span class="year">(${maxTempYear?.year || '‚Äî'})</span></span>
        </div>
        <div class="extreme-item">
          <span class="label">‚ùÑÔ∏è Nejni≈æ≈°√≠ teplota</span>
          <span><span class="value" style="color: #4ecdc4;">${minTempYear?.minTemp?.toFixed(1) || '‚Äî'}¬∞C</span><span class="year">(${minTempYear?.year || '‚Äî'})</span></span>
        </div>
        <div class="extreme-item">
          <span class="label">‚òÄÔ∏è Nejteplej≈°√≠ rok</span>
          <span><span class="value" style="color: #ffd93d;">${warmestYear?.avgTemp?.toFixed(2) || '‚Äî'}¬∞C</span><span class="year">(${warmestYear?.year || '‚Äî'})</span></span>
        </div>
        <div class="extreme-item">
          <span class="label">ü•∂ Nejchladnƒõj≈°√≠ rok</span>
          <span><span class="value" style="color: #74b9ff;">${coldestYear?.avgTemp?.toFixed(2) || '‚Äî'}¬∞C</span><span class="year">(${coldestYear?.year || '‚Äî'})</span></span>
        </div>
      `;

      // Sr√°≈ækov√© extr√©my
      const wettest = years.reduce((max, y) => (y.totalPrecip > (max?.totalPrecip || 0)) ? y : max, null);
      const driest = years.reduce((min, y) => (y.totalPrecip < (min?.totalPrecip || 99999)) ? y : min, null);
      const mostRainyDays = years.reduce((max, y) => (y.rainyDays > (max?.rainyDays || 0)) ? y : max, null);
      const mostSnowDays = years.reduce((max, y) => (y.snowDays > (max?.snowDays || 0)) ? y : max, null);

      document.getElementById('analyzePrecipExtremes').innerHTML = `
        <div class="extreme-item">
          <span class="label">üåßÔ∏è Nejv√≠ce sr√°≈æek</span>
          <span><span class="value" style="color: #74b9ff;">${wettest?.totalPrecip?.toFixed(0) || '‚Äî'} mm</span><span class="year">(${wettest?.year || '‚Äî'})</span></span>
        </div>
        <div class="extreme-item">
          <span class="label">‚òÄÔ∏è Nejm√©nƒõ sr√°≈æek</span>
          <span><span class="value" style="color: #ffeaa7;">${driest?.totalPrecip?.toFixed(0) || '‚Äî'} mm</span><span class="year">(${driest?.year || '‚Äî'})</span></span>
        </div>
        <div class="extreme-item">
          <span class="label">üíß Nejv√≠ce de≈°≈•. dn≈Ø</span>
          <span><span class="value">${mostRainyDays?.rainyDays || '‚Äî'}</span><span class="year">(${mostRainyDays?.year || '‚Äî'})</span></span>
        </div>
        <div class="extreme-item">
          <span class="label">‚ùÑÔ∏è Nejv√≠ce snƒõh. dn≈Ø</span>
          <span><span class="value">${mostSnowDays?.snowDays || '‚Äî'}</span><span class="year">(${mostSnowDays?.year || '‚Äî'})</span></span>
        </div>
      `;
    }

    function renderAnalyzeTrends(years) {
      // Line√°rn√≠ regrese pro trendy
      function linearRegression(data) {
        const validData = data.filter(v => v !== null && v !== undefined);
        const n = validData.length;
        if (n < 2) return { slope: 0, intercept: 0 };
        
        let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
        for (let i = 0; i < n; i++) {
          sumX += i;
          sumY += validData[i];
          sumXY += i * validData[i];
          sumXX += i * i;
        }
        
        const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
        const intercept = (sumY - slope * sumX) / n;
        
        return { slope, intercept };
      }

      const tempData = years.filter(y => y.avgTemp !== null).map(y => y.avgTemp);
      const precipData = years.filter(y => y.totalPrecip !== null).map(y => y.totalPrecip);
      const summerData = years.filter(y => y.summerDays !== undefined).map(y => y.summerDays);
      const frostData = years.filter(y => y.frostDays !== undefined).map(y => y.frostDays);

      const tempTrend = linearRegression(tempData);
      const precipTrend = linearRegression(precipData);
      const summerTrend = linearRegression(summerData);
      const frostTrend = linearRegression(frostData);

      // Trend za dek√°du (10 let)
      const tempPerDecade = (tempTrend.slope * 10).toFixed(2);
      const precipPerDecade = (precipTrend.slope * 10).toFixed(1);
      const summerPerDecade = (summerTrend.slope * 10).toFixed(1);
      const frostPerDecade = (frostTrend.slope * 10).toFixed(1);

      function trendClass(value, inverse = false) {
        const v = parseFloat(value);
        if (Math.abs(v) < 0.1) return 'neutral';
        if (inverse) return v > 0 ? 'negative' : 'positive';
        return v > 0 ? 'positive' : 'negative';
      }

      document.getElementById('analyzeTrends').innerHTML = `
        <div class="trend-item">
          <span class="label">üå°Ô∏è Teplota</span>
          <span class="value ${trendClass(tempPerDecade)}">${tempPerDecade > 0 ? '+' : ''}${tempPerDecade}¬∞C / 10 let</span>
        </div>
        <div class="trend-item">
          <span class="label">üåßÔ∏è Sr√°≈æky</span>
          <span class="value ${trendClass(precipPerDecade)}">${precipPerDecade > 0 ? '+' : ''}${precipPerDecade} mm / 10 let</span>
        </div>
        <div class="trend-item">
          <span class="label">üåû Letn√≠ dny</span>
          <span class="value ${trendClass(summerPerDecade)}">${summerPerDecade > 0 ? '+' : ''}${summerPerDecade} dn≈Ø / 10 let</span>
        </div>
        <div class="trend-item">
          <span class="label">ü•∂ Mrazov√© dny</span>
          <span class="value ${trendClass(frostPerDecade, true)}">${frostPerDecade > 0 ? '+' : ''}${frostPerDecade} dn≈Ø / 10 let</span>
        </div>
      `;
    }

    function renderAnalyzeCharts(years) {
      const labels = years.map(y => y.year);

      // Graf teploty
      if (charts.analyzeTemp) charts.analyzeTemp.destroy();
      const ctx1 = document.getElementById('analyzeTempChart').getContext('2d');

      // Klouzav√Ω pr≈Ømƒõr (5 let)
      const movingAvg = [];
      for (let i = 0; i < years.length; i++) {
        const start = Math.max(0, i - 2);
        const end = Math.min(years.length, i + 3);
        const slice = years.slice(start, end).map(y => y.avgTemp).filter(v => v !== null);
        movingAvg.push(slice.length ? slice.reduce((a, b) => a + b, 0) / slice.length : null);
      }

      charts.analyzeTemp = new Chart(ctx1, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Pr≈Ømƒõrn√° teplota',
              data: years.map(y => y.avgTemp),
              borderColor: '#ff6b6b',
              backgroundColor: 'rgba(255, 107, 107, 0.1)',
              fill: true,
              tension: 0.3,
              pointRadius: 2
            },
            {
              label: 'Klouzav√Ω pr≈Ømƒõr (5 let)',
              data: movingAvg,
              borderColor: '#ffd93d',
              borderWidth: 3,
              pointRadius: 0,
              tension: 0.4
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { labels: { color: '#e0e0e0' } } },
          scales: {
            x: { grid: { color: '#404040' }, ticks: { color: '#888', maxTicksLimit: 20 } },
            y: { grid: { color: '#404040' }, ticks: { color: '#888', callback: v => `${v}¬∞C` } }
          }
        }
      });

      // Graf sr√°≈æek
      if (charts.analyzePrecip) charts.analyzePrecip.destroy();
      const ctx2 = document.getElementById('analyzePrecipChart').getContext('2d');

      charts.analyzePrecip = new Chart(ctx2, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Roƒçn√≠ sr√°≈æky (mm)',
            data: years.map(y => y.totalPrecip),
            backgroundColor: 'rgba(116, 185, 255, 0.6)',
            borderColor: '#74b9ff',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { labels: { color: '#e0e0e0' } } },
          scales: {
            x: { grid: { color: '#404040' }, ticks: { color: '#888', maxTicksLimit: 20 } },
            y: { grid: { color: '#404040' }, ticks: { color: '#888', callback: v => `${v} mm` }, beginAtZero: true }
          }
        }
      });

      // Graf speci√°ln√≠ch dn≈Ø
      if (charts.analyzeDays) charts.analyzeDays.destroy();
      const ctx3 = document.getElementById('analyzeDaysChart').getContext('2d');

      charts.analyzeDays = new Chart(ctx3, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Letn√≠ dny (‚â•25¬∞C)',
              data: years.map(y => y.summerDays),
              borderColor: '#ffd93d',
              tension: 0.3,
              pointRadius: 2
            },
            {
              label: 'Tropick√© dny (‚â•30¬∞C)',
              data: years.map(y => y.tropicalDays),
              borderColor: '#ff6b6b',
              tension: 0.3,
              pointRadius: 2
            },
            {
              label: 'Mrazov√© dny (<0¬∞C)',
              data: years.map(y => y.frostDays),
              borderColor: '#4ecdc4',
              tension: 0.3,
              pointRadius: 2
            },
            {
              label: 'Ledov√© dny (max<0¬∞C)',
              data: years.map(y => y.iceDays),
              borderColor: '#74b9ff',
              tension: 0.3,
              pointRadius: 2
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { labels: { color: '#e0e0e0' } } },
          scales: {
            x: { grid: { color: '#404040' }, ticks: { color: '#888', maxTicksLimit: 20 } },
            y: { grid: { color: '#404040' }, ticks: { color: '#888' }, beginAtZero: true }
          }
        }
      });
    }

    function renderDecadeComparison(years) {
      const decades = {};
      
      for (const year of years) {
        const decade = Math.floor(year.year / 10) * 10;
        if (!decades[decade]) {
          decades[decade] = [];
        }
        decades[decade].push(year);
      }

      let html = '';
      const sortedDecades = Object.keys(decades).sort((a, b) => b - a);

      for (const decade of sortedDecades) {
        const data = decades[decade];
        const avgTemp = data.map(y => y.avgTemp).filter(v => v !== null);
        const avgPrecip = data.map(y => y.totalPrecip).filter(v => v !== null);
        const summerDays = data.map(y => y.summerDays).filter(v => v !== undefined);
        const frostDays = data.map(y => y.frostDays).filter(v => v !== undefined);

        html += `
          <div class="decade-card">
            <h4>${decade}‚Äì${parseInt(decade) + 9}</h4>
            <div class="decade-stat">
              <span class="label">üå°Ô∏è Pr≈Øm. teplota</span>
              <span class="value">${avgTemp.length ? (avgTemp.reduce((a,b) => a+b, 0) / avgTemp.length).toFixed(2) : '‚Äî'}¬∞C</span>
            </div>
            <div class="decade-stat">
              <span class="label">üåßÔ∏è Pr≈Øm. sr√°≈æky</span>
              <span class="value">${avgPrecip.length ? (avgPrecip.reduce((a,b) => a+b, 0) / avgPrecip.length).toFixed(0) : '‚Äî'} mm</span>
            </div>
            <div class="decade-stat">
              <span class="label">üåû Pr≈Øm. letn√≠ch dn≈Ø</span>
              <span class="value">${summerDays.length ? (summerDays.reduce((a,b) => a+b, 0) / summerDays.length).toFixed(0) : '‚Äî'}</span>
            </div>
            <div class="decade-stat">
              <span class="label">ü•∂ Pr≈Øm. mrazov√Ωch</span>
              <span class="value">${frostDays.length ? (frostDays.reduce((a,b) => a+b, 0) / frostDays.length).toFixed(0) : '‚Äî'}</span>
            </div>
            <div class="decade-stat">
              <span class="label">üìÖ Poƒçet let</span>
              <span class="value">${data.length}</span>
            </div>
          </div>
        `;
      }

      document.getElementById('decadeComparison').innerHTML = html;
    }

    // ===== NOV√â POKROƒåIL√â ANALYTICK√â FUNKCE =====

    // Pomocn√© statistick√© funkce
    function calculatePercentile(arr, p) {
      const sorted = [...arr].filter(v => v !== null && v !== undefined).sort((a, b) => a - b);
      if (sorted.length === 0) return null;
      const index = (p / 100) * (sorted.length - 1);
      const lower = Math.floor(index);
      const upper = Math.ceil(index);
      if (lower === upper) return sorted[lower];
      return sorted[lower] + (sorted[upper] - sorted[lower]) * (index - lower);
    }

    function calculateStdDev(arr) {
      const valid = arr.filter(v => v !== null && v !== undefined);
      if (valid.length < 2) return null;
      const mean = valid.reduce((a, b) => a + b, 0) / valid.length;
      const squaredDiffs = valid.map(v => Math.pow(v - mean, 2));
      return Math.sqrt(squaredDiffs.reduce((a, b) => a + b, 0) / valid.length);
    }

    function calculateCV(arr) {
      const valid = arr.filter(v => v !== null && v !== undefined);
      if (valid.length < 2) return null;
      const mean = valid.reduce((a, b) => a + b, 0) / valid.length;
      if (mean === 0) return null;
      const stdDev = calculateStdDev(arr);
      return (stdDev / Math.abs(mean)) * 100;
    }

    // Mann-Kendall test pro trend
    function mannKendallTest(data) {
      const valid = data.filter(v => v !== null && v !== undefined);
      const n = valid.length;
      if (n < 4) return { z: 0, significant: false };
      
      let s = 0;
      for (let i = 0; i < n - 1; i++) {
        for (let j = i + 1; j < n; j++) {
          if (valid[j] > valid[i]) s++;
          else if (valid[j] < valid[i]) s--;
        }
      }
      
      const variance = (n * (n - 1) * (2 * n + 5)) / 18;
      let z = 0;
      if (s > 0) z = (s - 1) / Math.sqrt(variance);
      else if (s < 0) z = (s + 1) / Math.sqrt(variance);
      
      return {
        z: z,
        significant: Math.abs(z) > 1.96
      };
    }

    // Sen's slope estimator
    function sensSlope(data) {
      const valid = data.filter(v => v !== null && v !== undefined);
      const n = valid.length;
      if (n < 2) return null;
      
      const slopes = [];
      for (let i = 0; i < n - 1; i++) {
        for (let j = i + 1; j < n; j++) {
          slopes.push((valid[j] - valid[i]) / (j - i));
        }
      }
      
      slopes.sort((a, b) => a - b);
      return slopes[Math.floor(slopes.length / 2)];
    }

    // Line√°rn√≠ regrese s R¬≤
    function linearRegressionWithR2(data) {
      const valid = data.filter(v => v !== null && v !== undefined);
      const n = valid.length;
      if (n < 2) return { slope: 0, intercept: 0, r2: 0 };
      
      let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0, sumYY = 0;
      for (let i = 0; i < n; i++) {
        sumX += i;
        sumY += valid[i];
        sumXY += i * valid[i];
        sumXX += i * i;
        sumYY += valid[i] * valid[i];
      }
      
      const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
      const intercept = (sumY - slope * sumX) / n;
      
      // R¬≤ calculation
      const yMean = sumY / n;
      let ssTot = 0, ssRes = 0;
      for (let i = 0; i < n; i++) {
        const yPred = intercept + slope * i;
        ssTot += Math.pow(valid[i] - yMean, 2);
        ssRes += Math.pow(valid[i] - yPred, 2);
      }
      const r2 = ssTot > 0 ? 1 - (ssRes / ssTot) : 0;
      
      return { slope, intercept, r2 };
    }

    // Render statistick√© variability
    function renderStatisticalVariability(years) {
      const temps = years.map(y => y.avgTemp).filter(v => v !== null);
      const precips = years.map(y => y.totalPrecip).filter(v => v !== null);
      
      const tempP10 = calculatePercentile(temps, 10);
      const tempP25 = calculatePercentile(temps, 25);
      const tempP50 = calculatePercentile(temps, 50);
      const tempP75 = calculatePercentile(temps, 75);
      const tempP90 = calculatePercentile(temps, 90);
      
      const precipP10 = calculatePercentile(precips, 10);
      const precipP25 = calculatePercentile(precips, 25);
      const precipP50 = calculatePercentile(precips, 50);
      const precipP75 = calculatePercentile(precips, 75);
      const precipP90 = calculatePercentile(precips, 90);
      
      const tempCV = calculateCV(temps);
      const precipCV = calculateCV(precips);
      const tempStd = calculateStdDev(temps);
      const precipStd = calculateStdDev(precips);
      
      document.getElementById('statisticalVariability').innerHTML = `
        <table class="stats-table">
          <thead>
            <tr>
              <th>Veliƒçina</th>
              <th>Smƒõr. odch. (œÉ)</th>
              <th>Var. koef. (CV)</th>
              <th>P10</th>
              <th>P25</th>
              <th>Medi√°n (P50)</th>
              <th>P75</th>
              <th>P90</th>
              <th>IQR</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>üå°Ô∏è Teplota (¬∞C)</td>
              <td class="value-cell">${tempStd?.toFixed(2) || '‚Äî'}</td>
              <td>${tempCV?.toFixed(1) || '‚Äî'}%</td>
              <td>${tempP10?.toFixed(1) || '‚Äî'}</td>
              <td>${tempP25?.toFixed(1) || '‚Äî'}</td>
              <td class="value-cell">${tempP50?.toFixed(2) || '‚Äî'}</td>
              <td>${tempP75?.toFixed(1) || '‚Äî'}</td>
              <td>${tempP90?.toFixed(1) || '‚Äî'}</td>
              <td>${tempP25 && tempP75 ? (tempP75 - tempP25).toFixed(2) : '‚Äî'}</td>
            </tr>
            <tr>
              <td>üåßÔ∏è Sr√°≈æky (mm)</td>
              <td class="value-cell">${precipStd?.toFixed(0) || '‚Äî'}</td>
              <td>${precipCV?.toFixed(1) || '‚Äî'}%</td>
              <td>${precipP10?.toFixed(0) || '‚Äî'}</td>
              <td>${precipP25?.toFixed(0) || '‚Äî'}</td>
              <td class="value-cell">${precipP50?.toFixed(0) || '‚Äî'}</td>
              <td>${precipP75?.toFixed(0) || '‚Äî'}</td>
              <td>${precipP90?.toFixed(0) || '‚Äî'}</td>
              <td>${precipP25 && precipP75 ? (precipP75 - precipP25).toFixed(0) : '‚Äî'}</td>
            </tr>
          </tbody>
        </table>
        <div style="margin-top: 15px; font-size: 0.8rem; color: #888;">
          <strong>Legenda:</strong> œÉ = smƒõrodatn√° odchylka, CV = variaƒçn√≠ koeficient (œÉ/pr≈Ømƒõr √ó 100), 
          P = percentil, IQR = mezikvartilov√© rozpƒõt√≠ (P75-P25)
        </div>
      `;
    }

    // Render klimatick√Ωch index≈Ø
    function renderClimateIndices(years) {
      // V√Ωpoƒçet index≈Ø
      const temps = years.map(y => y.avgTemp).filter(v => v !== null);
      const precips = years.map(y => y.totalPrecip).filter(v => v !== null);
      const maxTemps = years.map(y => y.maxTemp).filter(v => v !== null);
      const minTemps = years.map(y => y.minTemp).filter(v => v !== null);
      
      const avgTemp = temps.reduce((a, b) => a + b, 0) / temps.length;
      const avgPrecip = precips.reduce((a, b) => a + b, 0) / precips.length;
      
      // Teplotn√≠ amplituda (p≈ôibli≈ænƒõ l√©to - zima)
      const avgMax = maxTemps.reduce((a, b) => a + b, 0) / maxTemps.length;
      const avgMin = minTemps.reduce((a, b) => a + b, 0) / minTemps.length;
      const amplitude = avgMax - avgMin;
      
      // Index kontinentality (Gorczy≈Ñski) - zjednodu≈°en√Ω
      // K = 1.7 * A / sin(œÜ) - 20.4, kde A = roƒçn√≠ teplotn√≠ amplituda
      // Pro st≈ôedn√≠ zemƒõpisnou ≈°√≠≈ôku (~50¬∞) je sin(50¬∞) ‚âà 0.766
      const continentality = Math.min(100, Math.max(0, (1.7 * amplitude / 0.766) - 20.4));
      
      // Index aridity (De Martonne)
      // Ia = P / (T + 10), kde P = roƒçn√≠ sr√°≈æky (mm), T = pr≈Ømƒõrn√° teplota (¬∞C)
      const aridity = avgPrecip / (avgTemp + 10);
      
      // Klasifikace aridity
      let aridityClass = '';
      let aridityColor = '#4caf50';
      if (aridity < 10) { aridityClass = 'Aridn√≠ (pou≈°tn√≠)'; aridityColor = '#f44336'; }
      else if (aridity < 20) { aridityClass = 'Semi-aridn√≠ (stepn√≠)'; aridityColor = '#ff9800'; }
      else if (aridity < 30) { aridityClass = 'Sub-humidn√≠'; aridityColor = '#ffd93d'; }
      else if (aridity < 60) { aridityClass = 'Humidn√≠'; aridityColor = '#4caf50'; }
      else { aridityClass = 'Perhumidn√≠'; aridityColor = '#2196f3'; }
      
      // Klasifikace kontinentality
      let contClass = '';
      if (continentality < 25) contClass = 'Oce√°nsk√©';
      else if (continentality < 50) contClass = 'P≈ôechodn√©';
      else if (continentality < 75) contClass = 'Kontinent√°ln√≠';
      else contClass = 'Silnƒõ kontinent√°ln√≠';
      
      document.getElementById('climateIndices').innerHTML = `
        <div class="index-indicator">
          <div class="index-value" style="color: ${continentality > 50 ? '#ff9800' : '#4ecdc4'}">
            ${continentality.toFixed(1)}
          </div>
          <div class="index-label">Index kontinentality (Gorczy≈Ñski)</div>
          <div class="index-scale">
            <div class="index-pointer" style="left: ${continentality}%"></div>
          </div>
          <div style="display: flex; justify-content: space-between; width: 100%; font-size: 0.7rem; color: #888; margin-top: 5px;">
            <span>0 (oce√°nsk√©)</span>
            <span>100 (kontinent√°ln√≠)</span>
          </div>
          <div class="index-description">
            <strong>${contClass}</strong> klima. Roƒçn√≠ teplotn√≠ amplituda: ${amplitude.toFixed(1)}¬∞C
          </div>
        </div>
        
        <div class="index-indicator">
          <div class="index-value" style="color: ${aridityColor}">
            ${aridity.toFixed(1)}
          </div>
          <div class="index-label">Index aridity (De Martonne)</div>
          <div class="index-scale" style="background: linear-gradient(to right, #f44336, #ff9800, #ffd93d, #4caf50, #2196f3);">
            <div class="index-pointer" style="left: ${Math.min(100, aridity / 0.6)}%"></div>
          </div>
          <div style="display: flex; justify-content: space-between; width: 100%; font-size: 0.7rem; color: #888; margin-top: 5px;">
            <span>0 (aridn√≠)</span>
            <span>60+ (perhumidn√≠)</span>
          </div>
          <div class="index-description">
            <strong>${aridityClass}</strong>. Pomƒõr sr√°≈æek k teplotƒõ indikuje dostupnost vody pro vegetaci.
          </div>
        </div>
        
        <div class="index-indicator">
          <div class="index-value" style="color: #6aa6fd">
            ${amplitude.toFixed(1)}¬∞C
          </div>
          <div class="index-label">Roƒçn√≠ teplotn√≠ amplituda</div>
          <div class="index-description">
            Rozd√≠l mezi absolutn√≠m maximem (${avgMax.toFixed(1)}¬∞C) a minimem (${avgMin.toFixed(1)}¬∞C).
            ${amplitude > 50 ? 'Velmi vysok√°' : amplitude > 35 ? 'Vysok√°' : amplitude > 20 ? 'St≈ôedn√≠' : 'N√≠zk√°'} amplituda.
          </div>
        </div>
      `;
    }

    // Render sez√≥nn√≠ch charakteristik
    function renderSeasonalAnalysis(years) {
      // Pro ka≈æd√Ω rok pot≈ôebujeme mƒõs√≠ƒçn√≠ data - odhadneme ze stats pokud nejsou k dispozici
      // Zde pou≈æijeme zjednodu≈°en√Ω p≈ô√≠stup zalo≈æen√Ω na dostupn√Ωch datech
      
      const avgTemp = years.map(y => y.avgTemp).filter(v => v !== null);
      const avgPrecip = years.map(y => y.totalPrecip).filter(v => v !== null);
      const overallTemp = avgTemp.reduce((a, b) => a + b, 0) / avgTemp.length;
      const overallPrecip = avgPrecip.reduce((a, b) => a + b, 0) / avgPrecip.length;
      
      // Typick√© rozlo≈æen√≠ pro st≈ôedn√≠ Evropu (p≈ôibli≈æn√©)
      const seasonalFactors = {
        spring: { tempFactor: 0.9, precipFactor: 0.22 },  // III-V
        summer: { tempFactor: 1.8, precipFactor: 0.30 },  // VI-VIII
        autumn: { tempFactor: 1.0, precipFactor: 0.26 },  // IX-XI
        winter: { tempFactor: 0.3, precipFactor: 0.22 }   // XII-II
      };
      
      // Odhad sez√≥nn√≠ch hodnot
      const seasons = {
        spring: {
          temp: (overallTemp * seasonalFactors.spring.tempFactor).toFixed(1),
          precip: (overallPrecip * seasonalFactors.spring.precipFactor).toFixed(0)
        },
        summer: {
          temp: (overallTemp * seasonalFactors.summer.tempFactor).toFixed(1),
          precip: (overallPrecip * seasonalFactors.summer.precipFactor).toFixed(0)
        },
        autumn: {
          temp: (overallTemp * seasonalFactors.autumn.tempFactor).toFixed(1),
          precip: (overallPrecip * seasonalFactors.autumn.precipFactor).toFixed(0)
        },
        winter: {
          temp: (overallTemp * seasonalFactors.winter.tempFactor - 5).toFixed(1),
          precip: (overallPrecip * seasonalFactors.winter.precipFactor).toFixed(0)
        }
      };
      
      // Pr≈Ømƒõrn√© speci√°ln√≠ dny
      const summerDays = years.map(y => y.summerDays).filter(v => v !== undefined);
      const frostDays = years.map(y => y.frostDays).filter(v => v !== undefined);
      const avgSummer = summerDays.length ? (summerDays.reduce((a, b) => a + b, 0) / summerDays.length).toFixed(0) : '‚Äî';
      const avgFrost = frostDays.length ? (frostDays.reduce((a, b) => a + b, 0) / frostDays.length).toFixed(0) : '‚Äî';
      
      document.getElementById('seasonalAnalysis').innerHTML = `
        <div class="season-card spring">
          <div class="season-name">üå∏ Jaro (III‚ÄìV)</div>
          <div class="season-stat">
            <span class="season-stat-label">Pr≈Øm. teplota</span>
            <span class="season-stat-value">${seasons.spring.temp}¬∞C</span>
          </div>
          <div class="season-stat">
            <span class="season-stat-label">Sr√°≈æky</span>
            <span class="season-stat-value">${seasons.spring.precip} mm</span>
          </div>
          <div class="season-stat">
            <span class="season-stat-label">Charakter</span>
            <span class="season-stat-value">P≈ôechodn√©</span>
          </div>
        </div>
        
        <div class="season-card summer">
          <div class="season-name">‚òÄÔ∏è L√©to (VI‚ÄìVIII)</div>
          <div class="season-stat">
            <span class="season-stat-label">Pr≈Øm. teplota</span>
            <span class="season-stat-value">${seasons.summer.temp}¬∞C</span>
          </div>
          <div class="season-stat">
            <span class="season-stat-label">Sr√°≈æky</span>
            <span class="season-stat-value">${seasons.summer.precip} mm</span>
          </div>
          <div class="season-stat">
            <span class="season-stat-label">Letn√≠ dny/rok</span>
            <span class="season-stat-value">${avgSummer}</span>
          </div>
        </div>
        
        <div class="season-card autumn">
          <div class="season-name">üçÇ Podzim (IX‚ÄìXI)</div>
          <div class="season-stat">
            <span class="season-stat-label">Pr≈Øm. teplota</span>
            <span class="season-stat-value">${seasons.autumn.temp}¬∞C</span>
          </div>
          <div class="season-stat">
            <span class="season-stat-label">Sr√°≈æky</span>
            <span class="season-stat-value">${seasons.autumn.precip} mm</span>
          </div>
          <div class="season-stat">
            <span class="season-stat-label">Charakter</span>
            <span class="season-stat-value">P≈ôechodn√©</span>
          </div>
        </div>
        
        <div class="season-card winter">
          <div class="season-name">‚ùÑÔ∏è Zima (XII‚ÄìII)</div>
          <div class="season-stat">
            <span class="season-stat-label">Pr≈Øm. teplota</span>
            <span class="season-stat-value">${seasons.winter.temp}¬∞C</span>
          </div>
          <div class="season-stat">
            <span class="season-stat-label">Sr√°≈æky</span>
            <span class="season-stat-value">${seasons.winter.precip} mm</span>
          </div>
          <div class="season-stat">
            <span class="season-stat-label">Mraz. dny/rok</span>
            <span class="season-stat-value">${avgFrost}</span>
          </div>
        </div>
      `;
    }

    // Render vegetaƒçn√≠ho obdob√≠
    function renderVegetationPeriod(years) {
      // Odhad d√©lky vegetaƒçn√≠ho obdob√≠ a GDD
      const avgTemps = years.map(y => y.avgTemp).filter(v => v !== null);
      const avgTemp = avgTemps.reduce((a, b) => a + b, 0) / avgTemps.length;
      const frostDays = years.map(y => y.frostDays).filter(v => v !== undefined);
      const avgFrost = frostDays.length ? frostDays.reduce((a, b) => a + b, 0) / frostDays.length : 90;
      
      // Odhad vegetaƒçn√≠ho obdob√≠ (dny s T > 5¬∞C)
      // P≈ôibli≈æn√Ω vzorec zalo≈æen√Ω na pr≈Ømƒõrn√© teplotƒõ
      const vegPeriod = Math.round(180 + (avgTemp - 8) * 8);
      const vegPeriodClamped = Math.max(120, Math.min(280, vegPeriod));
      
      // GDD (Growing Degree Days) - suma teplot nad 5¬∞C
      // P≈ôibli≈æn√Ω odhad: GDD ‚âà vegetaƒçn√≠ obdob√≠ * (pr≈Ømƒõrn√° teplota v obdob√≠ - 5) * 0.7
      const gdd = Math.round(vegPeriodClamped * Math.max(0, (avgTemp + 5) - 5) * 0.7);
      
      // Bezmrazov√© obdob√≠
      const frostFreePeriod = Math.round(365 - avgFrost - 20); // Odeƒçteme p≈ôechodov√© dny
      
      // Prvn√≠ a posledn√≠ mr√°z (p≈ôibli≈æn√Ω odhad)
      const lastSpringFrost = new Date(2024, 3, 15 - Math.round((avgTemp - 8) * 3)); // Duben ¬± dny
      const firstAutumnFrost = new Date(2024, 9, 1 + Math.round((avgTemp - 8) * 3));  // ≈ò√≠jen ¬± dny
      
      document.getElementById('vegetationPeriod').innerHTML = `
        <div class="vegetation-timeline">
          <div class="timeline-labels">
            <span>Led</span><span>√öno</span><span>B≈ôe</span><span>Dub</span><span>Kvƒõ</span><span>ƒåer</span>
            <span>ƒåvc</span><span>Srp</span><span>Z√°≈ô</span><span>≈ò√≠j</span><span>Lis</span><span>Pro</span>
          </div>
          <div class="timeline-bar"></div>
          <div class="timeline-labels">
            <span style="color: #4ecdc4;">‚ùÑÔ∏è Zima</span>
            <span style="color: #4caf50;">üå± Vegetace</span>
            <span style="color: #ffd93d;">üåæ Vrchol</span>
            <span style="color: #795548;">üçÇ Podzim</span>
          </div>
        </div>
        
        <div class="vegetation-stats">
          <div class="compact-stat-item">
            <span class="compact-stat-label">üìÖ Vegetaƒçn√≠ obdob√≠ (T‚â•5¬∞C)</span>
            <span class="compact-stat-value">${vegPeriodClamped} dn≈Ø</span>
          </div>
          <div class="compact-stat-item">
            <span class="compact-stat-label">üå°Ô∏è GDD (suma teplot)</span>
            <span class="compact-stat-value">${gdd}¬∞C¬∑d</span>
          </div>
          <div class="compact-stat-item">
            <span class="compact-stat-label">üåø Bezmrazov√© obdob√≠</span>
            <span class="compact-stat-value">${frostFreePeriod} dn≈Ø</span>
          </div>
          <div class="compact-stat-item">
            <span class="compact-stat-label">üå∏ Posledn√≠ jarn√≠ mr√°z</span>
            <span class="compact-stat-value">~${lastSpringFrost.getDate()}.${lastSpringFrost.getMonth() + 1}.</span>
          </div>
          <div class="compact-stat-item">
            <span class="compact-stat-label">üçÇ Prvn√≠ podzimn√≠ mr√°z</span>
            <span class="compact-stat-value">~${firstAutumnFrost.getDate()}.${firstAutumnFrost.getMonth() + 1}.</span>
          </div>
          <div class="compact-stat-item">
            <span class="compact-stat-label">‚ùÑÔ∏è Mrazov√© dny/rok</span>
            <span class="compact-stat-value">${avgFrost.toFixed(0)}</span>
          </div>
        </div>
        
        <div style="margin-top: 15px; font-size: 0.8rem; color: #888;">
          <strong>Pozn√°mka:</strong> GDD (Growing Degree Days) je suma efektivn√≠ch teplot pro r≈Øst rostlin.
          Hodnoty jsou odhadnuty z roƒçn√≠ch pr≈Ømƒõr≈Ø - pro p≈ôesn√© √∫daje jsou pot≈ôeba denn√≠ data.
        </div>
      `;
    }

    // Render pokroƒçil√© anal√Ωzy trend≈Ø
    function renderAdvancedTrends(years) {
      const tempData = years.map(y => y.avgTemp);
      const precipData = years.map(y => y.totalPrecip);
      const summerData = years.map(y => y.summerDays);
      const frostData = years.map(y => y.frostDays);
      
      const tempRegression = linearRegressionWithR2(tempData);
      const precipRegression = linearRegressionWithR2(precipData);
      const summerRegression = linearRegressionWithR2(summerData);
      const frostRegression = linearRegressionWithR2(frostData);
      
      const tempMK = mannKendallTest(tempData);
      const precipMK = mannKendallTest(precipData);
      const summerMK = mannKendallTest(summerData);
      const frostMK = mannKendallTest(frostData);
      
      const tempSens = sensSlope(tempData);
      const precipSens = sensSlope(precipData);
      const summerSens = sensSlope(summerData);
      const frostSens = sensSlope(frostData);
      
      function renderTrendCard(title, icon, regression, mk, sens, unit, perDecade = true) {
        const trendValue = perDecade ? (regression.slope * 10).toFixed(2) : regression.slope.toFixed(2);
        const sensValue = perDecade ? (sens * 10).toFixed(2) : sens?.toFixed(2);
        const isSignificant = mk.significant;
        const trendDirection = regression.slope > 0 ? 'trend-up' : regression.slope < 0 ? 'trend-down' : 'trend-neutral';
        
        return `
          <div class="trend-analysis-card">
            <div class="trend-header">
              <div class="trend-title">${icon} ${title}</div>
              <span class="trend-badge ${isSignificant ? 'significant' : 'not-significant'}">
                ${isSignificant ? '‚úì Statisticky v√Ωznamn√Ω' : '‚óã Nev√Ωznamn√Ω'}
              </span>
            </div>
            <div class="trend-details">
              <div class="trend-detail-item">
                <div class="trend-detail-value ${trendDirection}">${trendValue > 0 ? '+' : ''}${trendValue}${unit}</div>
                <div class="trend-detail-label">Trend / ${perDecade ? '10 let' : 'rok'}</div>
              </div>
              <div class="trend-detail-item">
                <div class="trend-detail-value">${(regression.r2 * 100).toFixed(1)}%</div>
                <div class="trend-detail-label">R¬≤ (vysvƒõtlen√° var.)</div>
              </div>
              <div class="trend-detail-item">
                <div class="trend-detail-value">${mk.z.toFixed(2)}</div>
                <div class="trend-detail-label">Mann-Kendall Z</div>
              </div>
            </div>
          </div>
        `;
      }
      
      document.getElementById('advancedTrends').innerHTML = `
        ${renderTrendCard('Pr≈Ømƒõrn√° teplota', 'üå°Ô∏è', tempRegression, tempMK, tempSens, '¬∞C')}
        ${renderTrendCard('Roƒçn√≠ sr√°≈æky', 'üåßÔ∏è', precipRegression, precipMK, precipSens, ' mm')}
        ${renderTrendCard('Letn√≠ dny', 'üåû', summerRegression, summerMK, summerSens, ' dn≈Ø')}
        ${renderTrendCard('Mrazov√© dny', 'ü•∂', frostRegression, frostMK, frostSens, ' dn≈Ø')}
        
        <div style="margin-top: 15px; font-size: 0.8rem; color: #888;">
          <strong>Interpretace:</strong> R¬≤ &gt; 30% naznaƒçuje siln√Ω trend. Mann-Kendall Z: |Z| &gt; 1.96 = statisticky v√Ωznamn√Ω (p &lt; 0.05).
          Trendy za 10 let umo≈æ≈àuj√≠ snadnƒõj≈°√≠ interpretaci dlouhodob√Ωch zmƒõn.
        </div>
      `;
    }

    // Render sr√°≈ækov√© anal√Ωzy
    function renderPrecipitationAnalysis(years) {
      const precips = years.map(y => y.totalPrecip).filter(v => v !== null);
      const rainyDays = years.map(y => y.rainyDays).filter(v => v !== undefined);
      const snowDays = years.map(y => y.snowDays).filter(v => v !== undefined);
      
      const avgPrecip = precips.reduce((a, b) => a + b, 0) / precips.length;
      const stdPrecip = calculateStdDev(precips);
      const avgRainy = rainyDays.length ? rainyDays.reduce((a, b) => a + b, 0) / rainyDays.length : 0;
      
      // SPI pro ka≈æd√Ω rok
      const spiValues = precips.map(p => (p - avgPrecip) / stdPrecip);
      
      // Poƒçet such√Ωch a vlhk√Ωch let
      const dryYears = years.filter(y => y.totalPrecip && y.totalPrecip < avgPrecip * 0.8).length;
      const wetYears = years.filter(y => y.totalPrecip && y.totalPrecip > avgPrecip * 1.2).length;
      
      // Maxim√°ln√≠ sr√°≈æky
      const maxPrecip = Math.max(...precips);
      const minPrecip = Math.min(...precips);
      
      // Sr√°≈ækov√° intenzita
      const intensity = avgRainy > 0 ? avgPrecip / avgRainy : 0;
      
      // SPI klasifikace aktu√°ln√≠ho obdob√≠
      const latestYears = years.slice(-10);
      const latestPrecip = latestYears.map(y => y.totalPrecip).filter(v => v !== null);
      const latestAvg = latestPrecip.reduce((a, b) => a + b, 0) / latestPrecip.length;
      const currentSPI = (latestAvg - avgPrecip) / stdPrecip;
      
      let spiClass = '';
      let spiColor = '#4caf50';
      if (currentSPI >= 2) { spiClass = 'Extr√©mnƒõ vlhk√©'; spiColor = '#2196f3'; }
      else if (currentSPI >= 1) { spiClass = 'Velmi vlhk√©'; spiColor = '#4caf50'; }
      else if (currentSPI >= -1) { spiClass = 'Norm√°ln√≠'; spiColor = '#ffd93d'; }
      else if (currentSPI >= -2) { spiClass = 'Such√©'; spiColor = '#ff9800'; }
      else { spiClass = 'Extr√©mnƒõ such√©'; spiColor = '#f44336'; }
      
      document.getElementById('precipitationAnalysis').innerHTML = `
        <div class="compact-stats-grid">
          <div class="compact-stat-item">
            <span class="compact-stat-label">üìä Pr≈Øm. roƒçn√≠ sr√°≈æky</span>
            <span class="compact-stat-value">${avgPrecip.toFixed(0)} mm</span>
          </div>
          <div class="compact-stat-item">
            <span class="compact-stat-label">üìà Smƒõrodatn√° odchylka</span>
            <span class="compact-stat-value">¬±${stdPrecip?.toFixed(0) || '‚Äî'} mm</span>
          </div>
          <div class="compact-stat-item">
            <span class="compact-stat-label">üíß Sr√°≈ækov√° intenzita</span>
            <span class="compact-stat-value">${intensity.toFixed(1)} mm/den</span>
          </div>
          <div class="compact-stat-item">
            <span class="compact-stat-label">üåßÔ∏è Sr√°≈ækov√Ωch dn≈Ø/rok</span>
            <span class="compact-stat-value">${avgRainy.toFixed(0)}</span>
          </div>
          <div class="compact-stat-item">
            <span class="compact-stat-label">‚òÄÔ∏è Such√Ωch let (‚àí20%)</span>
            <span class="compact-stat-value ${dryYears > years.length * 0.3 ? 'warning' : ''}">${dryYears}</span>
          </div>
          <div class="compact-stat-item">
            <span class="compact-stat-label">üåä Vlhk√Ωch let (+20%)</span>
            <span class="compact-stat-value">${wetYears}</span>
          </div>
          <div class="compact-stat-item">
            <span class="compact-stat-label">‚¨ÜÔ∏è Max. roƒçn√≠ sr√°≈æky</span>
            <span class="compact-stat-value">${maxPrecip.toFixed(0)} mm</span>
          </div>
          <div class="compact-stat-item">
            <span class="compact-stat-label">‚¨áÔ∏è Min. roƒçn√≠ sr√°≈æky</span>
            <span class="compact-stat-value">${minPrecip.toFixed(0)} mm</span>
          </div>
        </div>
        
        <div style="margin-top: 20px; padding: 15px; background-color: #333; border-radius: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <span style="font-weight: 600;">SPI posledn√≠ch 10 let</span>
            <span style="color: ${spiColor}; font-weight: 600;">${currentSPI.toFixed(2)} (${spiClass})</span>
          </div>
          <div style="height: 8px; background: linear-gradient(to right, #f44336, #ff9800, #ffd93d, #4caf50, #2196f3); border-radius: 4px; position: relative;">
            <div style="position: absolute; top: -3px; left: ${Math.min(100, Math.max(0, (currentSPI + 3) / 6 * 100))}%; width: 14px; height: 14px; background: #fff; border-radius: 50%; transform: translateX(-50%); box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>
          </div>
          <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: #888; margin-top: 5px;">
            <span>‚àí3 (extr. sucho)</span>
            <span>0 (norm√°l)</span>
            <span>+3 (extr. vlhko)</span>
          </div>
        </div>
      `;
    }

    // Render klimatick√©ho norm√°lu
    function renderClimateNormal(years) {
      // WMO norm√°l 1991-2020
      const normalYears = years.filter(y => y.year >= 1991 && y.year <= 2020);
      const recentYears = years.filter(y => y.year > 2020);
      const oldYears = years.filter(y => y.year < 1991);
      
      if (normalYears.length < 20) {
        document.getElementById('climateNormal').innerHTML = `
          <div style="padding: 20px; text-align: center; color: #888;">
            <p>‚ö†Ô∏è Pro v√Ωpoƒçet klimatick√©ho norm√°lu (1991-2020) je pot≈ôeba alespo≈à 20 let dat z tohoto obdob√≠.</p>
            <p style="margin-top: 10px;">Aktu√°lnƒõ k dispozici: ${normalYears.length} let z referenƒçn√≠ho obdob√≠.</p>
          </div>
        `;
        return;
      }
      
      // V√Ωpoƒçet norm√°lu
      const normalTemps = normalYears.map(y => y.avgTemp).filter(v => v !== null);
      const normalPrecips = normalYears.map(y => y.totalPrecip).filter(v => v !== null);
      
      const normalTemp = normalTemps.reduce((a, b) => a + b, 0) / normalTemps.length;
      const normalPrecip = normalPrecips.reduce((a, b) => a + b, 0) / normalPrecips.length;
      
      // Porovn√°n√≠ s ned√°vn√Ωmi roky
      let recentTempDiff = '‚Äî';
      let recentPrecipDiff = '‚Äî';
      if (recentYears.length > 0) {
        const recentTemps = recentYears.map(y => y.avgTemp).filter(v => v !== null);
        const recentPrecips = recentYears.map(y => y.totalPrecip).filter(v => v !== null);
        if (recentTemps.length > 0) {
          const recentTemp = recentTemps.reduce((a, b) => a + b, 0) / recentTemps.length;
          recentTempDiff = (recentTemp - normalTemp).toFixed(2);
        }
        if (recentPrecips.length > 0) {
          const recentPrecip = recentPrecips.reduce((a, b) => a + b, 0) / recentPrecips.length;
          recentPrecipDiff = ((recentPrecip - normalPrecip) / normalPrecip * 100).toFixed(1);
        }
      }
      
      // Porovn√°n√≠ se star≈°√≠m obdob√≠m
      let oldTempDiff = '‚Äî';
      let oldPrecipDiff = '‚Äî';
      if (oldYears.length >= 10) {
        const oldTemps = oldYears.map(y => y.avgTemp).filter(v => v !== null);
        const oldPrecips = oldYears.map(y => y.totalPrecip).filter(v => v !== null);
        if (oldTemps.length > 0) {
          const oldTemp = oldTemps.reduce((a, b) => a + b, 0) / oldTemps.length;
          oldTempDiff = (oldTemp - normalTemp).toFixed(2);
        }
        if (oldPrecips.length > 0) {
          const oldPrecip = oldPrecips.reduce((a, b) => a + b, 0) / oldPrecips.length;
          oldPrecipDiff = ((oldPrecip - normalPrecip) / normalPrecip * 100).toFixed(1);
        }
      }
      
      document.getElementById('climateNormal').innerHTML = `
        <table class="stats-table">
          <thead>
            <tr>
              <th>Obdob√≠</th>
              <th>Roky</th>
              <th>Pr≈Øm. teplota</th>
              <th>Odchylka</th>
              <th>Pr≈Øm. sr√°≈æky</th>
              <th>Odchylka</th>
            </tr>
          </thead>
          <tbody>
            <tr style="background-color: rgba(106, 166, 253, 0.1);">
              <td><strong>üìã Norm√°l 1991-2020</strong></td>
              <td>${normalYears.length}</td>
              <td class="value-cell">${normalTemp.toFixed(2)}¬∞C</td>
              <td>‚Äî</td>
              <td class="value-cell">${normalPrecip.toFixed(0)} mm</td>
              <td>‚Äî</td>
            </tr>
            ${recentYears.length > 0 ? `
            <tr>
              <td>üìà Po roce 2020</td>
              <td>${recentYears.length}</td>
              <td>${recentYears.map(y => y.avgTemp).filter(v => v !== null).length > 0 ? 
                (recentYears.map(y => y.avgTemp).filter(v => v !== null).reduce((a,b) => a+b, 0) / 
                recentYears.map(y => y.avgTemp).filter(v => v !== null).length).toFixed(2) : '‚Äî'}¬∞C</td>
              <td class="${parseFloat(recentTempDiff) > 0 ? 'trend-up' : 'trend-down'}">${recentTempDiff !== '‚Äî' ? (parseFloat(recentTempDiff) > 0 ? '+' : '') + recentTempDiff + '¬∞C' : '‚Äî'}</td>
              <td>${recentYears.map(y => y.totalPrecip).filter(v => v !== null).length > 0 ?
                (recentYears.map(y => y.totalPrecip).filter(v => v !== null).reduce((a,b) => a+b, 0) /
                recentYears.map(y => y.totalPrecip).filter(v => v !== null).length).toFixed(0) : '‚Äî'} mm</td>
              <td class="${parseFloat(recentPrecipDiff) > 0 ? 'trend-up' : 'trend-down'}">${recentPrecipDiff !== '‚Äî' ? (parseFloat(recentPrecipDiff) > 0 ? '+' : '') + recentPrecipDiff + '%' : '‚Äî'}</td>
            </tr>
            ` : ''}
            ${oldYears.length >= 10 ? `
            <tr>
              <td>üìâ P≈ôed rokem 1991</td>
              <td>${oldYears.length}</td>
              <td>${oldYears.map(y => y.avgTemp).filter(v => v !== null).length > 0 ?
                (oldYears.map(y => y.avgTemp).filter(v => v !== null).reduce((a,b) => a+b, 0) /
                oldYears.map(y => y.avgTemp).filter(v => v !== null).length).toFixed(2) : '‚Äî'}¬∞C</td>
              <td class="${parseFloat(oldTempDiff) > 0 ? 'trend-up' : 'trend-down'}">${oldTempDiff !== '‚Äî' ? (parseFloat(oldTempDiff) > 0 ? '+' : '') + oldTempDiff + '¬∞C' : '‚Äî'}</td>
              <td>${oldYears.map(y => y.totalPrecip).filter(v => v !== null).length > 0 ?
                (oldYears.map(y => y.totalPrecip).filter(v => v !== null).reduce((a,b) => a+b, 0) /
                oldYears.map(y => y.totalPrecip).filter(v => v !== null).length).toFixed(0) : '‚Äî'} mm</td>
              <td class="${parseFloat(oldPrecipDiff) > 0 ? 'trend-up' : 'trend-down'}">${oldPrecipDiff !== '‚Äî' ? (parseFloat(oldPrecipDiff) > 0 ? '+' : '') + oldPrecipDiff + '%' : '‚Äî'}</td>
            </tr>
            ` : ''}
          </tbody>
        </table>
        
        <div style="margin-top: 15px; font-size: 0.8rem; color: #888;">
          <strong>Pozn√°mka:</strong> Klimatick√Ω norm√°l dle WMO je 30let√Ω pr≈Ømƒõr slou≈æ√≠c√≠ jako reference.
          Aktu√°ln√≠ referenƒçn√≠ obdob√≠ je 1991-2020. Odchylky ukazuj√≠ rozd√≠l oproti tomuto norm√°lu.
        </div>
      `;
    }

    // ===== DEK√ÅDN√ç ANAL√ùZA =====
    let decadesData = null;
    let decadesCharts = {};

    function loadDecadesFile() {
      const fileInput = document.getElementById('importFileDecades');
      const file = fileInput.files[0];

      if (!file) {
        showNotification('Vyberte soubor', 'warning');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          decadesData = JSON.parse(e.target.result);

          if (!decadesData.location || !decadesData.years || !Array.isArray(decadesData.years)) {
            throw new Error('Neplatn√Ω form√°t souboru');
          }

          analyzeDecades();
          showNotification(`Data naƒçtena: ${decadesData.location.name} (${decadesData.years.length} let)`, 'success');
        } catch (error) {
          showNotification(`Chyba p≈ôi naƒç√≠t√°n√≠: ${error.message}`, 'error');
        }
      };
      reader.readAsText(file);
    }

    function getDecade(year) {
      return Math.floor(year / 10) * 10;
    }

    function getDecadeLabel(decade) {
      return `${decade}‚Äì${decade + 9}`;
    }

    function groupByDecades(years) {
      const decades = {};
      years.forEach(y => {
        const decade = getDecade(y.year);
        if (!decades[decade]) {
          decades[decade] = [];
        }
        decades[decade].push(y);
      });
      return decades;
    }

    function calculateDecadeStats(decadeYears) {
      const validTemps = decadeYears.map(y => y.avgTemp).filter(v => v !== null);
      const validPrecips = decadeYears.map(y => y.totalPrecip).filter(v => v !== null);
      const validSunshine = decadeYears.map(y => y.totalSunshine).filter(v => v !== null && v !== undefined);

      return {
        yearsCount: decadeYears.length,
        avgTemp: validTemps.length ? validTemps.reduce((a, b) => a + b, 0) / validTemps.length : null,
        avgPrecip: validPrecips.length ? validPrecips.reduce((a, b) => a + b, 0) / validPrecips.length : null,
        avgSunshine: validSunshine.length ? validSunshine.reduce((a, b) => a + b, 0) / validSunshine.length : null,
        avgSummerDays: decadeYears.map(y => y.summerDays).filter(v => v !== undefined).reduce((a, b) => a + b, 0) / decadeYears.length,
        avgTropicalDays: decadeYears.map(y => y.tropicalDays).filter(v => v !== undefined).reduce((a, b) => a + b, 0) / decadeYears.length,
        avgFrostDays: decadeYears.map(y => y.frostDays).filter(v => v !== undefined).reduce((a, b) => a + b, 0) / decadeYears.length,
        avgIceDays: decadeYears.map(y => y.iceDays).filter(v => v !== undefined).reduce((a, b) => a + b, 0) / decadeYears.length,
        maxTemp: Math.max(...decadeYears.map(y => y.maxTemp).filter(v => v !== null)),
        minTemp: Math.min(...decadeYears.map(y => y.minTemp).filter(v => v !== null))
      };
    }

    function analyzeDecades() {
      if (!decadesData || !decadesData.years.length) return;

      const years = decadesData.years.sort((a, b) => a.year - b.year);
      const location = decadesData.location;
      const decades = groupByDecades(years);
      const sortedDecadeKeys = Object.keys(decades).map(Number).sort((a, b) => a - b);

      document.getElementById('decades-content').style.display = 'block';
      document.getElementById('decadesPeriod').textContent =
        `Obdob√≠: ${years[0].year} ‚Äì ${years[years.length - 1].year} | Lokalita: ${location.name} | Poƒçet dek√°d: ${sortedDecadeKeys.length}`;

      renderDecadesOverview(decades, sortedDecadeKeys);
      renderDecadesTempChanges(decades, sortedDecadeKeys);
      renderDecadesPrecipChanges(decades, sortedDecadeKeys);
      renderDecadesExtremeDays(decades, sortedDecadeKeys);
      renderDecadesComparisonTable(decades, sortedDecadeKeys);
      renderClimateShift(decades, sortedDecadeKeys);
      renderDecadesTrendsChart(decades, sortedDecadeKeys);
    }

    function renderDecadesOverview(decades, sortedDecadeKeys) {
      let html = '<div style="display: flex; flex-wrap: wrap; gap: 10px;">';

      sortedDecadeKeys.forEach(decade => {
        const count = decades[decade].length;
        const isComplete = count >= 10;
        html += `
          <div style="padding: 15px 20px; background: ${isComplete ? 'rgba(40, 167, 69, 0.2)' : 'rgba(255, 193, 7, 0.2)'};
                      border-radius: 8px; border: 1px solid ${isComplete ? '#28a745' : '#ffc107'}; text-align: center;">
            <div style="font-size: 1.2rem; font-weight: bold;">${getDecadeLabel(decade)}</div>
            <div style="font-size: 0.9rem; color: #888; margin-top: 5px;">${count} let ${isComplete ? '‚úì' : '(ne√∫pln√°)'}</div>
          </div>
        `;
      });

      html += '</div>';
      document.getElementById('decadesOverview').innerHTML = html;
    }

    function renderDecadesTempChanges(decades, sortedDecadeKeys) {
      const stats = sortedDecadeKeys.map(d => ({ decade: d, ...calculateDecadeStats(decades[d]) }));

      let html = '<div class="decade-changes-grid">';

      for (let i = 0; i < stats.length; i++) {
        const current = stats[i];
        const prev = i > 0 ? stats[i - 1] : null;
        const diff = prev && current.avgTemp !== null && prev.avgTemp !== null
          ? (current.avgTemp - prev.avgTemp).toFixed(2)
          : null;

        html += `
          <div class="decade-change-card">
            <div class="decade-change-label">${getDecadeLabel(current.decade)}</div>
            <div class="decade-change-value">${current.avgTemp !== null ? current.avgTemp.toFixed(2) : '‚Äî'}¬∞C</div>
            ${diff !== null ? `
              <div class="decade-change-diff ${parseFloat(diff) > 0 ? 'positive' : 'negative'}">
                ${parseFloat(diff) > 0 ? '‚Üë' : '‚Üì'} ${Math.abs(diff)}¬∞C
              </div>
            ` : '<div class="decade-change-diff neutral">‚Äî</div>'}
          </div>
        `;
      }

      html += '</div>';
      document.getElementById('decadesTempChanges').innerHTML = html;

      // Chart
      if (decadesCharts.temp) decadesCharts.temp.destroy();
      const ctx = document.getElementById('decadesTempChart').getContext('2d');
      decadesCharts.temp = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: stats.map(s => getDecadeLabel(s.decade)),
          datasets: [{
            label: 'Pr≈Ømƒõrn√° teplota (¬∞C)',
            data: stats.map(s => s.avgTemp),
            backgroundColor: stats.map(s => {
              if (s.avgTemp === null) return '#666';
              const temp = s.avgTemp;
              if (temp < 8) return '#3498db';
              if (temp < 10) return '#2ecc71';
              if (temp < 12) return '#f1c40f';
              return '#e74c3c';
            }),
            borderRadius: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            title: { display: false }
          },
          scales: {
            y: {
              beginAtZero: false,
              grid: { color: '#404040' },
              ticks: { color: '#888' }
            },
            x: {
              grid: { display: false },
              ticks: { color: '#888' }
            }
          }
        }
      });
    }

    function renderDecadesPrecipChanges(decades, sortedDecadeKeys) {
      const stats = sortedDecadeKeys.map(d => ({ decade: d, ...calculateDecadeStats(decades[d]) }));

      let html = '<div class="decade-changes-grid">';

      for (let i = 0; i < stats.length; i++) {
        const current = stats[i];
        const prev = i > 0 ? stats[i - 1] : null;
        const diff = prev && current.avgPrecip !== null && prev.avgPrecip !== null
          ? (current.avgPrecip - prev.avgPrecip).toFixed(0)
          : null;
        const diffPercent = prev && current.avgPrecip !== null && prev.avgPrecip !== null && prev.avgPrecip > 0
          ? ((current.avgPrecip - prev.avgPrecip) / prev.avgPrecip * 100).toFixed(1)
          : null;

        html += `
          <div class="decade-change-card">
            <div class="decade-change-label">${getDecadeLabel(current.decade)}</div>
            <div class="decade-change-value">${current.avgPrecip !== null ? current.avgPrecip.toFixed(0) : '‚Äî'} mm</div>
            ${diff !== null ? `
              <div class="decade-change-diff ${parseFloat(diff) > 0 ? 'positive-precip' : 'negative-precip'}">
                ${parseFloat(diff) > 0 ? '‚Üë' : '‚Üì'} ${Math.abs(diff)} mm (${diffPercent}%)
              </div>
            ` : '<div class="decade-change-diff neutral">‚Äî</div>'}
          </div>
        `;
      }

      html += '</div>';
      document.getElementById('decadesPrecipChanges').innerHTML = html;

      // Chart
      if (decadesCharts.precip) decadesCharts.precip.destroy();
      const ctx = document.getElementById('decadesPrecipChart').getContext('2d');
      decadesCharts.precip = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: stats.map(s => getDecadeLabel(s.decade)),
          datasets: [{
            label: 'Pr≈Ømƒõrn√© sr√°≈æky (mm)',
            data: stats.map(s => s.avgPrecip),
            backgroundColor: '#3498db',
            borderRadius: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: '#404040' },
              ticks: { color: '#888' }
            },
            x: {
              grid: { display: false },
              ticks: { color: '#888' }
            }
          }
        }
      });
    }

    function renderDecadesExtremeDays(decades, sortedDecadeKeys) {
      const stats = sortedDecadeKeys.map(d => ({ decade: d, ...calculateDecadeStats(decades[d]) }));

      let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">';

      // Summer days
      html += '<div class="extreme-days-section"><h4>üåû Letn√≠ dny (‚â•25¬∞C)</h4><div class="decade-changes-grid" style="grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));">';
      stats.forEach((s, i) => {
        const prev = i > 0 ? stats[i - 1] : null;
        const diff = prev ? (s.avgSummerDays - prev.avgSummerDays).toFixed(1) : null;
        html += `
          <div class="mini-decade-card">
            <div style="font-size: 0.8rem; color: #888;">${s.decade}s</div>
            <div style="font-size: 1.1rem; font-weight: bold;">${s.avgSummerDays.toFixed(1)}</div>
            ${diff !== null ? `<div style="font-size: 0.75rem; color: ${parseFloat(diff) > 0 ? '#e74c3c' : '#3498db'};">${parseFloat(diff) > 0 ? '+' : ''}${diff}</div>` : ''}
          </div>
        `;
      });
      html += '</div></div>';

      // Tropical days
      html += '<div class="extreme-days-section"><h4>üèùÔ∏è Tropick√© dny (‚â•30¬∞C)</h4><div class="decade-changes-grid" style="grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));">';
      stats.forEach((s, i) => {
        const prev = i > 0 ? stats[i - 1] : null;
        const diff = prev ? (s.avgTropicalDays - prev.avgTropicalDays).toFixed(1) : null;
        html += `
          <div class="mini-decade-card">
            <div style="font-size: 0.8rem; color: #888;">${s.decade}s</div>
            <div style="font-size: 1.1rem; font-weight: bold;">${s.avgTropicalDays.toFixed(1)}</div>
            ${diff !== null ? `<div style="font-size: 0.75rem; color: ${parseFloat(diff) > 0 ? '#e74c3c' : '#3498db'};">${parseFloat(diff) > 0 ? '+' : ''}${diff}</div>` : ''}
          </div>
        `;
      });
      html += '</div></div>';

      // Frost days
      html += '<div class="extreme-days-section"><h4>ü•∂ Mrazov√© dny (<0¬∞C)</h4><div class="decade-changes-grid" style="grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));">';
      stats.forEach((s, i) => {
        const prev = i > 0 ? stats[i - 1] : null;
        const diff = prev ? (s.avgFrostDays - prev.avgFrostDays).toFixed(1) : null;
        html += `
          <div class="mini-decade-card">
            <div style="font-size: 0.8rem; color: #888;">${s.decade}s</div>
            <div style="font-size: 1.1rem; font-weight: bold;">${s.avgFrostDays.toFixed(1)}</div>
            ${diff !== null ? `<div style="font-size: 0.75rem; color: ${parseFloat(diff) < 0 ? '#e74c3c' : '#3498db'};">${parseFloat(diff) > 0 ? '+' : ''}${diff}</div>` : ''}
          </div>
        `;
      });
      html += '</div></div>';

      // Ice days
      html += '<div class="extreme-days-section"><h4>‚ùÑÔ∏è Ledov√© dny (max<0¬∞C)</h4><div class="decade-changes-grid" style="grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));">';
      stats.forEach((s, i) => {
        const prev = i > 0 ? stats[i - 1] : null;
        const diff = prev ? (s.avgIceDays - prev.avgIceDays).toFixed(1) : null;
        html += `
          <div class="mini-decade-card">
            <div style="font-size: 0.8rem; color: #888;">${s.decade}s</div>
            <div style="font-size: 1.1rem; font-weight: bold;">${s.avgIceDays.toFixed(1)}</div>
            ${diff !== null ? `<div style="font-size: 0.75rem; color: ${parseFloat(diff) < 0 ? '#e74c3c' : '#3498db'};">${parseFloat(diff) > 0 ? '+' : ''}${diff}</div>` : ''}
          </div>
        `;
      });
      html += '</div></div>';

      html += '</div>';
      document.getElementById('decadesExtremeDays').innerHTML = html;

      // Extreme days chart
      if (decadesCharts.extreme) decadesCharts.extreme.destroy();
      const ctx = document.getElementById('decadesExtremeDaysChart').getContext('2d');
      decadesCharts.extreme = new Chart(ctx, {
        type: 'line',
        data: {
          labels: stats.map(s => getDecadeLabel(s.decade)),
          datasets: [
            {
              label: 'Letn√≠ dny',
              data: stats.map(s => s.avgSummerDays),
              borderColor: '#f39c12',
              backgroundColor: 'rgba(243, 156, 18, 0.1)',
              fill: true,
              tension: 0.3
            },
            {
              label: 'Tropick√© dny',
              data: stats.map(s => s.avgTropicalDays),
              borderColor: '#e74c3c',
              backgroundColor: 'rgba(231, 76, 60, 0.1)',
              fill: true,
              tension: 0.3
            },
            {
              label: 'Mrazov√© dny',
              data: stats.map(s => s.avgFrostDays),
              borderColor: '#3498db',
              backgroundColor: 'rgba(52, 152, 219, 0.1)',
              fill: true,
              tension: 0.3
            },
            {
              label: 'Ledov√© dny',
              data: stats.map(s => s.avgIceDays),
              borderColor: '#9b59b6',
              backgroundColor: 'rgba(155, 89, 182, 0.1)',
              fill: true,
              tension: 0.3
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: { color: '#888' }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: '#404040' },
              ticks: { color: '#888' }
            },
            x: {
              grid: { display: false },
              ticks: { color: '#888' }
            }
          }
        }
      });
    }

    function renderDecadesComparisonTable(decades, sortedDecadeKeys) {
      const stats = sortedDecadeKeys.map(d => ({ decade: d, ...calculateDecadeStats(decades[d]) }));

      let html = '';
      for (let i = 0; i < stats.length; i++) {
        const s = stats[i];
        const prev = i > 0 ? stats[i - 1] : null;

        const tempDiff = prev && s.avgTemp !== null && prev.avgTemp !== null ? (s.avgTemp - prev.avgTemp) : null;
        const precipDiff = prev && s.avgPrecip !== null && prev.avgPrecip !== null ? (s.avgPrecip - prev.avgPrecip) : null;

        html += `
          <tr>
            <td><strong>${getDecadeLabel(s.decade)}</strong> <span style="color: #888; font-size: 0.85rem;">(${s.yearsCount} let)</span></td>
            <td>${s.avgTemp !== null ? s.avgTemp.toFixed(2) : '‚Äî'}</td>
            <td class="${tempDiff !== null ? (tempDiff > 0 ? 'trend-up' : 'trend-down') : ''}">${tempDiff !== null ? (tempDiff > 0 ? '+' : '') + tempDiff.toFixed(2) : '‚Äî'}</td>
            <td>${s.avgPrecip !== null ? s.avgPrecip.toFixed(0) : '‚Äî'}</td>
            <td class="${precipDiff !== null ? (precipDiff > 0 ? 'trend-up' : 'trend-down') : ''}">${precipDiff !== null ? (precipDiff > 0 ? '+' : '') + precipDiff.toFixed(0) : '‚Äî'}</td>
            <td>${s.avgSunshine !== null ? s.avgSunshine.toFixed(0) : '‚Äî'}</td>
            <td>${s.avgSummerDays.toFixed(1)}</td>
            <td>${s.avgTropicalDays.toFixed(1)}</td>
            <td>${s.avgFrostDays.toFixed(1)}</td>
            <td>${s.avgIceDays.toFixed(1)}</td>
          </tr>
        `;
      }

      document.getElementById('decadesTableBody').innerHTML = html;
    }

    function renderClimateShift(decades, sortedDecadeKeys) {
      if (sortedDecadeKeys.length < 2) {
        document.getElementById('climateShift').innerHTML = '<p style="color: #888;">Pro zobrazen√≠ klimatick√©ho posunu jsou pot≈ôeba alespo≈à 2 dek√°dy.</p>';
        return;
      }

      const firstDecade = sortedDecadeKeys[0];
      const lastDecade = sortedDecadeKeys[sortedDecadeKeys.length - 1];
      const firstStats = calculateDecadeStats(decades[firstDecade]);
      const lastStats = calculateDecadeStats(decades[lastDecade]);

      const tempChange = lastStats.avgTemp !== null && firstStats.avgTemp !== null
        ? (lastStats.avgTemp - firstStats.avgTemp).toFixed(2) : null;
      const precipChange = lastStats.avgPrecip !== null && firstStats.avgPrecip !== null
        ? (lastStats.avgPrecip - firstStats.avgPrecip).toFixed(0) : null;
      const precipChangePercent = lastStats.avgPrecip !== null && firstStats.avgPrecip !== null && firstStats.avgPrecip > 0
        ? ((lastStats.avgPrecip - firstStats.avgPrecip) / firstStats.avgPrecip * 100).toFixed(1) : null;
      const summerDaysChange = (lastStats.avgSummerDays - firstStats.avgSummerDays).toFixed(1);
      const tropicalDaysChange = (lastStats.avgTropicalDays - firstStats.avgTropicalDays).toFixed(1);
      const frostDaysChange = (lastStats.avgFrostDays - firstStats.avgFrostDays).toFixed(1);

      document.getElementById('climateShift').innerHTML = `
        <div class="climate-shift-container">
          <div class="shift-header">
            <div class="shift-period">
              <span class="shift-from">${getDecadeLabel(firstDecade)}</span>
              <span class="shift-arrow">‚Üí</span>
              <span class="shift-to">${getDecadeLabel(lastDecade)}</span>
            </div>
            <div class="shift-years">(${lastDecade - firstDecade} let rozd√≠l)</div>
          </div>

          <div class="shift-metrics">
            <div class="shift-metric ${tempChange !== null && parseFloat(tempChange) > 0 ? 'warming' : 'cooling'}">
              <div class="shift-metric-icon">üå°Ô∏è</div>
              <div class="shift-metric-label">Teplota</div>
              <div class="shift-metric-value">${tempChange !== null ? (parseFloat(tempChange) > 0 ? '+' : '') + tempChange + '¬∞C' : '‚Äî'}</div>
            </div>

            <div class="shift-metric ${precipChange !== null && parseFloat(precipChange) > 0 ? 'wetter' : 'drier'}">
              <div class="shift-metric-icon">üåßÔ∏è</div>
              <div class="shift-metric-label">Sr√°≈æky</div>
              <div class="shift-metric-value">${precipChange !== null ? (parseFloat(precipChange) > 0 ? '+' : '') + precipChange + ' mm' : '‚Äî'}</div>
              <div class="shift-metric-sub">${precipChangePercent !== null ? '(' + (parseFloat(precipChangePercent) > 0 ? '+' : '') + precipChangePercent + '%)' : ''}</div>
            </div>

            <div class="shift-metric ${parseFloat(summerDaysChange) > 0 ? 'increase' : 'decrease'}">
              <div class="shift-metric-icon">üåû</div>
              <div class="shift-metric-label">Letn√≠ dny</div>
              <div class="shift-metric-value">${parseFloat(summerDaysChange) > 0 ? '+' : ''}${summerDaysChange}</div>
            </div>

            <div class="shift-metric ${parseFloat(tropicalDaysChange) > 0 ? 'increase' : 'decrease'}">
              <div class="shift-metric-icon">üèùÔ∏è</div>
              <div class="shift-metric-label">Tropick√© dny</div>
              <div class="shift-metric-value">${parseFloat(tropicalDaysChange) > 0 ? '+' : ''}${tropicalDaysChange}</div>
            </div>

            <div class="shift-metric ${parseFloat(frostDaysChange) < 0 ? 'decrease-frost' : 'increase-frost'}">
              <div class="shift-metric-icon">ü•∂</div>
              <div class="shift-metric-label">Mrazov√© dny</div>
              <div class="shift-metric-value">${parseFloat(frostDaysChange) > 0 ? '+' : ''}${frostDaysChange}</div>
            </div>
          </div>
        </div>
      `;
    }

    function renderDecadesTrendsChart(decades, sortedDecadeKeys) {
      const stats = sortedDecadeKeys.map(d => ({ decade: d, ...calculateDecadeStats(decades[d]) }));

      // Normalize values for comparison
      const maxTemp = Math.max(...stats.map(s => s.avgTemp || 0));
      const maxPrecip = Math.max(...stats.map(s => s.avgPrecip || 0));
      const maxSummerDays = Math.max(...stats.map(s => s.avgSummerDays || 0));
      const maxFrostDays = Math.max(...stats.map(s => s.avgFrostDays || 0));

      if (decadesCharts.trends) decadesCharts.trends.destroy();
      const ctx = document.getElementById('decadesTrendsChart').getContext('2d');
      decadesCharts.trends = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: stats.map(s => getDecadeLabel(s.decade)),
          datasets: [
            {
              label: 'Teplota (norm.)',
              data: stats.map(s => s.avgTemp ? (s.avgTemp / maxTemp * 100) : 0),
              borderColor: '#e74c3c',
              backgroundColor: 'rgba(231, 76, 60, 0.2)',
              pointBackgroundColor: '#e74c3c'
            },
            {
              label: 'Sr√°≈æky (norm.)',
              data: stats.map(s => s.avgPrecip ? (s.avgPrecip / maxPrecip * 100) : 0),
              borderColor: '#3498db',
              backgroundColor: 'rgba(52, 152, 219, 0.2)',
              pointBackgroundColor: '#3498db'
            },
            {
              label: 'Letn√≠ dny (norm.)',
              data: stats.map(s => s.avgSummerDays ? (s.avgSummerDays / maxSummerDays * 100) : 0),
              borderColor: '#f39c12',
              backgroundColor: 'rgba(243, 156, 18, 0.2)',
              pointBackgroundColor: '#f39c12'
            },
            {
              label: 'Mrazov√© dny (norm.)',
              data: stats.map(s => s.avgFrostDays ? (s.avgFrostDays / maxFrostDays * 100) : 0),
              borderColor: '#9b59b6',
              backgroundColor: 'rgba(155, 89, 182, 0.2)',
              pointBackgroundColor: '#9b59b6'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: { color: '#888' }
            }
          },
          scales: {
            r: {
              beginAtZero: true,
              max: 100,
              grid: { color: '#404040' },
              angleLines: { color: '#404040' },
              pointLabels: { color: '#888' },
              ticks: { display: false }
            }
          }
        }
      });
    }
  </script>
</body>
</html>